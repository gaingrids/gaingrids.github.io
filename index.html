<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GainGrid Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Monetag SDK -->
    <script>
        (function(w, d, s, id){
            w.monetag = w.monetag || {start: function(){ w.monetag.callMethod? w.monetag.callMethod.apply(w.monetag, arguments): (w.monetag.queue = w.monetag.queue || []).push(arguments); }};
            var js = d.createElement(s); 
            js.id = id; 
            js.async = true; 
            js.src = "https://cdn.monetag.com/tag.min.js";
            d.getElementsByTagName("head")[0].appendChild(js);
        })(window, document, "script", "monetag-js");
    </script>
    <style>
        /* ========== MAIN STYLES ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --deep-purple: #5B2E8A;
            --vivid-magenta: #E33D7A;
            --soft-pink: #FF98BD;
            --electric-blue: #4AA3FF;
            --bg-dark: #0F0F14;
            --bg-panel: #0B0B0D;
            --text-secondary: #9AA0A6;
            --gcoin-gold: #FFC857;
            --white: #FFFFFF;
            --spacing-base: 8px;
            --radius-xs: 6px;
            --radius-sm: 12px;
            --radius-md: 16px;
            --radius-lg: 24px;
            --success: #10B981;
            --error: #EF4444;
            --warning: #F59E0B;
        }

        html, body {
            width: 100%;
            height: 100%;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-dark);
            color: var(--white);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .app-container {
            width: 100%;
            min-height: 100%;
            background: var(--bg-dark);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* ========== HEADER ========== */
        .app-header {
            width: 100%;
            background: var(--bg-panel);
            padding: calc(var(--spacing-base) * 2) calc(var(--spacing-base) * 3);
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(12px);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-base) * 1.5);
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--deep-purple), var(--vivid-magenta));
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        .app-title {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--deep-purple), var(--vivid-magenta));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .balance-chip {
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-base) * 1);
            background: linear-gradient(135deg, rgba(91, 46, 138, 0.3), rgba(227, 61, 122, 0.3));
            padding: calc(var(--spacing-base) * 1) calc(var(--spacing-base) * 2);
            border-radius: var(--radius-lg);
            border: 1px solid rgba(255, 200, 87, 0.3);
        }

        .coin-icon {
            width: 20px;
            height: 20px;
            animation: rotate3d 4s infinite linear;
        }

        @keyframes rotate3d {
            0% { transform: perspective(400px) rotateY(0deg); }
            100% { transform: perspective(400px) rotateY(360deg); }
        }

        .balance-text {
            font-size: 14px;
            font-weight: 600;
            color: var(--gcoin-gold);
        }

        /* ========== MAIN CONTENT ========== */
        .main-content {
            flex: 1;
            width: 100%;
            padding: calc(var(--spacing-base) * 3) calc(var(--spacing-base) * 2);
            padding-bottom: calc(var(--spacing-base) * 12);
            overflow-y: auto;
        }

        .screen {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ========== GRIDHOME FEED ========== */
        .feed-container {
            display: flex;
            flex-direction: column;
            gap: calc(var(--spacing-base) * 2);
        }

        .post-card {
            background: var(--bg-panel);
            border-radius: var(--radius-md);
            padding: calc(var(--spacing-base) * 2);
            border: 1px solid rgba(255, 255, 255, 0.06);
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.18);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .post-card:hover {
            border-color: rgba(91, 46, 138, 0.4);
            transform: translateY(-2px);
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-base) * 1.5);
            margin-bottom: calc(var(--spacing-base) * 2);
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--deep-purple), var(--electric-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            overflow: hidden;
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .post-meta {
            flex: 1;
        }

        .poster-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--white);
            margin-bottom: 2px;
        }

        .post-time {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .post-content {
            font-size: 14px;
            line-height: 1.5;
            color: var(--white);
            margin-bottom: calc(var(--spacing-base) * 2);
        }

        .post-media {
            width: 100%;
            height: 200px;
            background: var(--bg-dark);
            border-radius: var(--radius-sm);
            margin-bottom: calc(var(--spacing-base) * 2);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .post-media img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .post-media video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .earnings-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 200, 87, 0.1);
            padding: calc(var(--spacing-base) * 1) calc(var(--spacing-base) * 1.5);
            border-radius: var(--radius-xs);
            margin-bottom: calc(var(--spacing-base) * 2);
        }

        .earnings-label {
            font-size: 12px;
            color: var(--gcoin-gold);
            font-weight: 600;
        }

        .post-actions {
            display: flex;
            gap: calc(var(--spacing-base) * 1);
        }

        .action-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: calc(var(--spacing-base) * 1);
            padding: calc(var(--spacing-base) * 1.2);
            background: rgba(255, 255, 255, 0.05);
            border: none;
            border-radius: var(--radius-sm);
            color: var(--white);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.12s ease;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.05);
        }

        .action-btn.liked {
            background: rgba(227, 61, 122, 0.2);
            color: var(--vivid-magenta);
        }

        .action-icon {
            width: 16px;
            height: 16px;
        }

        /* ========== COMMENTS SECTION ========== */
        .comments-section {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0 0 var(--radius-md) var(--radius-md);
            margin: calc(var(--spacing-base) * -2);
            margin-top: calc(var(--spacing-base) * 1);
            padding: 0 calc(var(--spacing-base) * 2);
        }

        .comments-section.expanded {
            max-height: 400px;
            padding: calc(var(--spacing-base) * 2);
        }

        .comments-container {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: calc(var(--spacing-base) * 2);
        }

        .comment-item {
            padding: calc(var(--spacing-base) * 1.5);
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        }

        .comment-user {
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-base) * 1);
            margin-bottom: calc(var(--spacing-base) * 0.5);
        }

        .comment-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--electric-blue);
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .comment-input-container {
            display: flex;
            gap: calc(var(--spacing-base) * 1);
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-lg);
            padding: calc(var(--spacing-base) * 1);
        }

        .comment-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--white);
            font-size: 14px;
            padding: calc(var(--spacing-base) * 1);
            outline: none;
        }

        .send-comment {
            background: var(--electric-blue);
            border: none;
            border-radius: var(--radius-sm);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        /* ========== TASK BOARD ========== */
        .platform-scroll-container {
            width: 100%;
            overflow-x: auto;
            margin-bottom: calc(var(--spacing-base) * 3);
            padding-bottom: calc(var(--spacing-base) * 1);
            scroll-behavior: smooth;
            position: relative;
        }

        .platform-scroll {
            display: flex;
            gap: calc(var(--spacing-base) * 2);
            padding: calc(var(--spacing-base) * 1);
            animation: auto-scroll 30s linear infinite;
            min-width: max-content;
        }

        .platform-scroll:hover {
            animation-play-state: paused;
        }

        @keyframes auto-scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(calc(-100% + 100vw)); }
        }

        .platform-card {
            flex: 0 0 auto;
            width: 120px;
            background: var(--bg-panel);
            border-radius: var(--radius-md);
            padding: calc(var(--spacing-base) * 2);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: calc(var(--spacing-base) * 1.5);
            border: 1px solid rgba(255, 255, 255, 0.06);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .platform-card:hover {
            transform: translateY(-4px);
            border-color: var(--electric-blue);
            box-shadow: 0 8px 24px rgba(74, 163, 255, 0.2);
        }

        .platform-icon-wrapper {
            width: 56px;
            height: 56px;
            border-radius: var(--radius-md);
            background: var(--bg-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
            transform-style: preserve-3d;
            perspective: 1000px;
            transition: transform 0.3s ease;
        }

        .platform-card:hover .platform-icon-wrapper {
            transform: rotateY(10deg) rotateX(5deg);
        }

        .platform-icon-wrapper img {
            width: 32px;
            height: 32px;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
        }

        .platform-name {
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            color: var(--white);
        }

        /* Task List */
        .task-list-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: calc(var(--spacing-base) * 2);
        }

        .task-counter {
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-base) * 1);
            font-size: 14px;
        }

        .counter-label {
            color: var(--text-secondary);
        }

        .counter-value {
            font-weight: 700;
            color: var(--electric-blue);
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: calc(var(--spacing-base) * 2);
        }

        .task-item {
            background: var(--bg-panel);
            border-radius: var(--radius-md);
            padding: calc(var(--spacing-base) * 2);
            border: 1px solid rgba(255, 255, 255, 0.06);
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-base) * 2);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .task-item:hover {
            border-color: var(--electric-blue);
            transform: translateY(-2px);
        }

        .task-item.completed {
            opacity: 0.6;
            pointer-events: none;
        }

        .task-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .task-info {
            flex: 1;
        }

        .task-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: calc(var(--spacing-base) * 0.5);
        }

        .task-description {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .task-reward {
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-base) * 0.5);
            padding: calc(var(--spacing-base) * 1) calc(var(--spacing-base) * 1.5);
            background: rgba(255, 200, 87, 0.15);
            border-radius: var(--radius-lg);
            font-size: 14px;
            font-weight: 700;
            color: var(--gcoin-gold);
            white-space: nowrap;
        }

        /* Random Tasks */
        .random-tasks-section {
            margin-top: calc(var(--spacing-base) * 4);
        }

        .random-tasks-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: calc(var(--spacing-base) * 2);
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-base) * 1);
        }

        .random-tasks-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: calc(var(--spacing-base) * 2);
        }

        /* ========== WATCH & EARN ========== */
        .watch-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: calc(var(--spacing-base) * 3);
        }

        .daily-limit {
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-base) * 1);
            font-size: 14px;
            color: var(--text-secondary);
        }

        .cleanup-btn {
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-base) * 0.75);
            padding: calc(var(--spacing-base) * 1) calc(var(--spacing-base) * 1.5);
            background: rgba(227, 61, 122, 0.15);
            border: 1px solid rgba(227, 61, 122, 0.3);
            border-radius: var(--radius-sm);
            color: var(--vivid-magenta);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.12s ease;
        }

        .cleanup-btn:hover {
            background: rgba(227, 61, 122, 0.25);
            transform: scale(1.05);
        }

        .watch-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: calc(var(--spacing-base) * 2);
        }

        .ad-card {
            background: var(--bg-panel);
            border-radius: var(--radius-md);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.06);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ad-card:hover {
            transform: translateY(-4px);
            border-color: rgba(74, 163, 255, 0.4);
        }

        .ad-card.watched {
            opacity: 0.6;
            pointer-events: none;
        }

        .ad-thumbnail {
            width: 100%;
            height: 160px;
            background: linear-gradient(135deg, rgba(91, 46, 138, 0.3), rgba(74, 163, 255, 0.3));
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .play-icon {
            width: 48px;
            height: 48px;
            opacity: 0.9;
        }

        .ad-duration {
            position: absolute;
            bottom: calc(var(--spacing-base) * 1);
            right: calc(var(--spacing-base) * 1);
            background: rgba(0, 0, 0, 0.8);
            padding: calc(var(--spacing-base) * 0.5) calc(var(--spacing-base) * 1);
            border-radius: var(--radius-xs);
            font-size: 12px;
            font-weight: 600;
        }

        .ad-info {
            padding: calc(var(--spacing-base) * 2);
        }

        .ad-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: calc(var(--spacing-base) * 0.5);
        }

        .ad-source {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: calc(var(--spacing-base) * 1);
        }

        .ad-reward {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .reward-amount {
            font-size: 14px;
            font-weight: 700;
            color: var(--gcoin-gold);
        }

        .watched-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .collected-badge {
            color: var(--electric-blue);
            font-weight: 600;
        }

        /* ========== PROFILE ========== */
        .profile-section {
            display: flex;
            flex-direction: column;
            gap: calc(var(--spacing-base) * 3);
        }

        .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: calc(var(--spacing-base) * 2);
            padding: calc(var(--spacing-base) * 3);
            background: var(--bg-panel);
            border-radius: var(--radius-md);
            border: 1px solid rgba(255, 255, 255, 0.06);
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--deep-purple), var(--vivid-magenta));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 700;
            border: 3px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-name {
            font-size: 20px;
            font-weight: 700;
        }

        .profile-username {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: calc(var(--spacing-base) * 2);
            width: 100%;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: calc(var(--spacing-base) * 0.5);
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--electric-blue);
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Profile Menu - Fixed */
        .profile-menu {
            display: flex;
            flex-direction: column;
            gap: 0;
            background: var(--bg-panel);
            border-radius: var(--radius-md);
            border: 1px solid rgba(255, 255, 255, 0.06);
            overflow: hidden;
        }

        .menu-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: calc(var(--spacing-base) * 1.5) calc(var(--spacing-base) * 2);
            background: transparent;
            border: none;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            color: var(--white);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.12s ease;
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .menu-icon {
            width: 18px;
            height: 18px;
            margin-right: calc(var(--spacing-base) * 1.5);
        }

        .menu-text {
            flex: 1;
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-base) * 1.5);
        }

        /* ========== BOTTOM NAVIGATION ========== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            background: var(--bg-panel);
            border-top: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            justify-content: space-around;
            padding: calc(var(--spacing-base) * 1.5) 0;
            z-index: 100;
            backdrop-filter: blur(12px);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: calc(var(--spacing-base) * 0.5);
            padding: calc(var(--spacing-base) * 1) calc(var(--spacing-base) * 2);
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.12s ease;
            text-decoration: none;
        }

        .nav-item:hover {
            color: var(--white);
        }

        .nav-item.active {
            color: var(--electric-blue);
        }

        .nav-item.active .nav-icon {
            transform: scale(1.1);
        }

        .nav-icon {
            width: 24px;
            height: 24px;
            transition: transform 0.12s ease;
        }

        /* ========== FLOATING CREATE BUTTON ========== */
        .floating-create {
            position: fixed;
            bottom: calc(var(--spacing-base) * 14);
            right: calc(var(--spacing-base) * 2);
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--vivid-magenta), var(--soft-pink));
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(227, 61, 122, 0.4);
            transition: all 0.3s ease;
            z-index: 99;
            opacity: 0;
            transform: translateY(20px);
        }

        .floating-create.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .floating-create:hover {
            transform: scale(1.1) translateY(0);
            box-shadow: 0 6px 24px rgba(227, 61, 122, 0.6);
        }

        .create-icon {
            width: 24px;
            height: 24px;
        }

        /* ========== MODALS ========== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 200;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(8px);
        }

        .modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: calc(var(--spacing-base) * 2);
        }

        .modal-content {
            width: 100%;
            max-width: 500px;
            background: var(--bg-panel);
            border-radius: var(--radius-md);
            padding: calc(var(--spacing-base) * 3);
            border: 1px solid rgba(255, 255, 255, 0.08);
            position: relative;
            animation: slideUp 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: calc(var(--spacing-base) * 3);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }

        .close-btn {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.05);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.12s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        .close-icon {
            width: 16px;
            height: 16px;
        }

        /* ========== BROWSER MODAL (IFRAME) ========== */
        .browser-frame {
            width: 100%;
            height: 85vh;
            background: var(--bg-panel);
            border-radius: var(--radius-md);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .browser-header {
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-base) * 1);
            padding: calc(var(--spacing-base) * 1.5);
            background: rgba(255, 255, 255, 0.03);
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            flex-shrink: 0;
        }

        .browser-dots {
            display: flex;
            gap: calc(var(--spacing-base) * 0.75);
        }

        .browser-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--text-secondary);
        }

        .browser-url {
            flex: 1;
            padding: calc(var(--spacing-base) * 0.75) calc(var(--spacing-base) * 1.5);
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-xs);
            font-size: 12px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .browser-content {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .browser-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }

        /* Timer at bottom */
        .browser-timer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(11, 11, 13, 0.95);
            padding: calc(var(--spacing-base) * 2);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: calc(var(--spacing-base) * 1.5);
            z-index: 10;
        }

        .timer-display {
            font-size: 36px;
            font-weight: 700;
            color: var(--electric-blue);
            font-family: monospace;
        }

        .timer-label {
            font-size: 14px;
            color: var(--text-secondary);
            text-align: center;
        }

        .timer-progress {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
        }

        .timer-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--electric-blue), var(--vivid-magenta));
            width: 0%;
            transition: width 0.3s ease;
        }

        /* ========== CREATE POST MODAL ========== */
        .create-form {
            display: flex;
            flex-direction: column;
            gap: calc(var(--spacing-base) * 2);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: calc(var(--spacing-base) * 1);
        }

        .form-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: calc(var(--spacing-base) * 1.5);
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            color: var(--white);
            font-size: 14px;
            font-family: inherit;
            transition: all 0.12s ease;
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--electric-blue);
            background: rgba(255, 255, 255, 0.08);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-select {
            width: 100%;
            padding: calc(var(--spacing-base) * 1.5);
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            color: var(--white);
            font-size: 14px;
            font-family: inherit;
            cursor: pointer;
        }

        /* Drag and drop area */
        .drop-area {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            padding: calc(var(--spacing-base) * 3);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .drop-area:hover,
        .drop-area.dragover {
            border-color: var(--electric-blue);
            background: rgba(74, 163, 255, 0.05);
        }

        .drop-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto calc(var(--spacing-base) * 1.5);
            color: var(--text-secondary);
        }

        .drop-text {
            color: var(--text-secondary);
            margin-bottom: calc(var(--spacing-base) * 0.5);
        }

        .drop-hint {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .media-preview {
            margin-top: calc(var(--spacing-base) * 1.5);
        }

        .preview-item {
            position: relative;
            margin-bottom: calc(var(--spacing-base) * 1);
        }

        .preview-item img,
        .preview-item video {
            width: 100%;
            max-height: 200px;
            border-radius: var(--radius-sm);
            object-fit: cover;
        }

        .remove-media {
            position: absolute;
            top: calc(var(--spacing-base) * 0.5);
            right: calc(var(--spacing-base) * 0.5);
            background: rgba(0, 0, 0, 0.7);
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
        }

        .submit-btn {
            padding: calc(var(--spacing-base) * 2);
            background: linear-gradient(135deg, var(--deep-purple), var(--vivid-magenta));
            border: none;
            border-radius: var(--radius-sm);
            color: var(--white);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.12s ease;
        }

        .submit-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 16px rgba(91, 46, 138, 0.4);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* ========== LOADING OVERLAY ========== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--electric-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ========== NOTIFICATIONS ========== */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .notification {
            background: var(--bg-panel);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-md);
            padding: calc(var(--spacing-base) * 1.5) calc(var(--spacing-base) * 2);
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-base) * 1);
            min-width: 300px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.success {
            border-left: 4px solid var(--success);
        }

        .notification.error {
            border-left: 4px solid var(--error);
        }

        .notification.warning {
            border-left: 4px solid var(--warning);
        }

        .notification.info {
            border-left: 4px solid var(--electric-blue);
        }

        /* ========== VIP BADGES ========== */
        .vip-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .vip-badge.none {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
        }

        .vip-badge.basic {
            background: rgba(255, 200, 87, 0.15);
            color: var(--gcoin-gold);
            border: 1px solid rgba(255, 200, 87, 0.3);
        }

        .vip-badge.silver {
            background: linear-gradient(135deg, rgba(192, 192, 192, 0.15), rgba(224, 224, 224, 0.15));
            color: #C0C0C0;
            border: 1px solid rgba(192, 192, 192, 0.3);
        }

        .vip-badge.gold {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 200, 87, 0.15));
            color: #FFD700;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .vip-badge.premium {
            background: linear-gradient(135deg, rgba(227, 61, 122, 0.15), rgba(91, 46, 138, 0.15));
            color: var(--vivid-magenta);
            border: 1px solid rgba(227, 61, 122, 0.3);
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 768px) {
            .platform-scroll-container {
                animation-play-state: running;
            }
            
            .platform-scroll {
                animation: auto-scroll 40s linear infinite;
            }
            
            .watch-grid {
                grid-template-columns: 1fr;
            }
            
            .random-tasks-grid {
                grid-template-columns: 1fr;
            }
            
            .browser-frame {
                height: 80vh;
            }
        }

        @media (min-width: 769px) {
            .app-container {
                max-width: 430px;
                margin: 0 auto;
                box-shadow: 0 0 40px rgba(0, 0, 0, 0.3);
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Notifications -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- Main App -->
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="logo-section">
                <div class="logo-icon">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <rect width="20" height="20" rx="6" fill="url(#logo-gradient)"/>
                        <path d="M7 10L10 13L14 7" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <defs>
                            <linearGradient id="logo-gradient" x1="0" y1="0" x2="20" y2="20">
                                <stop stop-color="var(--deep-purple)"/>
                                <stop offset="1" stop-color="var(--vivid-magenta)"/>
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <h1 class="app-title">GainGrid</h1>
            </div>
            <div class="balance-chip">
                <svg class="coin-icon" viewBox="0 0 20 20" fill="none">
                    <circle cx="10" cy="10" r="9" fill="var(--gcoin-gold)" stroke="#FFD87A" stroke-width="1"/>
                    <text x="10" y="14" text-anchor="middle" fill="#0B0B0D" font-size="12" font-weight="700">G</text>
                </svg>
                <span class="balance-text" id="balanceText">0</span>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- GridHome Screen -->
            <section class="screen active" id="gridhomeScreen">
                <div class="feed-container" id="feedContainer">
                    <!-- Posts loaded dynamically -->
                </div>
            </section>

            <!-- Task Board Screen -->
            <section class="screen" id="tasksScreen">
                <!-- Platform Cards -->
                <div class="platform-scroll-container">
                    <div class="platform-scroll" id="platformScroll">
                        <!-- Platform cards loaded dynamically -->
                    </div>
                </div>

                <!-- Platform Tasks -->
                <div id="platformTasksContainer">
                    <!-- Platform tasks loaded dynamically -->
                </div>

                <!-- Random Daily Tasks -->
                <div class="random-tasks-section">
                    <h3 class="random-tasks-title">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M10 4V16M4 10H16" stroke="var(--electric-blue)" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        Random Daily Tasks
                    </h3>
                    <div class="random-tasks-grid" id="randomTasksGrid">
                        <!-- Random tasks loaded dynamically -->
                    </div>
                </div>
            </section>

            <!-- Watch & Earn Screen -->
            <section class="screen" id="watchScreen">
                <div class="watch-header">
                    <div class="daily-limit">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2"/>
                            <path d="M10 5V10L13 13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <span>Daily Ads: <strong id="adsCounter">0/20</strong></span>
                    </div>
                    <button class="cleanup-btn" id="cleanupBtn">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M2 4H14M6 7V11M10 7V11M3 4L4 13C4 13.5 4.5 14 5 14H11C11.5 14 12 13.5 12 13L13 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                        Clean Up
                    </button>
                </div>
                <div class="watch-grid" id="watchGrid">
                    <!-- Ads loaded dynamically -->
                </div>
            </section>

            <!-- Profile Screen -->
            <section class="screen" id="profileScreen">
                <div class="profile-section">
                    <div class="profile-header">
                        <div class="profile-avatar" id="profileAvatar">
                            <!-- Avatar loaded dynamically -->
                        </div>
                        <h2 class="profile-name" id="profileName">Loading...</h2>
                        <p class="profile-username" id="profileUsername">@username</p>
                        <div class="vip-badge" id="vipBadge">No VIP</div>
                        <div class="profile-stats">
                            <div class="stat-item">
                                <div class="stat-value" id="statGcoins">0</div>
                                <div class="stat-label">G-Coins</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="statEarned">0</div>
                                <div class="stat-label">Total Earned</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="statTasks">0</div>
                                <div class="stat-label">Tasks Done</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="profile-menu">
                        <button class="menu-item" onclick="openProfileSection('edit')">
                            <div class="menu-text">
                                <svg class="menu-icon" viewBox="0 0 20 20" fill="none">
                                    <path d="M11 2H13C13.5 2 14 2.5 14 3V5M2 11V13C2 13.5 2.5 14 3 14H5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                    <circle cx="8" cy="8" r="3" stroke="currentColor" stroke-width="1.5"/>
                                </svg>
                                Edit Profile
                            </div>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <button class="menu-item" onclick="openProfileSection('transactions')">
                            <div class="menu-text">
                                <svg class="menu-icon" viewBox="0 0 20 20" fill="none">
                                    <rect x="3" y="4" width="14" height="12" rx="1" stroke="currentColor" stroke-width="1.5"/>
                                    <path d="M7 8H13M7 11H10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                </svg>
                                Transaction History
                            </div>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <button class="menu-item" onclick="openProfileSection('referrals')">
                            <div class="menu-text">
                                <svg class="menu-icon" viewBox="0 0 20 20" fill="none">
                                    <path d="M16 7C16 8.5 15.5 10 14 10C15.5 10 16 11.5 16 13C16 14.5 14.5 15 13 15M10 13H7C5.5 13 5 12.5 5 11V7C5 5.5 5.5 5 7 5H13C14.5 5 15 5.5 15 7V11C15 12.5 14.5 13 13 13H10ZM10 13V5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                Referrals
                            </div>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <button class="menu-item" onclick="openProfileSection('settings')">
                            <div class="menu-text">
                                <svg class="menu-icon" viewBox="0 0 20 20" fill="none">
                                    <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="1.5"/>
                                    <path d="M10 6V14M6 10H14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                </svg>
                                Settings
                            </div>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <button class="menu-item" onclick="openHelpSupport()">
                            <div class="menu-text">
                                <svg class="menu-icon" viewBox="0 0 20 20" fill="none">
                                    <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="1.5"/>
                                    <path d="M10 14V10M10 6V6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                </svg>
                                Help & Support
                            </div>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" onclick="switchScreen('gridhome')">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none">
                    <path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M9 22V12H15V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                GridHome
            </button>
            <button class="nav-item" onclick="switchScreen('tasks')">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none">
                    <path d="M9 11L12 14L22 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M21 12V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Tasks
            </button>
            <button class="nav-item" onclick="switchScreen('watch')">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none">
                    <path d="M5 3L19 12L5 21V3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Watch
            </button>
            <button class="nav-item" onclick="switchScreen('profile')">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none">
                    <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Profile
            </button>
        </nav>

        <!-- Floating Create Button -->
        <button class="floating-create" id="floatingCreate" onclick="openCreateModal()">
            <svg class="create-icon" viewBox="0 0 24 24" fill="none">
                <path d="M12 20H21" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M16.5 3.49998C16.8978 3.10216 17.4374 2.87866 18 2.87866C18.2786 2.87866 18.5544 2.93353 18.8118 3.04014C19.0692 3.14674 19.303 3.303 19.5 3.49998C19.697 3.69697 19.8532 3.93082 19.9598 4.18819C20.0665 4.44556 20.1213 4.72141 20.1213 4.99998C20.1213 5.27856 20.0665 5.55441 19.9598 5.81178C19.8532 6.06915 19.697 6.303 19.5 6.49998L7 19L3 20L4 16L16.5 3.49998Z" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>

        <!-- Modals -->
        
        <!-- Create Post Modal -->
        <div class="modal-overlay" id="createModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Create Post</h3>
                    <button class="close-btn" onclick="closeModal('createModal')">
                        <svg class="close-icon" viewBox="0 0 16 16" fill="none">
                            <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </button>
                </div>
                <form class="create-form" id="createForm" onsubmit="submitPost(event)">
                    <div class="form-group">
                        <label class="form-label">Content</label>
                        <textarea class="form-textarea" id="postContent" placeholder="What do you want to share?" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Link URL</label>
                        <input type="url" class="form-input" id="postLink" placeholder="https://example.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Action Type</label>
                        <select class="form-select" id="postAction" required>
                            <option value="visit">Visit Website</option>
                            <option value="join">Join Channel/Group</option>
                            <option value="watch">Watch Video</option>
                            <option value="signup">Sign Up</option>
                            <option value="install">Install App</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Reward Amount (10,000 G-Coins minimum)</label>
                        <input type="number" class="form-input" id="postReward" min="10000" value="10000" required>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                            Minimum: 10,000 G-Coins | Maximum: 100,000 G-Coins
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Media (Optional)</label>
                        <div class="drop-area" id="dropArea" onclick="document.getElementById('mediaInput').click()">
                            <svg class="drop-icon" viewBox="0 0 24 24" fill="none">
                                <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 21.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                <path d="M17 8L12 3L7 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M12 3V15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <div class="drop-text">Drop image/video or click to upload</div>
                            <div class="drop-hint">Max size: 10MB</div>
                            <input type="file" id="mediaInput" accept="image/*,video/*" style="display: none" onchange="handleMediaUpload(event)">
                        </div>
                        <div class="media-preview" id="mediaPreview"></div>
                    </div>
                    
                    <button type="submit" class="submit-btn" id="submitPostBtn">Publish Post</button>
                </form>
            </div>
        </div>

        <!-- Browser Modal -->
        <div class="modal-overlay" id="browserModal">
            <div class="browser-frame">
                <div class="browser-header">
                    <div class="browser-dots">
                        <div class="browser-dot"></div>
                        <div class="browser-dot"></div>
                        <div class="browser-dot"></div>
                    </div>
                    <div class="browser-url" id="browserUrl">https://gridgain.com</div>
                    <button class="close-btn" onclick="closeBrowserModal()">
                        <svg class="close-icon" viewBox="0 0 16 16" fill="none">
                            <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </button>
                </div>
                <div class="browser-content">
                    <iframe class="browser-iframe" id="browserIframe" sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox"></iframe>
                    <div class="browser-timer" id="browserTimer">
                        <div class="timer-display" id="timerDisplay">00:00</div>
                        <div class="timer-label" id="timerLabel">Please wait while we verify completion</div>
                        <div class="timer-progress">
                            <div class="timer-progress-bar" id="timerProgressBar"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Section Modal -->
        <div class="modal-overlay" id="profileModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="profileModalTitle">Profile Section</h3>
                    <button class="close-btn" onclick="closeModal('profileModal')">
                        <svg class="close-icon" viewBox="0 0 16 16" fill="none">
                            <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body" id="profileModalContent">
                    <!-- Content loaded dynamically -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== GLOBAL STATE ==========
        const APP_STATE = {
            user: null,
            balance: 0,
            vipLevel: 'none',
            dailyCounters: {
                tasks: 0,
                ads: 0
            },
            posts: [],
            tasks: {
                platform: [],
                random: []
            },
            ads: [],
            currentTask: null,
            currentAd: null,
            timerInterval: null,
            isTelegram: false,
            WebApp: null,
            lastScroll: 0
        };

        // ========== SMART LINKS ==========
        const SMART_LINKS = [
            'https://otieu.com/4/10176113',
            'https://otieu.com/4/10176184',
            'https://otieu.com/4/10176114',
            'https://otieu.com/4/10176185'
        ];

        // ========== PLATFORM CONFIGURATION ==========
        const PLATFORMS = {
            youtube: {
                name: 'YouTube',
                color: '#FF0000',
                icon: 'https://cdn.jsdelivr.net/npm/simple-icons@latest/icons/youtube.svg'
            },
            telegram: {
                name: 'Telegram',
                color: '#0088CC',
                icon: 'https://cdn.jsdelivr.net/npm/simple-icons@latest/icons/telegram.svg'
            },
            instagram: {
                name: 'Instagram',
                color: '#E4405F',
                icon: 'https://cdn.jsdelivr.net/npm/simple-icons@latest/icons/instagram.svg'
            },
            twitter: {
                name: 'Twitter',
                color: '#1DA1F2',
                icon: 'https://cdn.jsdelivr.net/npm/simple-icons@latest/icons/twitter.svg'
            },
            tiktok: {
                name: 'TikTok',
                color: '#000000',
                icon: 'https://cdn.jsdelivr.net/npm/simple-icons@latest/icons/tiktok.svg'
            },
            facebook: {
                name: 'Facebook',
                color: '#1877F2',
                icon: 'https://cdn.jsdelivr.net/npm/simple-icons@latest/icons/facebook.svg'
            },
            whatsapp: {
                name: 'WhatsApp',
                color: '#25D366',
                icon: 'https://cdn.jsdelivr.net/npm/simple-icons@latest/icons/whatsapp.svg'
            },
            discord: {
                name: 'Discord',
                color: '#5865F2',
                icon: 'https://cdn.jsdelivr.net/npm/simple-icons@latest/icons/discord.svg'
            },
            website: {
                name: 'Website',
                color: '#4AA3FF',
                icon: 'https://cdn.jsdelivr.net/npm/simple-icons@latest/icons/internetexplorer.svg'
            },
            linkedin: {
                name: 'LinkedIn',
                color: '#0A66C2',
                icon: 'https://cdn.jsdelivr.net/npm/simple-icons@latest/icons/linkedin.svg'
            }
        };

        // ========== INITIALIZATION ==========
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Hide loading
                setTimeout(() => {
                    document.getElementById('loadingOverlay').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loadingOverlay').style.display = 'none';
                    }, 300);
                }, 1000);

                // Check Telegram WebApp
                if (window.Telegram && window.Telegram.WebApp) {
                    APP_STATE.WebApp = window.Telegram.WebApp;
                    APP_STATE.isTelegram = true;
                    APP_STATE.WebApp.ready();
                    APP_STATE.WebApp.expand();
                    
                    // Get user data
                    const tgUser = APP_STATE.WebApp.initDataUnsafe.user;
                    if (tgUser) {
                        APP_STATE.user = {
                            id: tgUser.id,
                            firstName: tgUser.first_name,
                            lastName: tgUser.last_name || '',
                            username: tgUser.username,
                            photoUrl: tgUser.photo_url
                        };
                    }
                }

                // Handle URL parameters
                const urlParams = new URLSearchParams(window.location.search);
                const payload = urlParams.get('payload');
                const hash = window.location.hash.replace('#', '');

                if (payload) {
                    await handlePayload(payload);
                }

                // Initialize app
                await initializeApp();

                // Handle hash navigation
                if (hash) {
                    handleHashNavigation(hash);
                }

                // Setup event listeners
                setupEventListeners();

                // Initialize Monetag ads
                initializeMonetagAds();

            } catch (error) {
                console.error('Initialization error:', error);
                showNotification('Error initializing app', 'error');
            }
        });

        // ========== PAYLOAD HANDLING ==========
        async function handlePayload(payload) {
            try {
                // Decode Base64
                const decoded = atob(payload);
                const data = JSON.parse(decoded);
                
                // Update app state
                if (data.user) {
                    APP_STATE.user = { ...APP_STATE.user, ...data.user };
                }
                if (data.balance !== undefined) {
                    APP_STATE.balance = data.balance;
                    updateBalance();
                }
                if (data.vipLevel) {
                    APP_STATE.vipLevel = data.vipLevel;
                    updateVipBadge();
                }
                if (data.posts) {
                    APP_STATE.posts = data.posts;
                    updateFeed();
                }
                if (data.tasks) {
                    APP_STATE.tasks.platform = data.tasks;
                    updatePlatformTasks();
                }

                showNotification('Data loaded successfully', 'success');

            } catch (error) {
                console.error('Payload handling error:', error);
                showNotification('Error processing payload', 'error');
            }
        }

        function encodePayload(data) {
            const jsonString = JSON.stringify(data);
            return btoa(unescape(encodeURIComponent(jsonString)));
        }

        // ========== BOT COMMUNICATION ==========
        async function sendToBot(event, data) {
            try {
                const payload = {
                    event: event,
                    userId: APP_STATE.user?.id,
                    timestamp: Date.now(),
                    ...data
                };

                const encoded = encodePayload(payload);
                
                // Send via webhook (Bots.Business style)
                // Note: This is a placeholder for actual Bots.Business webhook
                console.log('Sending to bot:', { event, data });
                
                // In Bots.Business, you would use:
                // Libs.Webhooks.getUrlFor({ command: "onWebhook", user_id: userId })
                
                // For now, we'll simulate the request
                await simulateWebhook(encoded);

                return true;
            } catch (error) {
                console.error('Bot communication error:', error);
                return false;
            }
        }

        async function simulateWebhook(payload) {
            // Simulate webhook delay
            return new Promise(resolve => setTimeout(() => resolve({ success: true }), 500));
        }

        // ========== APP INITIALIZATION ==========
        async function initializeApp() {
            // Load demo data if no payload
            if (!APP_STATE.user) {
                APP_STATE.user = {
                    id: '123456',
                    firstName: 'John',
                    lastName: 'Doe',
                    username: 'johndoe'
                };
            }

            if (APP_STATE.balance === 0) {
                APP_STATE.balance = 2847;
            }

            if (APP_STATE.vipLevel === 'none') {
                APP_STATE.vipLevel = 'gold';
            }

            // Load data
            await loadPosts();
            await loadPlatformTasks();
            await loadRandomTasks();
            await loadAds();

            // Update UI
            updateUI();
        }

        async function loadPosts() {
            // Demo posts with images
            APP_STATE.posts = [
                {
                    id: '1',
                    userId: '123456',
                    username: 'johndoe',
                    avatar: 'JD',
                    content: 'Check out this amazing opportunity to earn G-coins! Join our community and start earning today. Limited spots available! ',
                    media: 'https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?w=400&h=200&fit=crop',
                    link: 'https://example.com/join',
                    action: 'join',
                    reward: 50,
                    likes: 24,
                    comments: 8,
                    timestamp: '2 hours ago',
                    liked: false
                },
                {
                    id: '2',
                    userId: '789012',
                    username: 'sarahkim',
                    avatar: 'SK',
                    content: 'New task alert! Complete this survey and earn instant rewards. Takes only 5 minutes! ',
                    media: 'https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=400&h=200&fit=crop',
                    link: 'https://example.com/survey',
                    action: 'visit',
                    reward: 30,
                    likes: 18,
                    comments: 5,
                    timestamp: '5 hours ago',
                    liked: true
                },
                {
                    id: '3',
                    userId: '345678',
                    username: 'mikepeters',
                    avatar: 'MP',
                    content: 'Watch this short video and get rewarded! No sign-up required. Just watch and earn! ',
                    media: 'https://images.unsplash.com/photo-1593359677879-a4bb92f829d1?w=400&h=200&fit=crop',
                    link: 'https://example.com/watch',
                    action: 'watch',
                    reward: 25,
                    likes: 42,
                    comments: 15,
                    timestamp: '1 day ago',
                    liked: false
                }
            ];
        }

        async function loadPlatformTasks() {
            // Demo platform tasks
            APP_STATE.tasks.platform = [
                {
                    id: 't1',
                    platform: 'youtube',
                    title: 'Watch YouTube Video',
                    description: 'Watch full video and like. Stay 02:30 for reward.',
                    duration: 150,
                    reward: 50,
                    link: SMART_LINKS[0],
                    completed: false
                },
                {
                    id: 't2',
                    platform: 'telegram',
                    title: 'Join Telegram Channel',
                    description: 'Join channel and stay active. Stay 00:45 for reward.',
                    duration: 45,
                    reward: 35,
                    link: SMART_LINKS[1],
                    completed: false
                }
            ];
        }

        async function loadRandomTasks() {
            // Generate 10 random daily tasks
            APP_STATE.tasks.random = [];
            const taskTypes = ['Visit Website', 'Watch Video', 'Join Group', 'Install App', 'Complete Survey'];
            
            for (let i = 0; i < 10; i++) {
                APP_STATE.tasks.random.push({
                    id: `random_${i}`,
                    title: `${taskTypes[i % taskTypes.length]} ${i + 1}`,
                    description: `Complete this task to earn rewards`,
                    duration: Math.floor(Math.random() * 60) + 30,
                    reward: Math.floor(Math.random() * 200) + 100,
                    link: SMART_LINKS[i % SMART_LINKS.length],
                    completed: false
                });
            }
        }

        async function loadAds() {
            // Generate 20 daily ads
            APP_STATE.ads = [];
            const adTitles = ['Tech Review', 'Crypto Update', 'Gaming News', 'Product Launch', 'App Review'];
            const adSources = ['TechBrand Co.', 'CryptoExchange', 'GameStore', 'Fashion Brand', 'AppStore'];
            
            for (let i = 0; i < 20; i++) {
                APP_STATE.ads.push({
                    id: `ad_${i}`,
                    title: `${adTitles[i % adTitles.length]} ${i + 1}`,
                    duration: Math.floor(Math.random() * 30) + 30,
                    reward: Math.floor(Math.random() * 60) + 60,
                    source: adSources[i % adSources.length],
                    link: SMART_LINKS[i % SMART_LINKS.length],
                    watched: i < 3 // First 3 are watched for demo
                });
            }
        }

        // ========== UI UPDATES ==========
        function updateUI() {
            updateUserInfo();
            updateBalance();
            updateFeed();
            updatePlatformScroll();
            updatePlatformTasks();
            updateRandomTasks();
            updateAds();
            updateVipBadge();
        }

        function updateUserInfo() {
            const user = APP_STATE.user;
            if (!user) return;

            document.getElementById('profileName').textContent = 
                `${user.firstName} ${user.lastName}`.trim();
            document.getElementById('profileUsername').textContent = 
                user.username ? `@${user.username}` : '@username';

            // Update avatar
            const avatar = document.getElementById('profileAvatar');
            if (user.photoUrl) {
                avatar.innerHTML = `<img src="${user.photoUrl}" alt="${user.firstName}">`;
            } else {
                const initials = (user.firstName?.[0] || '') + (user.lastName?.[0] || '');
                avatar.textContent = initials || 'U';
            }
        }

        function updateBalance() {
            document.getElementById('balanceText').textContent = 
                APP_STATE.balance.toLocaleString();
            document.getElementById('statGcoins').textContent = 
                APP_STATE.balance.toLocaleString();
        }

        function updateVipBadge() {
            const badge = document.getElementById('vipBadge');
            badge.className = `vip-badge ${APP_STATE.vipLevel}`;
            
            switch(APP_STATE.vipLevel) {
                case 'premium': badge.textContent = 'Premium VIP'; break;
                case 'gold': badge.textContent = 'Gold VIP'; break;
                case 'silver': badge.textContent = 'Silver VIP'; break;
                case 'basic': badge.textContent = 'Basic VIP'; break;
                default: badge.textContent = 'No VIP';
            }
        }

        function updateFeed() {
            const container = document.getElementById('feedContainer');
            container.innerHTML = '';

            APP_STATE.posts.forEach(post => {
                const postEl = createPostElement(post);
                container.appendChild(postEl);
            });
        }

        function createPostElement(post) {
            const div = document.createElement('div');
            div.className = 'post-card';
            div.dataset.id = post.id;

            const mediaHtml = post.media ? `
                <div class="post-media">
                    <img src="${post.media}" alt="Post media" onerror="this.style.display='none'">
                </div>
            ` : '';

            const actionText = {
                visit: 'Visit',
                join: 'Join',
                watch: 'Watch',
                signup: 'Sign Up',
                install: 'Install'
            }[post.action] || 'Open';

            div.innerHTML = `
                <div class="post-header">
                    <div class="avatar">${post.avatar}</div>
                    <div class="post-meta">
                        <div class="poster-name">${post.username}</div>
                        <div class="post-time">${post.timestamp}</div>
                    </div>
                </div>
                <p class="post-content">${post.content}</p>
                ${mediaHtml}
                <div class="earnings-bar">
                    <span class="earnings-label"> Earn up to ${post.reward} G-coins</span>
                </div>
                <div class="post-actions">
                    <button class="action-btn ${post.liked ? 'liked' : ''}" onclick="handleLike('${post.id}', this)">
                        <svg class="action-icon" viewBox="0 0 16 16" fill="none">
                            <path d="M8 14L2.5 8.5C1.5 7.5 1.5 5.8 2.5 4.8C3.5 3.8 5.2 3.8 6.2 4.8L8 6.6L9.8 4.8C10.8 3.8 12.5 3.8 13.5 4.8C14.5 5.8 14.5 7.5 13.5 8.5L8 14Z" 
                                  stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
                                  ${post.liked ? 'fill="currentColor"' : 'fill="none"'}/>
                        </svg>
                        <span>${post.likes}</span>
                    </button>
                    <button class="action-btn" onclick="handleAction('${post.id}', '${post.link}', '${post.action}')">
                        <svg class="action-icon" viewBox="0 0 16 16" fill="none">
                            <path d="M14 2L8 8L14 2ZM14 2L9.5 14L8 8L2 6.5L14 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>${actionText}</span>
                    </button>
                    <button class="action-btn" onclick="openComments('${post.id}')">
                        <svg class="action-icon" viewBox="0 0 16 16" fill="none">
                            <path d="M14 11C14 11.5 13.5 12 13 12H4L2 14V3C2 2.5 2.5 2 3 2H13C13.5 2 14 2.5 14 3V11Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>${post.comments}</span>
                    </button>
                </div>
                <div class="comments-section" id="comments-${post.id}">
                    <div class="comments-container" id="commentsContainer-${post.id}">
                        <!-- Comments loaded here -->
                    </div>
                    <div class="comment-input-container">
                        <input type="text" class="comment-input" placeholder="Write a comment..." id="commentInput-${post.id}">
                        <button class="send-comment" onclick="sendComment('${post.id}')">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M1.5 8L14.5 1L8.5 14L7 8L1.5 8Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
            `;

            return div;
        }

        function updatePlatformScroll() {
            const scroll = document.getElementById('platformScroll');
            scroll.innerHTML = '';

            Object.entries(PLATFORMS).forEach(([key, platform]) => {
                const card = document.createElement('div');
                card.className = 'platform-card';
                card.onclick = () => filterPlatformTasks(key);

                card.innerHTML = `
                    <div class="platform-icon-wrapper">
                        <img src="${platform.icon}" alt="${platform.name}" onerror="this.style.display='none'; this.parentElement.innerHTML='${platform.name[0]}'">
                    </div>
                    <div class="platform-name">${platform.name}</div>
                `;

                scroll.appendChild(card);
            });
        }

        function filterPlatformTasks(platform) {
            const container = document.getElementById('platformTasksContainer');
            const tasks = APP_STATE.tasks.platform.filter(t => t.platform === platform);
            
            if (tasks.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        No tasks available for ${PLATFORMS[platform]?.name || platform}
                    </div>
                `;
                return;
            }

            let html = `
                <div class="task-list-header">
                    <h3 style="font-size: 18px; font-weight: 600;">${PLATFORMS[platform]?.name || platform} Tasks</h3>
                    <div class="task-counter">
                        <span class="counter-label">Completed:</span>
                        <span class="counter-value">${tasks.filter(t => t.completed).length}/${tasks.length}</span>
                    </div>
                </div>
                <div class="task-list">
            `;

            tasks.forEach(task => {
                html += `
                    <div class="task-item ${task.completed ? 'completed' : ''}" onclick="${!task.completed ? `startTask('${task.id}', 'platform')` : ''}">
                        <div class="task-icon" style="background: ${PLATFORMS[task.platform]?.color || '#4AA3FF'}">
                            <img src="${PLATFORMS[task.platform]?.icon}" alt="${task.platform}" width="20" height="20" onerror="this.style.display='none'">
                        </div>
                        <div class="task-info">
                            <div class="task-title">${task.title}</div>
                            <div class="task-description">${task.description}</div>
                        </div>
                        <div class="task-reward">
                            <svg width="16" height="16" viewBox="0 0 20 20" fill="none">
                                <circle cx="10" cy="10" r="9" fill="#FFC857"/>
                                <text x="10" y="14" text-anchor="middle" fill="#0B0B0D" font-size="10" font-weight="700">G</text>
                            </svg>
                            <span>${task.reward}</span>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        function updateRandomTasks() {
            const grid = document.getElementById('randomTasksGrid');
            grid.innerHTML = '';

            APP_STATE.tasks.random.forEach(task => {
                const card = document.createElement('div');
                card.className = `task-item ${task.completed ? 'completed' : ''}`;
                if (!task.completed) {
                    card.onclick = () => startTask(task.id, 'random');
                }

                card.innerHTML = `
                    <div class="task-icon" style="background: var(--electric-blue)">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <circle cx="10" cy="10" r="8" stroke="white" stroke-width="1.5"/>
                            <path d="M10 6V14M6 10H14" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="task-info">
                        <div class="task-title">${task.title}</div>
                        <div class="task-description">${task.description}</div>
                    </div>
                    <div class="task-reward">
                        <svg width="16" height="16" viewBox="0 0 20 20" fill="none">
                            <circle cx="10" cy="10" r="9" fill="#FFC857"/>
                            <text x="10" y="14" text-anchor="middle" fill="#0B0B0D" font-size="10" font-weight="700">G</text>
                        </svg>
                        <span>${task.reward}</span>
                    </div>
                `;

                grid.appendChild(card);
            });
        }

        function updateAds() {
            const grid = document.getElementById('watchGrid');
            grid.innerHTML = '';

            const remaining = 20 - APP_STATE.dailyCounters.ads;
            document.getElementById('adsCounter').textContent = `${APP_STATE.dailyCounters.ads}/20`;

            APP_STATE.ads.forEach(ad => {
                if (APP_STATE.dailyCounters.ads >= 20) return;

                const card = document.createElement('div');
                card.className = `ad-card ${ad.watched ? 'watched' : ''}`;
                if (!ad.watched) {
                    card.onclick = () => watchAd(ad.id);
                }

                card.innerHTML = `
                    <div class="ad-thumbnail">
                        ${ad.watched ? `
                            <div class="watched-overlay">
                                <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                                    <circle cx="20" cy="20" r="18" fill="rgba(74, 163, 255, 0.9)"/>
                                    <path d="M12 20L17 25L28 14" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                        ` : `
                            <svg class="play-icon" viewBox="0 0 48 48" fill="none">
                                <circle cx="24" cy="24" r="22" fill="rgba(255,255,255,0.9)"/>
                                <path d="M19 16L32 24L19 32V16Z" fill="#0B0B0D"/>
                            </svg>
                        `}
                        <span class="ad-duration">0:${ad.duration.toString().padStart(2, '0')}</span>
                    </div>
                    <div class="ad-info">
                        <div class="ad-source">${ad.source}</div>
                        <h3 class="ad-title">${ad.title}</h3>
                        <div class="ad-reward">
                            <span class="reward-amount">+${ad.reward} G-coins</span>
                            ${!ad.watched ? `
                                <button class="watch-btn" onclick="watchAd('${ad.id}', event)">Watch</button>
                            ` : `
                                <span class="collected-badge"> Collected</span>
                            `}
                        </div>
                    </div>
                `;

                grid.appendChild(card);
            });
        }

        // ========== EVENT HANDLERS ==========
        function setupEventListeners() {
            // Scroll handling for floating button
            window.addEventListener('scroll', handleScroll);
            
            // Drag and drop
            const dropArea = document.getElementById('dropArea');
            dropArea.addEventListener('dragover', handleDragOver);
            dropArea.addEventListener('dragleave', handleDragLeave);
            dropArea.addEventListener('drop', handleDrop);
            
            // Hash change
            window.addEventListener('hashchange', () => {
                const hash = window.location.hash.replace('#', '');
                handleHashNavigation(hash);
            });
        }

        function handleScroll() {
            const floatingBtn = document.getElementById('floatingCreate');
            const currentScroll = window.pageYOffset;
            
            if (currentScroll > APP_STATE.lastScroll && currentScroll > 100) {
                // Scrolling down
                floatingBtn.classList.remove('visible');
            } else {
                // Scrolling up
                floatingBtn.classList.add('visible');
            }
            
            APP_STATE.lastScroll = currentScroll;
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('dropArea').classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('dropArea').classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('dropArea').classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleMediaFile(files[0]);
            }
        }

        // ========== SCREEN NAVIGATION ==========
        function switchScreen(screen) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(s => {
                s.classList.remove('active');
            });
            
            // Remove active from nav
            document.querySelectorAll('.nav-item').forEach(nav => {
                nav.classList.remove('active');
            });
            
            // Show selected screen
            document.getElementById(`${screen}Screen`).classList.add('active');
            
            // Update active nav
            document.querySelector(`.nav-item[onclick*="${screen}"]`).classList.add('active');
            
            // Update URL
            window.location.hash = screen;
        }

        function handleHashNavigation(hash) {
            if (!hash) return;
            
            const validScreens = ['gridhome', 'tasks', 'watch', 'profile', 'iframe'];
            
            if (validScreens.includes(hash)) {
                switchScreen(hash);
            } else if (hash === 'iframe') {
                openBrowserModal(true);
            }
        }

        // ========== MODAL FUNCTIONS ==========
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function openCreateModal() {
            // Check VIP and balance
            if (!['gold', 'premium'].includes(APP_STATE.vipLevel)) {
                showNotification('Only Gold and Premium VIP can create posts', 'error');
                return;
            }
            
            if (APP_STATE.balance < 10000) {
                showNotification('Minimum 10,000 G-Coins required to post', 'error');
                return;
            }
            
            openModal('createModal');
        }

        function openBrowserModal(isAd = false) {
            openModal('browserModal');
            
            if (isAd) {
                // Direct ad call from bot
                const randomLink = SMART_LINKS[Math.floor(Math.random() * SMART_LINKS.length)];
                const randomDuration = Math.floor(Math.random() * 30) + 30;
                
                document.getElementById('browserUrl').textContent = randomLink;
                document.getElementById('browserIframe').src = randomLink;
                startTimer(randomDuration, 'direct_ad', { link: randomLink });
            }
        }

        function closeBrowserModal() {
            if (APP_STATE.timerInterval) {
                clearInterval(APP_STATE.timerInterval);
                APP_STATE.timerInterval = null;
            }
            closeModal('browserModal');
        }

        // ========== POST FUNCTIONS ==========
        function handleMediaUpload(event) {
            const file = event.target.files[0];
            if (file) {
                handleMediaFile(file);
            }
        }

        function handleMediaFile(file) {
            const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'video/mp4', 'video/webm'];
            
            if (!validTypes.includes(file.type)) {
                showNotification('Please upload only images or videos', 'error');
                return;
            }
            
            if (file.size > 10 * 1024 * 1024) {
                showNotification('File size must be less than 10MB', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const preview = document.getElementById('mediaPreview');
                const isVideo = file.type.includes('video');
                
                preview.innerHTML = `
                    <div class="preview-item">
                        ${isVideo ? 
                            `<video src="${e.target.result}" controls></video>` :
                            `<img src="${e.target.result}" alt="Preview">`
                        }
                        <button class="remove-media" onclick="removeMedia()">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M12 4L4 12M4 4L12 12" stroke="white" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </button>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
        }

        function removeMedia() {
            document.getElementById('mediaPreview').innerHTML = '';
            document.getElementById('mediaInput').value = '';
        }

        async function submitPost(event) {
            event.preventDefault();
            
            const btn = document.getElementById('submitPostBtn');
            const originalText = btn.textContent;
            btn.textContent = 'Publishing...';
            btn.disabled = true;
            
            try {
                const content = document.getElementById('postContent').value;
                const link = document.getElementById('postLink').value;
                const action = document.getElementById('postAction').value;
                const reward = parseInt(document.getElementById('postReward').value);
                
                // Validate
                if (reward < 10000) {
                    throw new Error('Minimum reward is 10,000 G-Coins');
                }
                
                if (reward > APP_STATE.balance) {
                    throw new Error('Insufficient balance');
                }
                
                // Send to bot
                const success = await sendToBot('post_created', {
                    content,
                    link,
                    action,
                    reward,
                    vipLevel: APP_STATE.vipLevel,
                    balance: APP_STATE.balance
                });
                
                if (!success) {
                    throw new Error('Failed to send to bot');
                }
                
                // Update local state
                APP_STATE.balance -= reward;
                updateBalance();
                
                // Add post
                const newPost = {
                    id: Date.now().toString(),
                    userId: APP_STATE.user.id,
                    username: APP_STATE.user.username,
                    avatar: APP_STATE.user.firstName?.[0] + (APP_STATE.user.lastName?.[0] || ''),
                    content,
                    link,
                    action,
                    reward,
                    likes: 0,
                    comments: 0,
                    timestamp: 'Just now',
                    liked: false
                };
                
                APP_STATE.posts.unshift(newPost);
                updateFeed();
                
                // Close and notify
                closeModal('createModal');
                showNotification('Post published successfully!', 'success');
                
            } catch (error) {
                showNotification(error.message, 'error');
            } finally {
                btn.textContent = originalText;
                btn.disabled = false;
            }
        }

        // ========== TASK FUNCTIONS ==========
        function startTask(taskId, type) {
            let task;
            if (type === 'platform') {
                task = APP_STATE.tasks.platform.find(t => t.id === taskId);
            } else {
                task = APP_STATE.tasks.random.find(t => t.id === taskId);
            }
            
            if (!task || task.completed) return;
            
            // Check daily limit
            if (APP_STATE.dailyCounters.tasks >= 20) {
                showNotification('Daily task limit reached', 'warning');
                return;
            }
            
            APP_STATE.currentTask = { ...task, type };
            openBrowserModal();
            
            // Load smartlink
            document.getElementById('browserUrl').textContent = task.link;
            document.getElementById('browserIframe').src = task.link;
            
            // Start timer
            startTimer(task.duration, 'task', {
                taskId,
                type,
                reward: task.reward
            });
        }

        async function completeTask(data) {
            try {
                let task;
                if (data.type === 'platform') {
                    task = APP_STATE.tasks.platform.find(t => t.id === data.taskId);
                } else {
                    task = APP_STATE.tasks.random.find(t => t.id === data.taskId);
                }
                
                if (task) {
                    task.completed = true;
                }
                
                // Update counters
                APP_STATE.dailyCounters.tasks++;
                
                // Calculate reward with VIP bonus
                const baseReward = data.reward;
                const vipBonus = getVipBonus(APP_STATE.vipLevel);
                const totalReward = baseReward + vipBonus;
                
                // Update balance
                APP_STATE.balance += totalReward;
                updateBalance();
                
                // Update stats
                document.getElementById('statTasks').textContent = 
                    APP_STATE.dailyCounters.tasks;
                document.getElementById('statEarned').textContent = 
                    APP_STATE.balance;
                
                // Send to bot
                await sendToBot('task_completed', {
                    taskId: data.taskId,
                    type: data.type,
                    baseReward,
                    vipBonus,
                    totalReward,
                    newBalance: APP_STATE.balance
                });
                
                // Update UI
                if (data.type === 'platform') {
                    filterPlatformTasks(task?.platform || '');
                } else {
                    updateRandomTasks();
                }
                
                // Close and notify
                closeBrowserModal();
                showNotification(`Task completed! +${totalReward} G-Coins`, 'success');
                
            } catch (error) {
                console.error('Task completion error:', error);
                showNotification('Failed to complete task', 'error');
            }
        }

        function getVipBonus(level) {
            switch(level) {
                case 'premium': return 100;
                case 'gold': return 60;
                case 'silver': return 40;
                case 'basic': return 20;
                default: return 0;
            }
        }

        // ========== AD FUNCTIONS ==========
        async function watchAd(adId, event) {
            if (event) event.stopPropagation();
            
            if (APP_STATE.dailyCounters.ads >= 20) {
                showNotification('Daily ad limit reached', 'warning');
                return;
            }
            
            const ad = APP_STATE.ads.find(a => a.id === adId);
            if (!ad || ad.watched) return;
            
            APP_STATE.currentAd = ad;
            
            // Try Monetag first
            if (typeof show_10274566 === 'function') {
                try {
                    const result = await show_10274566('pop');
                    if (result) {
                        await completeAd(ad);
                        return;
                    }
                } catch (error) {
                    console.log('Monetag failed, using fallback');
                }
            }
            
            // Fallback to smartlink
            openBrowserModal();
            document.getElementById('browserUrl').textContent = ad.link;
            document.getElementById('browserIframe').src = ad.link;
            startTimer(ad.duration, 'ad', { adId, reward: ad.reward });
        }

        async function completeAd(data) {
            try {
                const ad = APP_STATE.ads.find(a => a.id === data.adId);
                if (ad) {
                    ad.watched = true;
                }
                
                // Update counters
                APP_STATE.dailyCounters.ads++;
                
                // Calculate reward with VIP bonus
                const baseReward = data.reward;
                const vipBonus = getVipBonus(APP_STATE.vipLevel);
                const totalReward = baseReward + vipBonus;
                
                // Update balance
                APP_STATE.balance += totalReward;
                updateBalance();
                
                // Send to bot
                await sendToBot('ad_completed', {
                    adId: data.adId,
                    baseReward,
                    vipBonus,
                    totalReward,
                    newBalance: APP_STATE.balance
                });
                
                // Update UI
                updateAds();
                
                // Close if browser is open
                if (document.getElementById('browserModal').classList.contains('active')) {
                    closeBrowserModal();
                }
                
                showNotification(`Ad completed! +${totalReward} G-Coins`, 'success');
                
            } catch (error) {
                console.error('Ad completion error:', error);
                showNotification('Failed to complete ad', 'error');
            }
        }

        function cleanupWatched() {
            APP_STATE.ads = APP_STATE.ads.filter(ad => !ad.watched);
            updateAds();
            showNotification('Watched ads cleaned up', 'success');
        }

        // ========== TIMER FUNCTIONS ==========
        function startTimer(seconds, type, data) {
            let remaining = seconds;
            const display = document.getElementById('timerDisplay');
            const progressBar = document.getElementById('timerProgressBar');
            const timerLabel = document.getElementById('timerLabel');
            
            // Update label
            if (type === 'task') {
                timerLabel.textContent = 'Complete the task to earn rewards';
            } else if (type === 'ad') {
                timerLabel.textContent = 'Watch the ad to earn rewards';
            } else {
                timerLabel.textContent = 'Please wait...';
            }
            
            // Update display
            updateTimer();
            
            // Start interval
            APP_STATE.timerInterval = setInterval(() => {
                remaining--;
                updateTimer();
                
                if (remaining <= 0) {
                    clearInterval(APP_STATE.timerInterval);
                    APP_STATE.timerInterval = null;
                    
                    // Handle completion
                    if (type === 'task') {
                        completeTask(data);
                    } else if (type === 'ad' || type === 'direct_ad') {
                        if (type === 'direct_ad') {
                            // Direct ad from bot
                            sendToBot('direct_ad_completed', {
                                link: data.link,
                                duration: seconds
                            }).then(() => {
                                closeBrowserModal();
                                showNotification('Ad completed!', 'success');
                            });
                        } else {
                            completeAd(data);
                        }
                    }
                }
            }, 1000);
            
            function updateTimer() {
                const mins = Math.floor(remaining / 60);
                const secs = remaining % 60;
                display.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                
                const progress = ((seconds - remaining) / seconds) * 100;
                progressBar.style.width = `${progress}%`;
            }
        }

        // ========== PROFILE FUNCTIONS ==========
        function openProfileSection(section) {
            const titleMap = {
                edit: 'Edit Profile',
                transactions: 'Transaction History',
                referrals: 'Referrals',
                settings: 'Settings'
            };
            
            document.getElementById('profileModalTitle').textContent = titleMap[section];
            
            let content = '';
            switch(section) {
                case 'edit':
                    content = `
                        <div style="display: flex; flex-direction: column; gap: 20px;">
                            <div>
                                <label style="display: block; font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">User ID</label>
                                <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; font-family: monospace;">
                                    ${APP_STATE.user?.id || 'N/A'}
                                </div>
                            </div>
                            <div>
                                <label style="display: block; font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">Username</label>
                                <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px;">
                                    @${APP_STATE.user?.username || 'username'}
                                </div>
                            </div>
                            <div>
                                <label style="display: block; font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">VIP Level</label>
                                <div class="vip-badge ${APP_STATE.vipLevel}" style="margin-top: 8px;">
                                    ${APP_STATE.vipLevel === 'premium' ? 'Premium VIP' : 
                                      APP_STATE.vipLevel === 'gold' ? 'Gold VIP' :
                                      APP_STATE.vipLevel === 'silver' ? 'Silver VIP' :
                                      APP_STATE.vipLevel === 'basic' ? 'Basic VIP' : 'No VIP'}
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'transactions':
                    content = `
                        <div style="max-height: 400px; overflow-y: auto;">
                            <div style="padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <div style="display: flex; justify-content: space-between;">
                                    <div>
                                        <div style="font-weight: 600;">Task Reward - YouTube</div>
                                        <div style="font-size: 12px; color: var(--text-secondary);">2 hours ago</div>
                                    </div>
                                    <div style="color: var(--gcoin-gold); font-weight: 700;">+50</div>
                                </div>
                            </div>
                            <div style="padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <div style="display: flex; justify-content: space-between;">
                                    <div>
                                        <div style="font-weight: 600;">Ad Watch Reward</div>
                                        <div style="font-size: 12px; color: var(--text-secondary);">5 hours ago</div>
                                    </div>
                                    <div style="color: var(--gcoin-gold); font-weight: 700;">+25</div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'referrals':
                    const refLink = `https://t.me/GridGain_Bot?start=${APP_STATE.user?.id || ''}`;
                    content = `
                        <div style="display: flex; flex-direction: column; gap: 20px;">
                            <div>
                                <label style="display: block; font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">Your Referral Link</label>
                                <div style="display: flex; gap: 8px;">
                                    <div style="flex: 1; background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; font-size: 12px; overflow: hidden; text-overflow: ellipsis;">
                                        ${refLink}
                                    </div>
                                    <button onclick="copyToClipboard('${refLink}')" style="background: var(--electric-blue); border: none; border-radius: 8px; padding: 0 16px; color: white; cursor: pointer;">
                                        Copy
                                    </button>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                                <div style="text-align: center;">
                                    <div style="font-size: 24px; font-weight: 700; color: var(--electric-blue);">0</div>
                                    <div style="font-size: 12px; color: var(--text-secondary);">Completed</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 24px; font-weight: 700; color: var(--electric-blue);">0</div>
                                    <div style="font-size: 12px; color: var(--text-secondary);">Pending</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 24px; font-weight: 700; color: var(--gcoin-gold);">0</div>
                                    <div style="font-size: 12px; color: var(--text-secondary);">Earned</div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'settings':
                    content = `
                        <div style="display: flex; flex-direction: column; gap: 20px;">
                            <div>
                                <label style="display: block; font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">App Version</label>
                                <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px;">
                                    1.0.0
                                </div>
                            </div>
                            <div>
                                <label style="display: block; font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">Last Updated</label>
                                <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px;">
                                    ${new Date().toLocaleDateString()}
                                </div>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            document.getElementById('profileModalContent').innerHTML = content;
            openModal('profileModal');
        }

        function openHelpSupport() {
            if (APP_STATE.isTelegram && APP_STATE.WebApp) {
                APP_STATE.WebApp.openTelegramLink('https://t.me/GridGain_Bot?start=help');
            } else {
                window.open('https://t.me/GridGain_Bot?start=help', '_blank');
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('Copied to clipboard', 'success');
            });
        }

        // ========== UTILITY FUNCTIONS ==========
        function handleLike(postId, button) {
            const post = APP_STATE.posts.find(p => p.id === postId);
            if (!post) return;
            
            post.liked = !post.liked;
            post.likes += post.liked ? 1 : -1;
            
            button.classList.toggle('liked');
            button.querySelector('span').textContent = post.likes;
            
            sendToBot('post_liked', {
                postId,
                liked: post.liked
            });
        }

        function handleAction(postId, link, action) {
            openBrowserModal();
            document.getElementById('browserUrl').textContent = link;
            document.getElementById('browserIframe').src = link;
            
            const duration = 60; // 1 minute for actions
            startTimer(duration, 'action', {
                postId,
                action,
                link
            });
            
            sendToBot('action_started', {
                postId,
                action,
                link
            });
        }

        function openComments(postId) {
            const section = document.getElementById(`comments-${postId}`);
            const container = document.getElementById(`commentsContainer-${postId}`);
            
            section.classList.toggle('expanded');
            
            if (section.classList.contains('expanded')) {
                // Load comments
                container.innerHTML = `
                    <div class="comment-item">
                        <div class="comment-user">
                            <div class="comment-avatar">JD</div>
                            <div style="font-weight: 600;">John Doe</div>
                        </div>
                        <div>Great opportunity!</div>
                    </div>
                    <div class="comment-item">
                        <div class="comment-user">
                            <div class="comment-avatar">SK</div>
                            <div style="font-weight: 600;">Sarah Kim</div>
                        </div>
                        <div>Just completed, thanks!</div>
                    </div>
                `;
            }
        }

        function sendComment(postId) {
            const input = document.getElementById(`commentInput-${postId}`);
            const text = input.value.trim();
            
            if (!text) return;
            
            const container = document.getElementById(`commentsContainer-${postId}`);
            
            container.innerHTML += `
                <div class="comment-item">
                    <div class="comment-user">
                        <div class="comment-avatar">${APP_STATE.user?.firstName?.[0] || 'Y'}</div>
                        <div style="font-weight: 600;">You</div>
                    </div>
                    <div>${text}</div>
                </div>
            `;
            
            input.value = '';
            sendToBot('comment_added', { postId, comment: text });
        }

        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icon = {
                success: '',
                error: '',
                warning: '',
                info: ''
            }[type];
            
            notification.innerHTML = `
                <div style="font-weight: 600;">${icon}</div>
                <div style="flex: 1;">${message}</div>
                <button onclick="this.parentElement.remove()" style="background: none; border: none; color: var(--text-secondary); cursor: pointer;">
                    
                </button>
            `;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 3000);
        }

        // ========== MONETAG ADS ==========
        function initializeMonetagAds() {
            if (typeof monetag !== 'undefined') {
                monetag.start();
                
                // Configure ads
                if (typeof show_10274566 === 'function') {
                    // In-app interstitial
                    show_10274566({ 
                        type: 'inApp', 
                        inAppSettings: { 
                            frequency: 2, 
                            capping: 0.1, 
                            interval: 30, 
                            timeout: 5, 
                            everyPage: false 
                        } 
                    });
                    
                    // Rewarded interstitial setup
                    window.addEventListener('click', (e) => {
                        if (e.target.closest('.action-btn') || e.target.closest('.task-item')) {
                            show_10274566().then(() => {
                                console.log('User watched interstitial ad');
                            });
                        }
                    });
                }
            }
        }

        // ========== EXPORT FUNCTIONS ==========
        window.switchScreen = switchScreen;
        window.openCreateModal = openCreateModal;
        window.closeModal = closeModal;
        window.closeBrowserModal = closeBrowserModal;
        window.handleLike = handleLike;
        window.handleAction = handleAction;
        window.openComments = openComments;
        window.sendComment = sendComment;
        window.watchAd = watchAd;
        window.cleanupWatched = cleanupWatched;
        window.openProfileSection = openProfileSection;
        window.openHelpSupport = openHelpSupport;
        window.handleMediaUpload = handleMediaUpload;
        window.removeMedia = removeMedia;
        window.copyToClipboard = copyToClipboard;
        window.startTask = startTask;
        document.getElementById('cleanupBtn').onclick = cleanupWatched;

        // Show floating button after load
        setTimeout(() => {
            document.getElementById('floatingCreate').classList.add('visible');
        }, 1000);
    </script>
</body>
</html>