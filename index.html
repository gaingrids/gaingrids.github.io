<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GainGrid Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap" rel="stylesheet">
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --deep-purple: #5B2E8A;
      --vivid-magenta: #E33D7A;
      --soft-pink: #FF98BD;
      --electric-blue: #4AA3FF;
      --bg-dark: #0F0F14;
      --bg-panel: #0B0B0D;
      --text-secondary: #9AA0A6;
      --gcoin-gold: #FFC857;
      --white: #FFFFFF;
      --spacing-base: 8px;
      --radius-xs: 6px;
      --radius-sm: 12px;
      --radius-md: 16px;
      --radius-lg: 24px;
    }

    html, body {
      width: 100%;
      height: 100%;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg-dark);
      color: var(--white);
      overflow-x: hidden;
    }

    .app-container {
      width: 100%;
      min-height: 100%;
      background: var(--bg-dark);
      display: flex;
      flex-direction: column;
      position: relative;
    }

    /* Header */
    .app-header {
      width: 100%;
      background: var(--bg-panel);
      padding: calc(var(--spacing-base) * 2) calc(var(--spacing-base) * 3);
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(12px);
    }

    .logo-section {
      display: flex;
      align-items: center;
      gap: calc(var(--spacing-base) * 1.5);
    }

    .logo-icon {
      width: 32px;
      height: 32px;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.05); }
    }

    .app-title {
      font-size: 20px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--deep-purple), var(--vivid-magenta));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .balance-chip {
      display: flex;
      align-items: center;
      gap: calc(var(--spacing-base) * 1);
      background: linear-gradient(135deg, rgba(91, 46, 138, 0.3), rgba(227, 61, 122, 0.3));
      padding: calc(var(--spacing-base) * 1) calc(var(--spacing-base) * 2);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255, 200, 87, 0.3);
    }

    .coin-icon {
      width: 20px;
      height: 20px;
      animation: spin 3s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotateY(0deg); }
      100% { transform: rotateY(360deg); }
    }

    .balance-text {
      font-size: 14px;
      font-weight: 600;
      color: var(--gcoin-gold);
    }

    /* Main Content */
    .main-content {
      flex: 1;
      width: 100%;
      padding: calc(var(--spacing-base) * 3) calc(var(--spacing-base) * 2);
      padding-bottom: calc(var(--spacing-base) * 10);
      overflow-y: auto;
    }

    .screen {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .screen.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Feed Cards */
    .feed-container {
      display: flex;
      flex-direction: column;
      gap: calc(var(--spacing-base) * 2);
    }

    .post-card {
      background: var(--bg-panel);
      border-radius: var(--radius-md);
      padding: calc(var(--spacing-base) * 2);
      border: 1px solid rgba(255, 255, 255, 0.06);
      box-shadow: 0 6px 24px rgba(0, 0, 0, 0.18);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .post-card:hover {
      border-color: rgba(91, 46, 138, 0.4);
      transform: translateY(-2px);
    }

    .post-header {
      display: flex;
      align-items: center;
      gap: calc(var(--spacing-base) * 1.5);
      margin-bottom: calc(var(--spacing-base) * 2);
    }

    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--deep-purple), var(--electric-blue));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 16px;
    }

    .post-meta {
      flex: 1;
    }

    .poster-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--white);
      margin-bottom: 2px;
    }

    .post-time {
      font-size: 12px;
      color: var(--text-secondary);
    }

    .post-content {
      font-size: 14px;
      line-height: 1.5;
      color: var(--white);
      margin-bottom: calc(var(--spacing-base) * 2);
    }

    .post-media {
      width: 100%;
      height: 200px;
      background: linear-gradient(135deg, rgba(91, 46, 138, 0.2), rgba(74, 163, 255, 0.2));
      border-radius: var(--radius-sm);
      margin-bottom: calc(var(--spacing-base) * 2);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-secondary);
      font-size: 12px;
    }

    .earnings-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(255, 200, 87, 0.1);
      padding: calc(var(--spacing-base) * 1) calc(var(--spacing-base) * 1.5);
      border-radius: var(--radius-xs);
      margin-bottom: calc(var(--spacing-base) * 2);
    }

    .earnings-label {
      font-size: 12px;
      color: var(--gcoin-gold);
      font-weight: 600;
    }

    .post-actions {
      display: flex;
      gap: calc(var(--spacing-base) * 2);
    }

    .action-btn {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: calc(var(--spacing-base) * 1);
      padding: calc(var(--spacing-base) * 1.5);
      background: rgba(255, 255, 255, 0.05);
      border: none;
      border-radius: var(--radius-sm);
      color: var(--white);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.12s ease;
    }

    .action-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: scale(1.05);
    }

    .action-btn.liked {
      background: rgba(227, 61, 122, 0.2);
      color: var(--vivid-magenta);
    }

    .action-icon {
      width: 16px;
      height: 16px;
    }

    /* Task Board */
    .task-list {
      display: flex;
      flex-direction: column;
      gap: calc(var(--spacing-base) * 2);
    }

    .task-card {
      background: var(--bg-panel);
      border-radius: var(--radius-md);
      padding: calc(var(--spacing-base) * 2);
      border: 1px solid rgba(255, 255, 255, 0.06);
      box-shadow: 0 6px 24px rgba(0, 0, 0, 0.18);
    }

    .task-header {
      display: flex;
      align-items: start;
      justify-content: space-between;
      margin-bottom: calc(var(--spacing-base) * 2);
    }

    .task-info {
      flex: 1;
    }

    .task-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: calc(var(--spacing-base) * 1);
    }

    .task-description {
      font-size: 12px;
      color: var(--text-secondary);
      line-height: 1.4;
    }

    .task-reward {
      display: flex;
      align-items: center;
      gap: calc(var(--spacing-base) * 0.5);
      padding: calc(var(--spacing-base) * 1) calc(var(--spacing-base) * 1.5);
      background: rgba(255, 200, 87, 0.15);
      border-radius: var(--radius-lg);
      font-size: 14px;
      font-weight: 700;
      color: var(--gcoin-gold);
    }

    .task-footer {
      display: flex;
      gap: calc(var(--spacing-base) * 1.5);
    }

    .task-btn {
      flex: 1;
      padding: calc(var(--spacing-base) * 1.5);
      border: none;
      border-radius: var(--radius-sm);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.12s ease;
    }

    .task-btn.primary {
      background: linear-gradient(135deg, var(--deep-purple), var(--vivid-magenta));
      color: var(--white);
    }

    .task-btn.primary:hover {
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(91, 46, 138, 0.4);
    }

    .task-btn.secondary {
      background: rgba(255, 255, 255, 0.05);
      color: var(--white);
    }

    .task-btn.secondary:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    /* Watch & Earn */
    .watch-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: calc(var(--spacing-base) * 2);
    }

    .video-card {
      background: var(--bg-panel);
      border-radius: var(--radius-md);
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.06);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .video-card:hover {
      transform: translateY(-4px);
      border-color: rgba(74, 163, 255, 0.4);
    }

    .video-thumbnail {
      width: 100%;
      height: 180px;
      background: linear-gradient(135deg, rgba(91, 46, 138, 0.3), rgba(74, 163, 255, 0.3));
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .play-icon {
      width: 48px;
      height: 48px;
      opacity: 0.9;
    }

    .video-duration {
      position: absolute;
      bottom: calc(var(--spacing-base) * 1);
      right: calc(var(--spacing-base) * 1);
      background: rgba(0, 0, 0, 0.8);
      padding: calc(var(--spacing-base) * 0.5) calc(var(--spacing-base) * 1);
      border-radius: var(--radius-xs);
      font-size: 12px;
      font-weight: 600;
    }

    .video-info {
      padding: calc(var(--spacing-base) * 2);
    }

    .video-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: calc(var(--spacing-base) * 1);
    }

    .video-meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 12px;
      color: var(--text-secondary);
    }

    .video-reward {
      color: var(--gcoin-gold);
      font-weight: 600;
    }

    /* Profile */
    .profile-section {
      display: flex;
      flex-direction: column;
      gap: calc(var(--spacing-base) * 3);
    }

    .profile-header {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: calc(var(--spacing-base) * 2);
      padding: calc(var(--spacing-base) * 3);
      background: var(--bg-panel);
      border-radius: var(--radius-md);
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .profile-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--deep-purple), var(--vivid-magenta));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      font-weight: 700;
      border: 3px solid rgba(255, 255, 255, 0.1);
    }

    .profile-name {
      font-size: 20px;
      font-weight: 700;
    }

    .profile-username {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .profile-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: calc(var(--spacing-base) * 2);
      width: 100%;
    }

    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: calc(var(--spacing-base) * 0.5);
    }

    .stat-value {
      font-size: 20px;
      font-weight: 700;
      color: var(--electric-blue);
    }

    .stat-label {
      font-size: 12px;
      color: var(--text-secondary);
    }

    .profile-menu {
      display: flex;
      flex-direction: column;
      gap: 0;
      background: var(--bg-panel);
      border-radius: var(--radius-md);
      border: 1px solid rgba(255, 255, 255, 0.06);
      overflow: hidden;
    }

    .menu-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: calc(var(--spacing-base) * 2) calc(var(--spacing-base) * 2.5);
      background: transparent;
      border: none;
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      color: var(--white);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.12s ease;
    }

    .menu-item:last-child {
      border-bottom: none;
    }

    .menu-item:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .menu-icon {
      width: 20px;
      height: 20px;
    }

    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      width: 100%;
      background: var(--bg-panel);
      border-top: 1px solid rgba(255, 255, 255, 0.08);
      display: flex;
      justify-content: space-around;
      padding: calc(var(--spacing-base) * 1.5) 0;
      z-index: 100;
      backdrop-filter: blur(12px);
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: calc(var(--spacing-base) * 0.5);
      padding: calc(var(--spacing-base) * 1) calc(var(--spacing-base) * 2);
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-size: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.12s ease;
      text-decoration: none;
    }

    .nav-item:hover {
      color: var(--white);
    }

    .nav-item.active {
      color: var(--electric-blue);
    }

    .nav-item.active .nav-icon {
      transform: scale(1.1);
    }

    .nav-icon {
      width: 24px;
      height: 24px;
      transition: transform 0.12s ease;
    }

    /* FAB */
    .fab {
      position: fixed;
      bottom: calc(var(--spacing-base) * 10);
      right: calc(var(--spacing-base) * 2);
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, var(--vivid-magenta), var(--soft-pink));
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 16px rgba(227, 61, 122, 0.4);
      transition: all 0.12s ease;
      z-index: 99;
    }

    .fab:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 24px rgba(227, 61, 122, 0.6);
    }

    .fab-icon {
      width: 24px;
      height: 24px;
    }

    /* Modal Overlay */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      z-index: 200;
      animation: fadeIn 0.3s ease;
    }

    .modal-overlay.active {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: calc(var(--spacing-base) * 2);
    }

    .modal-content {
      width: 100%;
      max-width: 500px;
      background: var(--bg-panel);
      border-radius: var(--radius-md);
      padding: calc(var(--spacing-base) * 3);
      border: 1px solid rgba(255, 255, 255, 0.08);
      position: relative;
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: calc(var(--spacing-base) * 3);
    }

    .modal-title {
      font-size: 20px;
      font-weight: 700;
    }

    .close-btn {
      width: 32px;
      height: 32px;
      background: rgba(255, 255, 255, 0.05);
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.12s ease;
    }

    .close-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: scale(1.1);
    }

    .close-icon {
      width: 16px;
      height: 16px;
    }

    .composer-form {
      display: flex;
      flex-direction: column;
      gap: calc(var(--spacing-base) * 2);
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: calc(var(--spacing-base) * 1);
    }

    .form-label {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .form-input,
    .form-textarea {
      width: 100%;
      padding: calc(var(--spacing-base) * 1.5);
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-sm);
      color: var(--white);
      font-size: 14px;
      font-family: inherit;
      transition: all 0.12s ease;
    }

    .form-input:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--electric-blue);
      background: rgba(255, 255, 255, 0.08);
    }

    .form-textarea {
      min-height: 120px;
      resize: vertical;
    }

    .submit-btn {
      padding: calc(var(--spacing-base) * 2);
      background: linear-gradient(135deg, var(--deep-purple), var(--vivid-magenta));
      border: none;
      border-radius: var(--radius-sm);
      color: var(--white);
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.12s ease;
    }

    .submit-btn:hover {
      transform: scale(1.02);
      box-shadow: 0 4px 16px rgba(91, 46, 138, 0.4);
    }

    /* Browser Frame Modal */
    .browser-frame {
      width: 100%;
      height: 70%;
      background: var(--bg-panel);
      border-radius: var(--radius-md);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .browser-header {
      display: flex;
      align-items: center;
      gap: calc(var(--spacing-base) * 1);
      padding: calc(var(--spacing-base) * 1.5);
      background: rgba(255, 255, 255, 0.03);
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    }

    .browser-dots {
      display: flex;
      gap: calc(var(--spacing-base) * 0.75);
    }

    .browser-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--text-secondary);
    }

    .browser-url {
      flex: 1;
      padding: calc(var(--spacing-base) * 0.75) calc(var(--spacing-base) * 1.5);
      background: rgba(255, 255, 255, 0.05);
      border-radius: var(--radius-xs);
      font-size: 12px;
      color: var(--text-secondary);
    }

    .browser-content {
      flex: 1;
      overflow-y: auto;
      padding: calc(var(--spacing-base) * 3);
    }

    /* Task Board Styles */
    .task-board-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: calc(var(--spacing-base) * 2);
      padding: calc(var(--spacing-base) * 2);
      background: var(--bg-panel);
      border-radius: var(--radius-md);
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .task-counter {
      display: flex;
      align-items: center;
      gap: calc(var(--spacing-base) * 1);
      font-size: 14px;
    }

    .counter-label {
      color: var(--text-secondary);
    }

    .counter-value {
      font-weight: 700;
      color: var(--electric-blue);
    }

    .new-task-btn {
      display: flex;
      align-items: center;
      gap: calc(var(--spacing-base) * 1);
      padding: calc(var(--spacing-base) * 1) calc(var(--spacing-base) * 2);
      background: linear-gradient(135deg, var(--deep-purple), var(--vivid-magenta));
      border: none;
      border-radius: var(--radius-sm);
      color: var(--white);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.12s ease;
    }

    .new-task-btn:hover {
      transform: scale(1.05);
    }

    .platform-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .platform-icon.youtube {
      color: #FF0000;
    }

    .platform-icon.telegram {
      color: #0088cc;
    }

    .platform-icon.website {
      color: #4AA3FF;
    }

    .platform-icon.whatsapp {
      color: #25D366;
    }

    .task-header {
      display: flex;
      gap: calc(var(--spacing-base) * 1.5);
      margin-bottom: calc(var(--spacing-base) * 2);
    }

    .task-progress {
      margin-top: calc(var(--spacing-base) * 1);
      display: flex;
      flex-direction: column;
      gap: calc(var(--spacing-base) * 0.5);
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--electric-blue), var(--soft-pink));
      border-radius: 10px;
      transition: width 0.3s ease;
    }

    .progress-text {
      font-size: 10px;
      color: var(--text-secondary);
    }

    /* Watch & Earn Styles */
    .watch-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: calc(var(--spacing-base) * 2);
      padding: calc(var(--spacing-base) * 2);
      background: var(--bg-panel);
      border-radius: var(--radius-md);
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .daily-limit {
      display: flex;
      align-items: center;
      gap: calc(var(--spacing-base) * 1);
      font-size: 14px;
      color: var(--text-secondary);
    }

    .cleanup-btn {
      display: flex;
      align-items: center;
      gap: calc(var(--spacing-base) * 0.75);
      padding: calc(var(--spacing-base) * 1) calc(var(--spacing-base) * 1.5);
      background: rgba(227, 61, 122, 0.15);
      border: 1px solid rgba(227, 61, 122, 0.3);
      border-radius: var(--radius-sm);
      color: var(--vivid-magenta);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.12s ease;
    }

    .cleanup-btn:hover {
      background: rgba(227, 61, 122, 0.25);
      transform: scale(1.05);
    }

    .video-advertiser {
      display: flex;
      align-items: center;
      gap: calc(var(--spacing-base) * 0.75);
      margin-bottom: calc(var(--spacing-base) * 1);
      font-size: 11px;
      color: var(--text-secondary);
    }

    .video-card.watched {
      opacity: 0.6;
      pointer-events: none;
    }

    .watched-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      animation: checkmarkPop 0.3s ease;
    }

    @keyframes checkmarkPop {
      0% { transform: translate(-50%, -50%) scale(0); }
      50% { transform: translate(-50%, -50%) scale(1.2); }
      100% { transform: translate(-50%, -50%) scale(1); }
    }

    .collected-badge {
      color: var(--electric-blue);
      font-weight: 600;
    }

    /* Composer Styles */
    .suggestions-popup {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      margin-top: calc(var(--spacing-base) * 0.5);
      background: var(--bg-panel);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-sm);
      padding: calc(var(--spacing-base) * 1);
      max-height: 150px;
      overflow-y: auto;
      z-index: 10;
    }

    .suggestion-item {
      padding: calc(var(--spacing-base) * 1);
      cursor: pointer;
      border-radius: var(--radius-xs);
      font-size: 14px;
      transition: all 0.12s ease;
    }

    .suggestion-item:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .media-attach-area {
      display: flex;
      gap: calc(var(--spacing-base) * 1.5);
    }

    .attach-btn {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: calc(var(--spacing-base) * 1);
      padding: calc(var(--spacing-base) * 2);
      background: rgba(255, 255, 255, 0.05);
      border: 1px dashed rgba(255, 255, 255, 0.2);
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.12s ease;
    }

    .attach-btn:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: var(--electric-blue);
      color: var(--white);
    }

    .reward-type-selector {
      display: flex;
      gap: calc(var(--spacing-base) * 1);
    }

    .reward-option {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: calc(var(--spacing-base) * 1.5);
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.12s ease;
      font-size: 12px;
      font-weight: 600;
    }

    .reward-option:has(input:checked) {
      background: rgba(74, 163, 255, 0.2);
      border-color: var(--electric-blue);
      color: var(--electric-blue);
    }

    .reward-option input {
      display: none;
    }

    .reward-preview {
      padding: calc(var(--spacing-base) * 2);
      background: rgba(255, 255, 255, 0.02);
      border-radius: var(--radius-sm);
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .preview-label {
      font-size: 10px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: calc(var(--spacing-base) * 1);
    }

    .preview-card {
      background: var(--bg-dark);
      border-radius: var(--radius-xs);
      padding: calc(var(--spacing-base) * 1);
    }

    /* Profile Styles */
    .profile-actions {
      display: flex;
      gap: calc(var(--spacing-base) * 1.5);
      width: 100%;
      margin-top: calc(var(--spacing-base) * 2);
    }

    .profile-action-btn {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: calc(var(--spacing-base) * 1);
      padding: calc(var(--spacing-base) * 1.5);
      border: none;
      border-radius: var(--radius-sm);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.12s ease;
    }

    .profile-action-btn.primary {
      background: linear-gradient(135deg, var(--deep-purple), var(--vivid-magenta));
      color: var(--white);
    }

    .profile-action-btn.primary:hover {
      transform: scale(1.02);
    }

    .profile-action-btn.secondary {
      background: rgba(255, 255, 255, 0.05);
      color: var(--text-secondary);
      border: 1px solid rgba(255, 255, 255, 0.1);
      opacity: 0.5;
      cursor: not-allowed;
    }

    .profile-tabs {
      display: flex;
      gap: calc(var(--spacing-base) * 1);
      background: var(--bg-panel);
      padding: calc(var(--spacing-base) * 1);
      border-radius: var(--radius-md);
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .profile-tab {
      flex: 1;
      padding: calc(var(--spacing-base) * 1.5);
      background: transparent;
      border: none;
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .profile-tab.active {
      background: rgba(74, 163, 255, 0.15);
      color: var(--electric-blue);
    }

    .profile-tab-content {
      margin-top: calc(var(--spacing-base) * 2);
    }

    .tab-pane {
      display: none;
    }

    .tab-pane.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    .activity-item,
    .transaction-item {
      display: flex;
      align-items: center;
      gap: calc(var(--spacing-base) * 1.5);
      padding: calc(var(--spacing-base) * 2);
      background: var(--bg-panel);
      border-radius: var(--radius-sm);
      border: 1px solid rgba(255, 255, 255, 0.06);
      margin-bottom: calc(var(--spacing-base) * 1.5);
    }

    .activity-icon,
    .transaction-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      font-weight: 700;
    }

    .activity-icon.completed {
      background: rgba(74, 163, 255, 0.2);
      color: var(--electric-blue);
    }

    .transaction-icon.earn {
      background: rgba(74, 163, 255, 0.2);
      color: var(--electric-blue);
    }

    .transaction-icon.spend {
      background: rgba(227, 61, 122, 0.2);
      color: var(--vivid-magenta);
    }

    .activity-details,
    .transaction-details {
      flex: 1;
    }

    .activity-title,
    .transaction-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .activity-time,
    .transaction-time {
      font-size: 11px;
      color: var(--text-secondary);
    }

    .activity-reward,
    .transaction-amount {
      font-size: 16px;
      font-weight: 700;
    }

    .activity-reward,
    .transaction-amount.earn {
      color: var(--gcoin-gold);
    }

    .transaction-amount.spend {
      color: var(--vivid-magenta);
    }

    .wallet-balance-card {
      padding: calc(var(--spacing-base) * 3);
      background: linear-gradient(135deg, rgba(91, 46, 138, 0.3), rgba(74, 163, 255, 0.3));
      border-radius: var(--radius-md);
      border: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: calc(var(--spacing-base) * 2);
      text-align: center;
    }

    .wallet-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: calc(var(--spacing-base) * 1);
    }

    .wallet-amount {
      font-size: 32px;
      font-weight: 700;
      color: var(--gcoin-gold);
      margin-bottom: calc(var(--spacing-base) * 2);
    }

    .wallet-trend {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: calc(var(--spacing-base) * 1);
    }

    /* Timer Modal Styles */
    .timer-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: calc(var(--spacing-base) * 3);
      padding: calc(var(--spacing-base) * 4) 0;
    }

    .timer-circle {
      position: relative;
      width: 150px;
      height: 150px;
    }

    .timer-svg {
      transform: rotate(-90deg);
    }

    .timer-circle-bg {
      fill: none;
      stroke: rgba(255, 255, 255, 0.1);
      stroke-width: 8;
    }

    .timer-circle-progress {
      fill: none;
      stroke: url(#timer-gradient);
      stroke-width: 8;
      stroke-linecap: round;
      transition: stroke-dashoffset 1s linear;
    }

    .timer-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 36px;
      font-weight: 700;
      color: var(--white);
    }

    .timer-label {
      font-size: 14px;
      color: var(--text-secondary);
      text-align: center;
    }

    .claim-reward-btn {
      padding: calc(var(--spacing-base) * 2) calc(var(--spacing-base) * 4);
      background: linear-gradient(135deg, var(--gcoin-gold), #FFD87A);
      border: none;
      border-radius: var(--radius-sm);
      color: var(--bg-dark);
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.12s ease;
      animation: pulse 2s ease-in-out infinite;
    }

    .claim-reward-btn:hover {
      transform: scale(1.05);
    }

    /* Coin Animation */
    @keyframes coinFly {
      0% {
        transform: translate(0, 0) scale(1);
        opacity: 1;
      }
      50% {
        transform: translate(-100px, -150px) scale(1.5);
        opacity: 0.8;
      }
      100% {
        transform: translate(-200px, -250px) scale(0.5);
        opacity: 0;
      }
    }

    .coin-animation {
      position: fixed;
      pointer-events: none;
      z-index: 1000;
      animation: coinFly 0.6s ease-out forwards;
    }

    /* Like Heart Animation */
    @keyframes heartPop {
      0% {
        transform: scale(0.6);
      }
      50% {
        transform: scale(1.15);
      }
      100% {
        transform: scale(1);
      }
    }

    .action-btn.liked .action-icon {
      animation: heartPop 0.3s ease;
    }

    @keyframes sparkle {
      0% {
        transform: translate(0, 0) scale(0);
        opacity: 1;
      }
      100% {
        transform: translate(var(--tx), var(--ty)) scale(1);
        opacity: 0;
      }
    }

    .sparkle {
      position: absolute;
      width: 8px;
      height: 8px;
      background: var(--vivid-magenta);
      border-radius: 50%;
      animation: sparkle 0.6s ease-out forwards;
    }

    @media (min-width: 768px) {
      .app-container {
        max-width: 430px;
        margin: 0 auto;
      }

      .watch-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      }
    /* ---- Composer modal / large image / scroll fixes ---- */
.modal-content {
  max-height: calc(100vh - 120px);
  overflow-y: auto;
  -webkit-overflow-scrolling: touch; /* smooth native scrolling on mobile */
  -ms-overflow-style: -ms-autohiding-scrollbar;
}

/* make composer contents scroll safely and keep header visible */
#composer-modal .modal-content {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* attachment preview styling (keeps large image contained) */
.attachment-preview img,
.attachment-preview video {
  max-width: 100%;
  height: auto;
  max-height: 50vh;
  object-fit: contain;
  display: block;
  border-radius: 8px;
}

/* small cancel button alignment */
.modal-header .close-btn { z-index: 3; }

/* make task board social icons responsive and prevent horizontal overflow */
.task-board-header,
.task-list {
  box-sizing: border-box;
  width: 100%;
}

/* ensure task-header wraps on small screens */
.task-header {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  align-items: flex-start;
}

/* limit platform icon size and make them flexible so they form rows on mobile */
.platform-icon {
  min-width: 72px;
  max-width: 120px;
  width: calc(33.333% - 12px);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 8px;
  box-sizing: border-box;
}

/* ensure platform icons do not cause horizontal scroll in small screens */
@media (max-width: 768px) {
  .platform-icon { width: calc(50% - 12px); } /* 2 columns on narrow phones */
}
@media (min-width: 769px) and (max-width: 1024px) {
  .platform-icon { width: calc(33.333% - 12px); } /* 3 columns on tablets */
}
@media (min-width: 1025px) {
  .platform-icon { width: 120px; } /* fix size on desktop */
}

/* a responsive grid for explicit lists (if present) */
.social-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
  gap: 12px;
  width: 100%;
  box-sizing: border-box;
}

/* comment area inside post card */
.post-card .comment-area { margin-top: 12px; display: none; gap: 8px; align-items:center; }
.post-card .comment-area .form-input { flex: 1; }

/* small polish to avoid body scrolling when modal visible (optional) */
.modal-overlay.active {
  touch-action: none;
  }
/* Task scroller chips (keeps mobile behavior smooth) */
.social-scroll {
  display:flex;
  gap:12px;
  padding:8px 6px;
  overflow-x:auto;
  overflow-y:hidden;
  -webkit-overflow-scrolling:touch;
  scroll-snap-type:x proximity;
  overscroll-behavior-x: contain;
  box-sizing:border-box;
}
.social-scroll .platform-chip{
  scroll-snap-align:start;
  flex:0 0 auto;
  min-width:92px;
  max-width:140px;
  padding:8px 12px;
  border-radius:999px;
  background:rgba(255,255,255,0.02);
  color:var(--text-secondary);
  display:inline-flex;
  gap:8px;
  align-items:center;
  justify-content:center;
  font-weight:600;
  cursor:pointer;
  border:none;
}
.platform-chip[aria-pressed="true"],
.platform-chip.active{
  background:linear-gradient(135deg,var(--deep-purple),var(--vivid-magenta));
  color:var(--white);
}

/* ensure platform-icon (inside .task-header) wraps nicely */
.task-header { flex-wrap:wrap; align-items:flex-start; gap:12px; }

/* make platform-icon used in scroller not influence layout */
.social-scroll .chip-icon{ width:28px; height:28px; display:inline-flex; align-items:center; justify-content:center; }

/* keep main content vertical scrolling stable */
.main-content { overscroll-behavior: contain; }

/* small scrollbar polish */
.social-scroll::-webkit-scrollbar{ height:8px; }
.social-scroll::-webkit-scrollbar-thumb{ background:rgba(255,255,255,0.06); border-radius:8px; }


     </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="app-container"><!-- Header -->
   <header class="app-header">
    <div class="logo-section">
     <svg class="logo-icon" viewbox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="32" height="32" rx="8" fill="url(#logo-gradient)" /> <path d="M10 16L14 20L22 12" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" /> <defs>
       <lineargradient id="logo-gradient" x1="0" y1="0" x2="32" y2="32">
        <stop stop-color="#5B2E8A" />
        <stop offset="1" stop-color="#E33D7A" />
       </lineargradient>
      </defs>
     </svg>
     <h1 class="app-title" id="app-title">GainGrid</h1>
    </div>
    <div class="balance-chip">
     <svg class="coin-icon" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="10" r="9" fill="#FFC857" stroke="#FFD87A" stroke-width="1" /> <text x="10" y="14" text-anchor="middle" fill="#0B0B0D" font-size="12" font-weight="700">
       G
      </text>
     </svg><span class="balance-text" id="balance-text">2,847</span>
    </div>
   </header><!-- Main Content -->
   <main class="main-content"><!-- GridHome / Feed -->
    <section class="screen active" id="gridhome">
     <div class="feed-container" id="feed-container">
      <article class="post-card">
       <div class="post-header">
        <div class="avatar">
         JD
        </div>
        <div class="post-meta">
         <div class="poster-name">
          John Doe
         </div>
         <div class="post-time">
          2 hours ago
         </div>
        </div>
       </div>
       <p class="post-content">Check out this amazing opportunity to earn G-coins! Join our community and start earning today. Limited spots available! ðŸš€</p>
       <div class="post-media"><span>Image Content</span>
       </div>
       <div class="earnings-bar"><span class="earnings-label">ðŸ’° Earn up to 50 G-coins</span>
       </div>
       <div class="post-actions"><button class="action-btn" onclick="handleLike(this)">
         <svg class="action-icon" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 14L2.5 8.5C1.5 7.5 1.5 5.8 2.5 4.8C3.5 3.8 5.2 3.8 6.2 4.8L8 6.6L9.8 4.8C10.8 3.8 12.5 3.8 13.5 4.8C14.5 5.8 14.5 7.5 13.5 8.5L8 14Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
         </svg><span>Like</span> </button> <button class="action-btn">
         <svg class="action-icon" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14 2L8 8L14 2ZM14 2L9.5 14L8 8L2 6.5L14 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
         </svg><span>Visit</span> </button> <button class="action-btn" onclick="openCommentsForPost(this)">
         <svg class="action-icon" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14 11C14 11.5 13.5 12 13 12H4L2 14V3C2 2.5 2.5 2 3 2H13C13.5 2 14 2.5 14 3V11Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
         </svg><span>Comment</span> </button>
       </div>
      </article>
      <article class="post-card">
       <div class="post-header">
        <div class="avatar">
         SK
        </div>
        <div class="post-meta">
         <div class="poster-name">
          Sarah Kim
         </div>
         <div class="post-time">
          5 hours ago
         </div>
        </div>
       </div>
       <p class="post-content">New task alert! Complete this survey and earn instant rewards. Takes only 5 minutes! ðŸ“‹</p>
       <div class="earnings-bar"><span class="earnings-label">ðŸ’° Earn up to 30 G-coins</span>
       </div>
       <div class="post-actions"><button class="action-btn" onclick="handleLike(this)">
         <svg class="action-icon" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 14L2.5 8.5C1.5 7.5 1.5 5.8 2.5 4.8C3.5 3.8 5.2 3.8 6.2 4.8L8 6.6L9.8 4.8C10.8 3.8 12.5 3.8 13.5 4.8C14.5 5.8 14.5 7.5 13.5 8.5L8 14Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
         </svg><span>Like</span> </button> <button class="action-btn">
         <svg class="action-icon" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14 2L8 8L14 2ZM14 2L9.5 14L8 8L2 6.5L14 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
         </svg><span>Join</span> </button> <button class="action-btn" onclick="openCommentsForPost(this)">
         <svg class="action-icon" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14 11C14 11.5 13.5 12 13 12H4L2 14V3C2 2.5 2.5 2 3 2H13C13.5 2 14 2.5 14 3V11Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
         </svg><span>Comment</span> </button>
       </div>
      </article>
      <article class="post-card">
       <div class="post-header">
        <div class="avatar">
         MP
        </div>
        <div class="post-meta">
         <div class="poster-name">
          Mike Peters
         </div>
         <div class="post-time">
          1 day ago
         </div>
        </div>
       </div>
       <p class="post-content">Watch this short video and get rewarded! No sign-up required. Just watch and earn! ðŸŽ¥</p>
       <div class="post-media"><span>Video Thumbnail</span>
       </div>
       <div class="earnings-bar"><span class="earnings-label">ðŸ’° Earn up to 25 G-coins</span>
       </div>
       <div class="post-actions"><button class="action-btn" onclick="handleLike(this)">
         <svg class="action-icon" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 14L2.5 8.5C1.5 7.5 1.5 5.8 2.5 4.8C3.5 3.8 5.2 3.8 6.2 4.8L8 6.6L9.8 4.8C10.8 3.8 12.5 3.8 13.5 4.8C14.5 5.8 14.5 7.5 13.5 8.5L8 14Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
         </svg><span>Like</span> </button> <button class="action-btn" onclick="openVideoModal('Tech Review 2024','0:45',25,this)">
         <svg class="action-icon" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14 2L8 8L14 2ZM14 2L9.5 14L8 8L2 6.5L14 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
         </svg><span>Watch</span> </button> <button class="action-btn" onclick="openCommentsForPost(this)">
         <svg class="action-icon" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14 11C14 11.5 13.5 12 13 12H4L2 14V3C2 2.5 2.5 2 3 2H13C13.5 2 14 2.5 14 3V11Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
         </svg><span>Comment</span> </button>
       </div>
      </article>
     </div> 

<section class="screen" id="tasks">
  <div class="task-board-header">
    <div class="task-counter">
      <span class="counter-label">Tasks today:</span>
      <span class="counter-value" id="task-counter">6/20</span>
    </div>
    <button class="new-task-btn" onclick="openNewTaskModal()">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 3V13M3 8H13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      <span>New Task</span>
    </button>
  </div>

  <!-- Horizontal platforms scroller (fixed row) -->
  <div id="task-platforms" class="social-scroll" role="toolbar" aria-label="Task platforms">
    <button class="platform-chip" data-platform="" aria-pressed="true"><span class="chip-label">All</span></button>
    <button class="platform-chip" data-platform="telegram"><span class="chip-icon telegram" aria-hidden="true">TG</span><span class="chip-label">Telegram</span></button>
    <button class="platform-chip" data-platform="instagram"><span class="chip-icon instagram" aria-hidden="true">IG</span><span class="chip-label">Instagram</span></button>
    <button class="platform-chip" data-platform="youtube"><span class="chip-icon youtube" aria-hidden="true">YT</span><span class="chip-label">YouTube</span></button>
    <button class="platform-chip" data-platform="facebook"><span class="chip-icon facebook" aria-hidden="true">FB</span><span class="chip-label">Facebook</span></button>
    <button class="platform-chip" data-platform="tiktok"><span class="chip-icon tiktok" aria-hidden="true">TT</span><span class="chip-label">TikTok</span></button>
    <button class="platform-chip" data-platform="discord"><span class="chip-icon discord" aria-hidden="true">DC</span><span class="chip-label">Discord</span></button>
    <button class="platform-chip" data-platform="website"><span class="chip-icon website" aria-hidden="true">WEB</span><span class="chip-label">Website</span></button>
    <button class="platform-chip" data-platform="whatsapp"><span class="chip-icon whatsapp" aria-hidden="true">WA</span><span class="chip-label">WhatsApp</span></button>
    <button class="platform-chip" data-platform="x"><span class="chip-icon x" aria-hidden="true">X</span><span class="chip-label">X</span></button>
  </div>

  <!-- Task cards (keep structure; data-platform attribute used for filtering) -->
  <div class="task-list" id="task-list">
    <article class="task-card" data-platform="youtube" data-task-url="https://otieu.com/4/10176113">
      <div class="task-header">
        <div class="platform-icon youtube"></div>
        <div class="task-info">
          <h3 class="task-title">Watch YouTube Video</h3>
          <p class="task-description">Watch full video and like. Stay 02:30 for reward.</p>
          <div class="task-progress">
            <div class="progress-bar"><div class="progress-fill" style="width:0%"></div></div>
            <span class="progress-text">Not started</span>
          </div>
        </div>
        <div class="task-reward"><svg width="16" height="16" viewBox="0 0 20 20"><circle cx="10" cy="10" r="9" fill="#FFC857"/><text x="10" y="14" text-anchor="middle" fill="#0B0B0D" font-size="10" font-weight="700">G</text></svg><span>50</span></div>
      </div>
      <div class="task-footer">
        <button class="task-btn primary" onclick="openTaskModal('Watch YouTube Video', this)">Start Task</button>
        <button class="task-btn secondary">Details</button>
      </div>
    </article>

    <article class="task-card" data-platform="telegram" data-task-url="https://otieu.com/4/10176184">
      <div class="task-header">
        <div class="platform-icon telegram"></div>
        <div class="task-info">
          <h3 class="task-title">Join Telegram Channel</h3>
          <p class="task-description">Join channel and stay active. Stay 00:45 for reward.</p>
          <div class="task-progress">
            <div class="progress-bar"><div class="progress-fill" style="width:0%"></div></div>
            <span class="progress-text">Not started</span>
          </div>
        </div>
        <div class="task-reward"><svg width="16" height="16" viewBox="0 0 20 20"><circle cx="10" cy="10" r="9" fill="#FFC857"/><text x="10" y="14" text-anchor="middle" fill="#0B0B0D" font-size="10" font-weight="700">G</text></svg><span>35</span></div>
      </div>
      <div class="task-footer">
        <button class="task-btn primary" onclick="openTaskModal('Join Telegram Channel', this)">Start Task</button>
        <button class="task-btn secondary">Details</button>
      </div>
    </article>

    <article class="task-card" data-platform="website" data-task-url="https://otieu.com/4/10176114">
      <div class="task-header">
        <div class="platform-icon website"></div>
        <div class="task-info">
          <h3 class="task-title">Visit Website &amp; Sign Up</h3>
          <p class="task-description">Visit partner site and complete registration. Stay 01:15 for reward.</p>
          <div class="task-progress">
            <div class="progress-bar"><div class="progress-fill" style="width:0%"></div></div>
            <span class="progress-text">Not started</span>
          </div>
        </div>
        <div class="task-reward"><svg width="16" height="16" viewBox="0 0 20 20"><circle cx="10" cy="10" r="9" fill="#FFC857"/><text x="10" y="14" text-anchor="middle" fill="#0B0B0D" font-size="10" font-weight="700">G</text></svg><span>30</span></div>
      </div>
      <div class="task-footer">
        <button class="task-btn primary" onclick="openTaskModal('Visit Website & Sign Up', this)">Start Task</button>
        <button class="task-btn secondary">Details</button>
      </div>
    </article>

    <article class="task-card" data-platform="whatsapp" data-task-url="https://otieu.com/4/10176185">
      <div class="task-header">
        <div class="platform-icon whatsapp"></div>
        <div class="task-info">
          <h3 class="task-title">Join WhatsApp Group</h3>
          <p class="task-description">Join community group and interact. Stay 01:00 for reward.</p>
          <div class="task-progress">
            <div class="progress-bar"><div class="progress-fill" style="width:0%"></div></div>
            <span class="progress-text">Not started</span>
          </div>
        </div>
        <div class="task-reward"><svg width="16" height="16" viewBox="0 0 20 20"><circle cx="10" cy="10" r="9" fill="#FFC857"/><text x="10" y="14" text-anchor="middle" fill="#0B0B0D" font-size="10" font-weight="700">G</text></svg><span>100</span></div>
      </div>
      <div class="task-footer">
        <button class="task-btn primary" onclick="openTaskModal('Join WhatsApp Group', this)">Start Task</button>
        <button class="task-btn secondary">Progress: 0/3</button>
      </div>
    </article>
  </div>
</section>
<!-- ===== end Task Board ===== -->
  </section><!-- Watch & Earn -->
    <section class="screen" id="watch">
     <div class="watch-header">
      <div class="daily-limit">
       <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2" /> <path d="M10 5V10L13 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
       </svg><span>Daily Ads: <strong id="ads-counter">8/15</strong></span>
      </div><button class="cleanup-btn" onclick="cleanupWatchedAds()">
       <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 4H14M6 7V11M10 7V11M3 4L4 13C4 13.5 4.5 14 5 14H11C11.5 14 12 13.5 12 13L13 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
       </svg><span>Clean Up</span> </button>
     </div>
     <div class="watch-grid" id="watch-grid">
      <article class="video-card" data-watched="false" onclick="openVideoModal('Tech Review 2024', '0:45', 25, this)">
       <div class="video-thumbnail">
        <svg class="play-icon" viewbox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="24" cy="24" r="22" fill="rgba(255,255,255,0.9)" /> <path d="M19 16L32 24L19 32V16Z" fill="#0B0B0D" />
        </svg><span class="video-duration">0:45</span>
       </div>
       <div class="video-info">
        <div class="video-advertiser">
         <svg width="14" height="14" viewbox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="14" height="14" rx="3" fill="#4AA3FF" />
         </svg><span>TechBrand Co.</span>
        </div>
        <h3 class="video-title">Tech Review 2024</h3>
        <div class="video-meta"><span>Watch 0:45 Â· Earn</span> <span class="video-reward">+25 G-coins</span>
        </div>
       </div>
      </article>
      <article class="video-card" data-watched="false" onclick="openVideoModal('Crypto Market Update', '0:30', 30, this)">
       <div class="video-thumbnail">
        <svg class="play-icon" viewbox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="24" cy="24" r="22" fill="rgba(255,255,255,0.9)" /> <path d="M19 16L32 24L19 32V16Z" fill="#0B0B0D" />
        </svg><span class="video-duration">0:30</span>
       </div>
       <div class="video-info">
        <div class="video-advertiser">
         <svg width="14" height="14" viewbox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="14" height="14" rx="3" fill="#E33D7A" />
         </svg><span>CryptoExchange</span>
        </div>
        <h3 class="video-title">Crypto Market Update</h3>
        <div class="video-meta"><span>Watch 0:30 Â· Earn</span> <span class="video-reward">+30 G-coins</span>
        </div>
       </div>
      </article>
      <article class="video-card watched" data-watched="true">
       <div class="video-thumbnail">
        <div class="watched-overlay">
         <svg width="40" height="40" viewbox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="20" cy="20" r="18" fill="rgba(74, 163, 255, 0.9)" /> <path d="M12 20L17 25L28 14" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
         </svg>
        </div><span class="video-duration">0:25</span>
       </div>
       <div class="video-info">
        <div class="video-advertiser">
         <svg width="14" height="14" viewbox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="14" height="14" rx="3" fill="#5B2E8A" />
         </svg><span>GameStore</span>
        </div>
        <h3 class="video-title">Gaming News Today</h3>
        <div class="video-meta"><span class="collected-badge">âœ“ Collected</span> <span class="video-reward">+20 G-coins</span>
        </div>
       </div>
      </article>
      <article class="video-card" data-watched="false" onclick="openVideoModal('Product Launch Event', '0:55', 35, this)">
       <div class="video-thumbnail">
        <svg class="play-icon" viewbox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="24" cy="24" r="22" fill="rgba(255,255,255,0.9)" /> <path d="M19 16L32 24L19 32V16Z" fill="#0B0B0D" />
        </svg><span class="video-duration">0:55</span>
       </div>
       <div class="video-info">
        <div class="video-advertiser">
         <svg width="14" height="14" viewbox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="14" height="14" rx="3" fill="#FF98BD" />
         </svg><span>Fashion Brand</span>
        </div>
        <h3 class="video-title">Product Launch Event</h3>
        <div class="video-meta"><span>Watch 0:55 Â· Earn</span> <span class="video-reward">+35 G-coins</span>
        </div>
       </div>
      </article>
     </div>
    </section><!-- Profile -->
    <section class="screen" id="profile">
     <div class="profile-section">
      <div class="profile-header">
       <div class="profile-avatar">
        JD
       </div>
       <h2 class="profile-name">John Doe</h2>
       <p class="profile-username">@johndoe</p>
       <div class="profile-actions"><button class="profile-action-btn primary">
         <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11 2H13C13.5 2 14 2.5 14 3V5M2 11V13C2 13.5 2.5 14 3 14H5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" /> <circle cx="8" cy="8" r="3" stroke="currentColor" stroke-width="1.5" />
         </svg><span>Edit Profile</span> </button> <button class="profile-action-btn secondary" title="Withdraw (KYC Required)">
         <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 2V8M8 8L11 5M8 8L5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" /> <path d="M2 10V12C2 13 2.5 14 4 14H12C13.5 14 14 13 14 12V10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
         </svg></button>
       </div>
       <div class="profile-stats">
        <div class="stat-item">
         <div class="stat-value" id="stat-gcoins">
          2,847
         </div>
         <div class="stat-label">
          G-Coins
         </div>
        </div>
        <div class="stat-item">
         <div class="stat-value">
          5,293
         </div>
         <div class="stat-label">
          Total Earned
         </div>
        </div>
        <div class="stat-item">
         <div class="stat-value">
          124
         </div>
         <div class="stat-label">
          Tasks Done
         </div>
        </div>
       </div>
      </div>
      <div class="profile-tabs"><button class="profile-tab active" onclick="switchProfileTab('activity', event)">Activity</button> <button class="profile-tab" onclick="switchProfileTab('posts', event)">Posts</button> <button class="profile-tab" onclick="switchProfileTab('wallet', event)">Wallet</button>
      </div>
      <div class="profile-tab-content">
       <div class="tab-pane active" id="activity-tab">
        <div class="activity-item">
         <div class="activity-icon completed">
          <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 8L6 11L13 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
         </div>
         <div class="activity-details">
          <div class="activity-title">
           Completed YouTube Task
          </div>
          <div class="activity-time">
           2 hours ago
          </div>
         </div>
         <div class="activity-reward">
          +50
         </div>
        </div>
        <div class="activity-item">
         <div class="activity-icon completed">
          <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 8L6 11L13 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
         </div>
         <div class="activity-details">
          <div class="activity-title">
           Watched Ad - TechBrand Co.
          </div>
          <div class="activity-time">
           5 hours ago
          </div>
         </div>
         <div class="activity-reward">
          +25
         </div>
        </div>
        <div class="activity-item">
         <div class="activity-icon completed">
          <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 8L6 11L13 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
         </div>
         <div class="activity-details">
          <div class="activity-title">
           Joined Telegram Channel
          </div>
          <div class="activity-time">
           1 day ago
          </div>
         </div>
         <div class="activity-reward">
          +35
         </div>
        </div>
       </div>
       <div class="tab-pane" id="posts-tab">
        <p style="color: var(--text-secondary); text-align: center; padding: 32px 16px;">No posts yet. Create your first post!</p>
       </div>
       <div class="tab-pane" id="wallet-tab">
        <div class="wallet-balance-card">
         <div class="wallet-label">
          Current Balance
         </div>
         <div class="wallet-amount" id="wallet-amount">
          2,847 G-coins
         </div>
         <div class="wallet-trend">
          <svg width="80" height="30" viewbox="0 0 80 30" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0 25L10 20L20 22L30 15L40 18L50 10L60 12L70 5L80 8" stroke="#4AA3FF" stroke-width="2" fill="none" />
          </svg><span style="color: #4AA3FF; font-size: 12px; font-weight: 600;">â†‘ +12% this week</span>
         </div>
        </div>
        <div class="transaction-item">
         <div class="transaction-icon earn">
          +
         </div>
         <div class="transaction-details">
          <div class="transaction-title">
           Task Reward
          </div>
          <div class="transaction-time">
           2 hours ago
          </div>
         </div>
         <div class="transaction-amount earn">
          +50
         </div>
        </div>
        <div class="transaction-item">
         <div class="transaction-icon earn">
          +
         </div>
         <div class="transaction-details">
          <div class="transaction-title">
           Ad Watch Reward
          </div>
          <div class="transaction-time">
           5 hours ago
          </div>
         </div>
         <div class="transaction-amount earn">
          +25
         </div>
        </div>
        <div class="transaction-item">
         <div class="transaction-icon spend">
          -
         </div>
         <div class="transaction-details">
          <div class="transaction-title">
           Withdrawal
          </div>
          <div class="transaction-time">
           3 days ago
          </div>
         </div>
         <div class="transaction-amount spend">
          -500
         </div>
        </div>
       </div>
      </div>
      <div class="profile-menu"><button class="menu-item"> <span>Edit Profile</span>
        <svg class="menu-icon" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 16L14 10L8 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg></button> <button class="menu-item"> <span>Transaction History</span>
        <svg class="menu-icon" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 16L14 10L8 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg></button> <button class="menu-item"> <span>Referrals</span>
        <svg class="menu-icon" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 16L14 10L8 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg></button> <button class="menu-item"> <span>Settings</span>
        <svg class="menu-icon" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 16L14 10L8 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg></button> <button class="menu-item"> <span>Help &amp; Support</span>
        <svg class="menu-icon" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 16L14 10L8 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg></button>
      </div>
     </div>
    </section>
   </main><!-- Bottom Navigation -->
   <nav class="bottom-nav"><a href="#gridhome" class="nav-item active" onclick="switchScreen('gridhome', event)">
     <svg class="nav-icon" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /> <path d="M9 22V12H15V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
     </svg><span id="nav-feed-text">GridHome</span> </a> <a href="#tasks" class="nav-item" onclick="switchScreen('tasks', event)">
     <svg class="nav-icon" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 11L12 14L22 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /> <path d="M21 12V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
     </svg><span id="nav-tasks-text">Tasks</span> </a> <a href="#watch" class="nav-item" onclick="switchScreen('watch', event)">
     <svg class="nav-icon" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 3L19 12L5 21V3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
     </svg><span id="nav-watch-text">Watch</span> </a> <a href="#profile" class="nav-item" onclick="switchScreen('profile', event)">
     <svg class="nav-icon" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /> <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
     </svg><span id="nav-profile-text">Profile</span> </a>
   </nav><!-- FAB --> <button class="fab" onclick="openComposer()">
    <svg class="fab-icon" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 20H21" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" /> <path d="M16.5 3.49998C16.8978 3.10216 17.4374 2.87866 18 2.87866C18.2786 2.87866 18.5544 2.93353 18.8118 3.04014C19.0692 3.14674 19.303 3.303 19.5 3.49998C19.697 3.69697 19.8532 3.93082 19.9598 4.18819C20.0665 4.44556 20.1213 4.72141 20.1213 4.99998C20.1213 5.27856 20.0665 5.55441 19.9598 5.81178C19.8532 6.06915 19.697 6.303 19.5 6.49998L7 19L3 20L4 16L16.5 3.49998Z" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" />
    </svg></button> <!-- Composer Modal -->
   <div class="modal-overlay" id="composer-modal">
    <div class="modal-content">
     <div class="modal-header">
      <h2 class="modal-title">Create Post</h2><button class="close-btn" onclick="closeComposer()">
       <svg class="close-icon" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
       </svg></button>
     </div>
     <form class="composer-form" id="composer-form" onsubmit="handlePostSubmit(event)">
      <div class="form-group"><label class="form-label" for="post-content">Post Content</label> <textarea class="form-textarea" id="post-content" placeholder="What do you want to share? Use # for hashtags and @ for mentions" required oninput="handleComposerInput(event)"></textarea>
       <div class="suggestions-popup" id="suggestions-popup" style="display: none;"></div>
      </div>
      <div class="form-group"><label class="form-label">Attach Media (Optional)</label>
       <div class="media-attach-area"><button type="button" class="attach-btn" onclick="document.getElementById('file-input').click();">
         <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="2" width="16" height="16" rx="2" stroke="currentColor" stroke-width="1.5" /> <circle cx="7" cy="7" r="2" stroke="currentColor" stroke-width="1.5" /> <path d="M2 14L7 9L12 14M10 12L13 9L18 14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
         </svg><span>Image/Video</span> </button>
         <input type="file" id="file-input" accept="image/*,video/*" style="display:none" />
         </div>
         <div id="attachment-preview" style="margin-top:8px;"></div>
      </div>
      <div class="form-group"><label class="form-label">Reward Type</label>
       <div class="reward-type-selector"><label class="reward-option"> <input type="radio" name="reward-type" value="visit" checked onchange="updateRewardPreview()"> <span>Visit</span> </label> <label class="reward-option"> <input type="radio" name="reward-type" value="join" onchange="updateRewardPreview()"> <span>Join</span> </label> <label class="reward-option"> <input type="radio" name="reward-type" value="watch" onchange="updateRewardPreview()"> <span>Watch</span> </label>
       </div>
      </div>
      <div class="form-group"><label class="form-label" for="post-reward">Reward Amount (G-coins)</label> <input type="number" class="form-input" id="post-reward" placeholder="Enter reward amount" min="1" max="10000" value="25" required oninput="updateRewardPreview()">
      </div>
      <div class="reward-preview">
       <div class="preview-label">
        Preview:
       </div>
       <div class="preview-card">
        <div class="earnings-bar"><span class="earnings-label" id="preview-reward">ðŸ’° Earn up to 25 G-coins</span>
        </div>
       </div>
      </div><button type="submit" class="submit-btn">Publish Post</button>
     </form>
    </div>
   </div><!-- Task Modal -->
   <div class="modal-overlay" id="task-modal">
    <div class="browser-frame">
     <div class="browser-header">
      <div class="browser-dots">
       <div class="browser-dot"></div>
       <div class="browser-dot"></div>
       <div class="browser-dot"></div>
      </div>
      <div class="browser-url" id="browser-url">
       https://task.gaingrid.com
      </div><button class="close-btn" onclick="closeTaskModal()">
       <svg class="close-icon" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
       </svg></button>
     </div>
     <div class="browser-content" id="browser-content">
      <h2 class="modal-title" id="task-modal-title">Task Loading...</h2>
      <p style="color: var(--text-secondary); margin-top: 16px; line-height: 1.6;">This is a simulated task view. In the production version, this would load the actual task content in an iframe-style container. Complete the task steps to earn your G-coins reward!</p><button class="submit-btn" style="margin-top: 24px;" onclick="closeTaskModal()">Complete Task</button>
     </div>
    </div>
   </div><!-- Video Modal -->
   <div class="modal-overlay" id="video-modal">
    <div class="browser-frame">
     <div class="browser-header">
      <div class="browser-dots">
       <div class="browser-dot"></div>
       <div class="browser-dot"></div>
       <div class="browser-dot"></div>
      </div>
      <div class="browser-url">
       https://watch.gaingrid.com
      </div><button class="close-btn" onclick="closeVideoModal()">
       <svg class="close-icon" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
       </svg></button>
     </div>
     <div class="browser-content" id="video-browser-content">
      <h2 class="modal-title" id="video-modal-title">Video Loading...</h2>
      <div style="width: 100%; height: 250px; background: linear-gradient(135deg, rgba(91, 46, 138, 0.2), rgba(74, 163, 255, 0.2)); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 24px 0;">
       <svg width="64" height="64" viewbox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="24" cy="24" r="22" fill="rgba(255,255,255,0.9)" /> <path d="M19 16L32 24L19 32V16Z" fill="#0B0B0D" />
       </svg>
      </div>
      <p style="color: var(--text-secondary); line-height: 1.6;">This is a simulated video player. In the production version, this would play the actual video content. Watch the full video to earn your G-coins reward!</p><button class="submit-btn" style="margin-top: 24px;" onclick="closeVideoModal()">Claim Reward</button>
     </div>
    </div>
   </div>
  </div>

  <!-- libtl ad SDK (as requested) -->
  <script src='//libtl.com/sdk.js' data-zone='10274566' data-sdk='show_10274566'></script>
<script>
/* --- Screen switching + hash handling (paste into your page script) --- */
function switchScreen(screenId, event) {
  if (event && event.preventDefault) event.preventDefault();

  // remove active class from all screens
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));

  // show target screen
  var target = document.getElementById(screenId);
  if (target) target.classList.add('active');

  // nav items: if called from an element, mark it active; otherwise match by href
  try {
    // if called from an onclick on an <a> or .nav-item
    var src = event && (event.currentTarget || event.target);
    if (src) {
      document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
      // if the clicked element is inside anchor, find closest nav-item
      var navAncestor = src.closest ? src.closest('.nav-item') : null;
      if (navAncestor) navAncestor.classList.add('active');
      else {
        // fallback: find nav-item with matching href
        var byHref = document.querySelector('.nav-item[href="#' + screenId + '"]');
        if (byHref) byHref.classList.add('active');
      }
    }
  } catch (e) { /* non-blocking */ }

  // update URL hash without scrolling jump
  if (history && history.replaceState) {
    history.replaceState(null, '', '#' + screenId);
  } else {
    window.location.hash = screenId;
  }
}

/* restore screen when user navigates by hash (back/forward or direct link) */
window.addEventListener('hashchange', function () {
  var hash = window.location.hash.replace('#', '');
  if (!hash) return;
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  var tgt = document.getElementById(hash);
  if (tgt) tgt.classList.add('active');

  // update bottom nav active item
  document.querySelectorAll('.nav-item').forEach(item => {
    if (item.getAttribute('href') === '#' + hash) item.classList.add('active');
    else item.classList.remove('active');
  });
});

/* ensure initial hash on load is applied if present */
document.addEventListener('DOMContentLoaded', function () {
  var initial = window.location.hash.replace('#', '');
  if (initial) {
    var tgt = document.getElementById(initial);
    if (tgt) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      tgt.classList.add('active');
      // set nav active
      document.querySelectorAll('.nav-item').forEach(item => {
        if (item.getAttribute('href') === '#' + initial) item.classList.add('active');
        else item.classList.remove('active');
      });
    }
  }
});
</script>




  <!-- === Backend glue + UI script (integrated) === -->
  <script>
/* ========= GainGrid - Backend glue + UI helpers (replacement script) =========
   This script wires bot payloads, Base64 mapping, tasks, watch flows, publish requests,
   smartlink fallback, and calls bot callback_url with JSON payloads.
=========================================================================== */

/* ---------- Safe Base64 encode/decode (mirror bot) ---------- */
function safeBase64Encode(str){
  try {
    if (typeof btoa === 'function') return btoa(unescape(encodeURIComponent(str))).replace(/=+$/,'');
    if (typeof Buffer !== 'undefined') return Buffer.from(str,'utf8').toString('base64').replace(/=+$/,'');
  } catch(e){}
  var chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
  var out="", i=0;
  while(i<str.length){
    var c1 = str.charCodeAt(i++) & 0xff;
    if (i===str.length){ out += chars.charAt(c1>>2); out += chars.charAt((c1&3)<<4); out += "=="; break; }
    var c2 = str.charCodeAt(i++);
    if (i===str.length){ out += chars.charAt(c1>>2); out += chars.charAt(((c1&3)<<4)|((c2&240)>>4)); out += chars.charAt((c2&15)<<2); out += "="; break; }
    var c3 = str.charCodeAt(i++);
    out += chars.charAt(c1>>2);
    out += chars.charAt(((c1&3)<<4)|((c2&240)>>4));
    out += chars.charAt(((c2&15)<<2)|((c3&192)>>6));
    out += chars.charAt(c3 & 63);
  }
  return out;
}
function safeBase64Decode(b64){
  try{
    var padLen = (4 - (b64.length % 4)) % 4;
    for(var i=0;i<padLen;i++) b64 += '=';
    if (typeof atob === 'function') return decodeURIComponent(escape(atob(b64)));
    if (typeof Buffer !== 'undefined') return Buffer.from(b64,'base64').toString('utf8');
  } catch(e){}
  try { return decodeURIComponent(escape(window.atob(b64))); } catch(e){ console.warn('B64 decode failed', e); return null; }
}

/* ---------- Utilities ---------- */
function qsa(sel){ return Array.prototype.slice.call(document.querySelectorAll(sel)); }
function $(id){ return document.getElementById(id); }
function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g,function(m){return({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m]);}); }
function formatSeconds(sec){ var m=Math.floor(sec/60), s=sec%60; return (m<10?'0':'')+m+':'+(s<10?'0':'')+s; }
function todayKey(name){ var d=new Date(); return name+'_'+d.getFullYear()+'_'+(d.getMonth()+1)+'_'+d.getDate(); }
function getLs(k){ try { return JSON.parse(localStorage.getItem(k)||'null'); } catch(e){ return null; } }
function setLs(k,v){ localStorage.setItem(k, JSON.stringify(v)); }

/* ---------- PAGE CONTEXT ---------- */
var PAGE_CONTEXT = { callback_url: null, uid: null, last_bot_payload: null, api_key: null, allow_web_publish:false };
function generateApiKey(){ if(!PAGE_CONTEXT.api_key) { PAGE_CONTEXT.api_key = 'GG_'+Date.now()+'_'+Math.random().toString(36).slice(2,10); localStorage.setItem('ga_api_key', PAGE_CONTEXT.api_key); } return PAGE_CONTEXT.api_key || localStorage.getItem('ga_api_key'); }

/* ---------- Social SVG icons (3D-ish gradients) ---------- */
function svgYouTube(){ return '<svg width="28" height="28" viewBox="0 0 24 24" fill="none"><defs><linearGradient id="gyt" x1="0" x2="1"><stop offset="0" stop-color="#FF4C4C"/><stop offset="1" stop-color="#C90000"/></linearGradient></defs><rect x="1" y="4" width="22" height="16" rx="4" fill="url(#gyt)"></rect><path d="M10 8v8l6-4-6-4z" fill="#fff"></path></svg>'; }
function svgTelegram(){ return '<svg width="28" height="28" viewBox="0 0 24 24" fill="none"><defs><linearGradient id="gtg" x1="0" x2="1"><stop offset="0" stop-color="#4AA3FF"/><stop offset="1" stop-color="#2A73D9"/></linearGradient></defs><rect x="1" y="1" width="22" height="22" rx="5" fill="url(#gtg)"></rect><path d="M6 12l10-4-6 10 1-6-5-2z" fill="#fff"></path></svg>'; }
function svgWhatsApp(){ return '<svg width="28" height="28" viewBox="0 0 24 24" fill="none"><defs><linearGradient id="gw" x1="0" x2="1"><stop offset="0" stop-color="#25D366"/><stop offset="1" stop-color="#10A37F"/></linearGradient></defs><rect x="1" y="1" width="22" height="22" rx="5" fill="url(#gw)"></rect><path d="M7 14l1.5 4L16 12l-.8-1.3L9.5 14 7 8l1 6z" fill="#fff" opacity="0.95"/></svg>'; }
function svgInstagram(){ return '<svg width="28" height="28" viewBox="0 0 24 24" fill="none"><defs><linearGradient id="gi" x1="0" x2="1"><stop offset="0" stop-color="#FF9A66"/><stop offset="0.5" stop-color="#FF3D7C"/><stop offset="1" stop-color="#6A5AFF"/></linearGradient></defs><rect x="1" y="1" width="22" height="22" rx="6" fill="url(#gi)"></rect><circle cx="12" cy="12" r="3.5" fill="#fff"></circle><circle cx="17.5" cy="6.5" r="1" fill="#fff"></circle></svg>'; }
function svgTikTok(){ return '<svg width="28" height="28" viewBox="0 0 24 24" fill="none"><defs><linearGradient id="gtk" x1="0" x2="1"><stop offset="0" stop-color="#00F2EA"/><stop offset="1" stop-color="#FF004F"/></linearGradient></defs><rect x="1" y="1" width="22" height="22" rx="6" fill="transparent"></rect><path d="M15 8v6a3 3 0 1 1-3-3V6h2c0 0 0 2 4 2v3s-1 .5-0 .5z" fill="url(#gtk)"></path></svg>'; }
function svgX(){ return '<svg width="28" height="28" viewBox="0 0 24 24"><rect x="1" y="1" width="22" height="22" rx="5" fill="rgba(20,20,20,0.6)"></rect><path d="M7 7l10 10M17 7L7 17" stroke="#fff" stroke-width="1.5" stroke-linecap="round"/></svg>'; }
function svgWebsite(){ return '<svg width="28" height="28" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="#4AA3FF" opacity="0.12"/><path d="M3 12h18M12 3v18" stroke="#4AA3FF" stroke-width="1.4" stroke-linecap="round"/></svg>'; }
function svgDiscord(){ return '<svg width="28" height="28" viewBox="0 0 24 24"><rect x="1" y="1" width="22" height="22" rx="5" fill="#5865F2"></rect><path d="M8 14s1-1 3-1 3 1 3 1" stroke="#fff" stroke-width="1.2" stroke-linecap="round"/><circle cx="9" cy="11" r="1.1" fill="#fff"/><circle cx="15" cy="11" r="1.1" fill="#fff"/></svg>'; }

/* ---------- Task categories (keep in same order) ---------- */
var TASK_CATEGORIES = [
  { id:'youtube', label:'YouTube', icon: svgYouTube },
  { id:'telegram', label:'Telegram', icon: svgTelegram },
  { id:'whatsapp', label:'WhatsApp', icon: svgWhatsApp },
  { id:'instagram', label:'Instagram', icon: svgInstagram },
  { id:'tiktok', label:'TikTok', icon: svgTikTok },
  { id:'x', label:'X', icon: svgX },
  { id:'website', label:'Website', icon: svgWebsite },
  { id:'discord', label:'Discord', icon: svgDiscord }
];

/* ---------- Smart links & limits ---------- */
var SMART_LINKS = [
  'https://otieu.com/4/10176113',
  'https://otieu.com/4/10176184',
  'https://otieu.com/4/10176114',
  'https://otieu.com/4/10176185'
];
var TASK_DAILY_LIMIT = 20;
var WATCH_DAILY_LIMIT = 20;

/* ---------- Callback sender (web -> bot) ---------- */
async function sendCallback(callbackUrl, bodyObj){
  if(!callbackUrl){ console.warn('no-callback-url'); return {ok:false,err:'no-callback-url'}; }
  try {
    const res = await fetch(callbackUrl, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(bodyObj) });
    const text = await res.text();
    return { ok: res.ok, status: res.status, text };
  } catch(e){ console.error('sendCallback err', e); return { ok:false, err: e.message }; }
}

/* ---------- Map # keys to plain ---------- */
function mapHashKeys(obj){
  if(!obj || typeof obj !== 'object') return obj;
  var out={};
  for(var k in obj) if(obj.hasOwnProperty(k)){ var nk = k && k[0] === '#' ? k.slice(1) : k; out[nk]=obj[k]; }
  return out;
}

/* ---------- Render category row + bind handlers ---------- */
function renderTaskCategoryRow(){
  var container = document.createElement('div');
  container.style.display = 'flex';
  container.style.gap = '8px';
  container.style.marginBottom = '12px';
  container.id = 'task-category-row';
  TASK_CATEGORIES.forEach(function(cat){
    var b = document.createElement('button');
    b.className = 'task-category-btn';
    b.dataset.cat = cat.id;
    b.style.display = 'flex';
    b.style.alignItems = 'center';
    b.style.gap = '8px';
    b.style.padding = '8px 12px';
    b.style.borderRadius = '12px';
    b.style.background = 'rgba(255,255,255,0.03)';
    b.style.border = '1px solid rgba(255,255,255,0.04)';
    b.style.cursor = 'pointer';
    b.innerHTML = '<span style="width:28px;height:28px;display:inline-block;">'+cat.icon()+'</span><span style="font-weight:700;font-size:13px;color:var(--text-secondary)">'+cat.label+'</span>';
    b.onclick = function(e){ renderTasksForCategory(cat.id); qsa('.task-category-btn').forEach(x=>x.style.boxShadow=''); b.style.boxShadow='0 6px 18px rgba(0,0,0,0.3)'; };
    container.appendChild(b);
  });
  var tasksScreen = document.getElementById('tasks');
  if(tasksScreen){
    var header = tasksScreen.querySelector('.task-board-header');
    if(header && !document.getElementById('task-category-row')) {
      header.parentNode.insertBefore(container, header.nextSibling);
    } else {
      var existing = document.getElementById('task-category-row'); if(existing) existing.parentNode.replaceChild(container, existing);
    }
  }
}

/* ---------- Generate tasks storage (random + bot-provided) ---------- */
function initTasksStorage(){
  var tasks = getLs(todayKey('ga_tasks')) || [];
  var used = getLs(todayKey('ga_used')) || [];
  while(tasks.length < TASK_DAILY_LIMIT){
    var sl = SMART_LINKS[Math.floor(Math.random()*SMART_LINKS.length)];
    if(used.indexOf(sl) !== -1) {
      if(used.length >= SMART_LINKS.length) break;
      continue;
    }
    var seconds = 30 + Math.floor(Math.random()*120);
    var reward = 100 + Math.floor(Math.random()*200);
    var t = { id:'task_'+Date.now()+'_'+Math.random().toString(36).slice(2,6), title:'Visit Partner', link: sl, smartlink: sl, seconds: seconds, reward: reward, network: 'website', created_by: 'auto', used:false };
    tasks.push(t); used.push(sl);
  }
  setLs(todayKey('ga_used'), used);
  setLs(todayKey('ga_tasks'), tasks);
}

/* ---------- Render tasks for a given category ---------- */
function renderTasksForCategory(category){
  var tasks = getLs(todayKey('ga_tasks')) || [];
  var filtered = tasks.filter(function(t){ return t.network === category || (category==='website' && (!t.network || t.network==='website')); });
  var list = document.getElementById('task-list');
  list.innerHTML = '';
  if(filtered.length === 0){
    var div = document.createElement('div'); div.style.padding='20px'; div.style.textAlign='center'; div.style.color='var(--text-secondary)';
    div.innerHTML = 'No tasks in ' + category + ' today. Showing other tasks.';
    list.appendChild(div);
    filtered = tasks.slice(0,6);
  }
  filtered.forEach(function(t){
    var el = document.createElement('article'); el.className = 'task-card';
    el.innerHTML = '<div class="task-header" style="display:flex;align-items:center;gap:12px;"><div class="platform-icon">'+(iconForNetwork(t.network)||svgWebsite())+'</div><div class="task-info"><h3 class="task-title">'+escapeHtml(t.title)+'</h3><p class="task-description">Stay '+formatSeconds(t.seconds)+' for reward.</p><div class="task-progress"><div class="progress-bar" style="height:8px;background:rgba(255,255,255,0.03);border-radius:999px;"><div class="progress-fill" style="width:0%;height:8px;border-radius:999px;background:linear-gradient(90deg,var(--electric-blue),var(--vivid-magenta));"></div></div><span class="progress-text">Not started</span></div></div><div class="task-reward" style="display:flex;align-items:center;gap:8px;"><svg width="16" height="16"><circle cx="8" cy="8" r="7" fill="#FFC857"/></svg><span>'+t.reward+'</span></div></div><div class="task-footer" style="margin-top:12px;display:flex;gap:8px;"><button class="task-btn primary" onclick="startTaskById(\''+t.id+'\')">Start Task</button><button class="task-btn secondary" onclick="taskDetailsModal(\''+t.id+'\')">Details</button></div>';
    list.appendChild(el);
  });
  var total = (getLs(todayKey('ga_tasks'))||[]).length;
  $('task-counter').textContent = (total) + '/' + TASK_DAILY_LIMIT;
}

/* ---------- helper: return icon html for network ---------- */
function iconForNetwork(network){
  if(!network) return svgWebsite();
  var c = TASK_CATEGORIES.find(x=>x.id === network);
  return c ? c.icon() : svgWebsite();
}

/* ---------- Add/update tasks pushed by bot ---------- */
function addOrUpdateTaskFromBot(t){
  var tasks = getLs(todayKey('ga_tasks')) || [];
  var idx = tasks.findIndex(x => x.id === t.id);
  if(idx >= 0) tasks[idx] = t; else tasks.unshift(t);
  setLs(todayKey('ga_tasks'), tasks);
  renderTasksForCategory(t.network || 'website');
}

/* ---------- Start a task (by ID) ---------- */
var activeTaskTimer = null;
async function startTaskById(taskId){
  var tasks = getLs(todayKey('ga_tasks')) || [];
  var t = tasks.find(x=>x.id===taskId);
  if(!t) return;
  var modal = $('task-modal'); modal.classList.add('active');
  var browserUrl = $('browser-url'); browserUrl.textContent = t.smartlink || t.link || t.url || 'about:blank';
  var content = $('browser-content');
  content.innerHTML = '<h2 class="modal-title" id="task-modal-title">'+escapeHtml(t.title)+'</h2><div id="iframe-wrap" style="width:100%;height:60vh;border-radius:12px;background:rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:center">Preparing...</div><div style="text-align:center;margin-top:12px"><div id="task-countdown">00:00</div></div>';
  var wrap = $('iframe-wrap');
  var pre = document.createElement('iframe'); pre.style.width='100%'; pre.style.height='100%'; pre.style.border='none'; pre.src = t.smartlink || (t.link || t.url);
  wrap.innerHTML=''; wrap.appendChild(pre);
  setTimeout(function(){
    if(/youtube\.com|youtu\.be/.test(t.link||'')){
      window.open(t.link,'_blank');
    } else {
      var main = document.createElement('iframe'); main.style.width='100%'; main.style.height='100%'; main.style.border='none'; main.src = t.link;
      wrap.innerHTML=''; wrap.appendChild(main);
    }
    var remaining = Number(t.seconds||30);
    var cd = $('task-countdown'); if(cd) cd.textContent = formatSeconds(remaining);
    activeTaskTimer = setInterval(async function(){
      remaining--;
      if(cd) cd.textContent = formatSeconds(remaining);
      if(remaining <= 0){
        clearInterval(activeTaskTimer); activeTaskTimer = null;
        var cb = localStorage.getItem('ga_callback_url') || PAGE_CONTEXT.callback_url;
        if(cb){
          await sendCallback(cb, { api: generateApiKey(), action: 'task_complete', taskId: t.id, reward: t.reward, user_id: PAGE_CONTEXT.uid });
        }
        var newTasks = (getLs(todayKey('ga_tasks'))||[]).filter(x=>x.id !== t.id);
        setLs(todayKey('ga_tasks'), newTasks);
        renderTasksForCategory(t.network || 'website');
        closeTaskModal();
        animateBalanceDelta(t.reward);
      }
    },1000);
  }, 2000 + Math.floor(Math.random()*1000));
}

function closeTaskModal(){ var modal = $('task-modal'); if(modal) modal.classList.remove('active'); if(activeTaskTimer){ clearInterval(activeTaskTimer); activeTaskTimer=null; } $('browser-content').innerHTML = '<h2 class=\"modal-title\">Task Loading...</h2>'; }

/* ---------- Watch ads flow ---------- */
function renderWatchGrid(){
  var grid = $('watch-grid'); if(!grid) return;
  grid.innerHTML='';
  var count = Number(getLs(todayKey('ga_ads_count'))||0);
  for(var i=0;i<8;i++){
    var card = document.createElement('article'); card.className='video-card'; card.dataset.watched = 'false';
    card.innerHTML = '<div class="video-thumbnail"><svg class="play-icon" viewBox="0 0 48 48"><circle cx="24" cy="24" r="22" fill="rgba(255,255,255,0.9)"></circle><path d="M19 16L32 24L19 32V16Z" fill="#0B0B0D" /></svg><span class="video-duration">0:40</span></div><div class="video-info"><div class="video-advertiser"><svg width="14" height="14"></svg><span>Sponsored</span></div><h3 class="video-title">Sponsored</h3><div class="video-meta"><span>Watch 0:40 Â· Earn</span><span class="video-reward">+60 G-coins</span></div></div>';
    (function(cardLocal, idx){
      cardLocal.onclick = function(){ openWatchAd(idx, cardLocal); };
    })(card,i);
    grid.appendChild(card);
  }
  $('ads-counter').textContent = (count) + '/' + WATCH_DAILY_LIMIT;
}

async function openWatchAd(index, card){
  var count = Number(getLs(todayKey('ga_ads_count'))||0);
  if(count >= WATCH_DAILY_LIMIT){ showInlineMessage('Daily ads limit reached'); return; }
  if(typeof window.show_10274566 === 'function'){
    try{
      await window.show_10274566('pop');
      var reward = 60;
      var cb = localStorage.getItem('ga_callback_url') || PAGE_CONTEXT.callback_url;
      if(cb) await sendCallback(cb, { api: generateApiKey(), action:'ad_complete', reward: reward, user_id: PAGE_CONTEXT.uid });
      animateBalanceDelta(reward); markCardWatched(card, reward);
      setLs(todayKey('ga_ads_count'), count+1); $('ads-counter').textContent = (count+1)+'/'+WATCH_DAILY_LIMIT;
    } catch(e){ console.warn('ad sdk err', e); fallbackAdFlow(card); }
  } else {
    fallbackAdFlow(card);
  }
}

function fallbackAdFlow(card){
  var sl = SMART_LINKS[Math.floor(Math.random()*SMART_LINKS.length)];
  var modal = $('video-modal'); modal.classList.add('active');
  var content = $('video-browser-content');
  content.innerHTML = '<h2 class="modal-title">Ad Loading...</h2><div id="ad-iframe-wrap" style="width:100%;height:250px;background:rgba(255,255,255,0.02);border-radius:12px;display:flex;align-items:center;justify-content:center">Loading...</div><div style="text-align:center;margin-top:12px"><div id="ad-countdown">00:40</div></div>';
  var wrap = $('ad-iframe-wrap');
  var iframe = document.createElement('iframe'); iframe.style.width='100%'; iframe.style.height='100%'; iframe.style.border='none'; iframe.src = sl;
  wrap.appendChild(iframe);
  var remaining = 40; var cd = $('ad-countdown'); if(cd) cd.textContent = formatSeconds(remaining);
  var intv = setInterval(async function(){
    remaining--; if(cd) cd.textContent = formatSeconds(remaining);
    if(remaining <= 0){ clearInterval(intv);
      var reward = 60;
      var cb = localStorage.getItem('ga_callback_url') || PAGE_CONTEXT.callback_url;
      if(cb) await sendCallback(cb, { api: generateApiKey(), action:'ad_complete', reward: reward, user_id: PAGE_CONTEXT.uid });
      animateBalanceDelta(reward); markCardWatched(card, reward);
      var count = Number(getLs(todayKey('ga_ads_count'))||0); setLs(todayKey('ga_ads_count'), count+1); $('ads-counter').textContent = (count+1)+'/'+WATCH_DAILY_LIMIT;
      closeVideoModal();
    }
  },1000);
}

function closeVideoModal(){ $('video-modal').classList.remove('active'); $('video-browser-content').innerHTML = '<h2 class=\"modal-title\">Video Loading...</h2>'; }
function markCardWatched(card, reward){ if(!card) return; card.classList.add('watched'); card.dataset.watched='true'; var meta = card.querySelector('.video-meta'); if(meta) meta.innerHTML = '<span class=\"collected-badge\">âœ“ Collected</span><span class=\"video-reward\">+'+reward+' G-coins</span>'; animateCoinFly(card); }

/* ---------- Posting (publish) flow ---------- */
var composerAttachment = null;
function handleFileSelected(e){
  var f = e.target.files[0]; if(!f) return;
  var reader = new FileReader();
  reader.onload = function(){ composerAttachment = { name: f.name, type: f.type, data: reader.result }; var preview = $('attachment-preview'); preview.innerHTML=''; if(f.type.startsWith('image/')){ var img=document.createElement('img'); img.src=reader.result; img.style.maxWidth='100%'; img.style.borderRadius='8px'; preview.appendChild(img); } else if(f.type.startsWith('video/')){ var v=document.createElement('video'); v.src=reader.result; v.controls=true; v.style.maxWidth='100%'; preview.appendChild(v);} else preview.textContent = f.name; };
  reader.readAsDataURL(f);
}
async function handlePostSubmit(e){
  e.preventDefault();
  var content = $('post-content').value.trim();
  var reward = Number($('post-reward').value || 0);
  var rewardType = document.querySelector('input[name="reward-type"]:checked').value;
  var cb = localStorage.getItem('ga_callback_url') || PAGE_CONTEXT.callback_url;
  var vip = localStorage.getItem('ga_vip_level') || (PAGE_CONTEXT.last_bot_payload && PAGE_CONTEXT.last_bot_payload.vip_level) || 'free';
  var vipFlag = (localStorage.getItem('ga_vip_flag') === '1') || false;
  var vipOkForPublishing = ((vipFlag) && (vip === 'gold' || vip === 'premium'));
  var allowWebPublish = PAGE_CONTEXT.allow_web_publish || false;
  if(!allowWebPublish && !(vipOkForPublishing)) { showInlineMessage('Posting from web requires Gold or Premium VIP.'); return; }
  var payload = { api: generateApiKey(), action:'request_publish_post', post: { content: content, reward: reward, rewardType: rewardType, attachments: composerAttachment ? [composerAttachment] : [] }, user_id: PAGE_CONTEXT.uid || null };
  if(cb){ await sendCallback(cb, payload); showInlineMessage('Publish request sent to bot for approval.'); } else showInlineMessage('Callback URL missing; cannot publish.');
  $('post-content').value=''; $('post-reward').value=''; composerAttachment=null; $('attachment-preview').innerHTML=''; closeComposer();
}

/* ---------- Comments/like helpers (calls to bot) ---------- */
async function handleLike(btn){
  btn.classList.toggle('liked');
  var post = btn.closest('.post-card');
  var postId = post ? post.dataset.postId || post.getAttribute('data-post-id') : null;
  var cb = localStorage.getItem('ga_callback_url') || PAGE_CONTEXT.callback_url;
  if(cb) await sendCallback(cb, { api: generateApiKey(), action:'like', postId: postId, user_id: PAGE_CONTEXT.uid });
}
function openCommentsForPost(triggerBtn){
  var post = triggerBtn.closest('.post-card'); if(!post) return;
  var existing = post.querySelector('.comments-container'); if(existing){ existing.remove(); return; }
  var c = document.createElement('div'); c.className='comments-container'; c.style.padding='12px'; c.style.background='rgba(255,255,255,0.03)'; c.style.borderRadius='8px';
  c.innerHTML = '<div class="comments-list" style="max-height:150px;overflow:auto;margin-bottom:8px;"></div><div style="display:flex;gap:8px;"><input class="form-input comment-input" placeholder="Write a comment..." style="flex:1"/><button class="submit-btn">Send</button></div>';
  post.appendChild(c);
  var sendBtn = c.querySelector('button'); var input = c.querySelector('input');
  sendBtn.onclick = async function(){ var text = input.value.trim(); if(!text) return; var list = c.querySelector('.comments-list'); var it = document.createElement('div'); it.style.padding='8px 0'; it.textContent = (localStorage.getItem('ga_name')||'You') + ': ' + text; list.appendChild(it); input.value=''; var cb = localStorage.getItem('ga_callback_url') || PAGE_CONTEXT.callback_url; if(cb) await sendCallback(cb, { api: generateApiKey(), action:'comment', comment:text, postId: post.dataset.postId || post.getAttribute('data-post-id'), user_id: PAGE_CONTEXT.uid }); };
}

/* ---------- Process payloads from bot ---------- */
async function processBotPayloadFromBase64(b64){
  if(!b64) return null;
  var s = safeBase64Decode(b64);
  if(!s) return null;
  var obj;
  try { obj = JSON.parse(s); } catch(e){ console.warn('payload parse fail', e); return null; }
  return processBotPayload(obj);
}
async function processBotPayload(obj){
  if(!obj) return null;
  var mapped = mapHashKeys(obj);
  PAGE_CONTEXT.last_bot_payload = mapped;
  if(mapped.callback_url) PAGE_CONTEXT.callback_url = mapped.callback_url;
  if(mapped.hook) PAGE_CONTEXT.callback_url = mapped.hook;
  if(mapped.user_id) PAGE_CONTEXT.uid = mapped.user_id;
  if(mapped.uid) PAGE_CONTEXT.uid = mapped.uid;
  if(typeof mapped.gcoin !== 'undefined'){ var g = Number(mapped.gcoin||0); if($('balance-text')) $('balance-text').textContent = g.toLocaleString(); if($('stat-gcoins')) $('stat-gcoins').textContent = g.toLocaleString(); if($('wallet-amount')) $('wallet-amount').textContent = g.toLocaleString() + ' G-coins'; localStorage.setItem('ga_gcoins', g); }
  if(mapped.vip_level){ localStorage.setItem('ga_vip_level', mapped.vip_level); localStorage.setItem('ga_vip_flag', (mapped.vip || mapped.vip_flag) ? '1' : '0'); }
  if(PAGE_CONTEXT.callback_url) localStorage.setItem('ga_callback_url', PAGE_CONTEXT.callback_url);
  if(Array.isArray(mapped.tasks)){
    mapped.tasks.forEach(function(t){ addOrUpdateTaskFromBot(t); });
  }
  if(Array.isArray(mapped.posts)){
    mapped.posts.forEach(function(p){ insertPostIntoFeed(renderPostFromBot(p)); });
  }
  if(mapped.action === 'open_section' && mapped.section) switchScreen(mapped.section);
  if(mapped.callback_action === 'open_iframe' && mapped.link){
    var fakeTask = { id: 'iframe_'+Date.now(), title: mapped.title || 'Bot iframe', link: mapped.link, smartlink: mapped.smartlink || mapped.link, seconds: mapped.secs || 30, reward: mapped.reward || 0, network: mapped.network || 'website' };
    addOrUpdateTaskFromBot(fakeTask);
    startTaskById(fakeTask.id);
  }
  return mapped;
}
window.onWebhookBase64 = processBotPayloadFromBase64; // expose for debug

/* ---------- Feed helpers ---------- */
function insertPostIntoFeed(nodeOrHtml){
  var feed = $('feed-container');
  if(!feed) return;
  if(typeof nodeOrHtml === 'string'){ var d = document.createElement('div'); d.innerHTML = nodeOrHtml; feed.insertBefore(d.firstChild, feed.firstChild); } else feed.insertBefore(nodeOrHtml, feed.firstChild);
}
function renderPostFromBot(post){
  var card = document.createElement('article'); card.className='post-card'; card.dataset.postId = post.id || ('post_'+Date.now());
  var attachmentsHtml = '';
  if(Array.isArray(post.attachments) && post.attachments.length){
    attachmentsHtml = '<div class="post-media">';
    post.attachments.forEach(function(a){
      if(a.type && a.type.startsWith('image')) attachmentsHtml += '<img src="'+(a.data||'')+'" style="max-width:100%;border-radius:8px;"/>';
      if(a.type && a.type.startsWith('video')) attachmentsHtml += '<video src="'+(a.data||'')+'" controls style="max-width:100%;border-radius:8px;"></video>';
    });
    attachmentsHtml += '</div>';
  }
  var html = '<div class="post-header"><div class="avatar">'+(post.authorInitials || (post.author ? post.author.slice(0,2): 'ME'))+'</div><div class="post-meta"><div class="poster-name">'+escapeHtml(post.author || 'Bot')+'</div><div class="post-time">Just now</div></div></div>'
    + '<p class="post-content">'+escapeHtml(post.content||'')+'</p>' + attachmentsHtml
    + '<div class="earnings-bar"><span class="earnings-label">ðŸ’° Earn up to '+Number(post.reward||0)+' G-coins</span></div>'
    + '<div class="post-actions"><button class="action-btn" onclick="handleLike(this)"><span>Like</span></button><button class="action-btn" onclick="visitLink(\''+(post.link||'')+'\')"><span>'+(post.rewardType === 'join' ? 'Join' : (post.rewardType==='watch'?'Watch':'Visit'))+'</span></button><button class="action-btn" onclick="openCommentsForPost(this)"><span>Comment</span></button></div>';
  card.innerHTML = html;
  return card;
}

/* ---------- Visit helper ---------- */
function visitLink(url){
  if(!url) return;
  var cb = localStorage.getItem('ga_callback_url') || PAGE_CONTEXT.callback_url;
  if(cb) sendCallback(cb, { api: generateApiKey(), action:'visit', url: url, user_id: PAGE_CONTEXT.uid });
  window.open(url, '_blank');
}

/* ---------- UI small helpers ---------- */
function showInlineMessage(msg, tm){
  tm = tm || 3000;
  var d = document.createElement('div'); d.style.cssText = 'position:fixed;top:80px;left:50%;transform:translateX(-50%);background:var(--bg-panel);color:var(--white);padding:12px 20px;border-radius:12px;border:1px solid rgba(255,255,255,0.08);box-shadow:0 4px 16px rgba(0,0,0,0.3);z-index:3000;';
  d.textContent = msg; document.body.appendChild(d);
  setTimeout(function(){ d.style.transition='all 0.25s ease'; d.style.opacity='0'; d.style.transform='translateX(-50%) translateY(-20px)'; setTimeout(()=>d.remove(),250); }, tm);
}
function animateBalanceDelta(delta){
  var el = $('balance-text'); if(!el) return;
  var cur = Number(el.textContent.replace(/,/g,'')) || 0; var next = cur + Number(delta||0);
  el.textContent = Number(next).toLocaleString();
  el.animate([{transform:'scale(1)'},{transform:'scale(1.12)'},{transform:'scale(1)'}],{duration:450});
  var stat = $('stat-gcoins'); if(stat) stat.textContent = Number(next).toLocaleString();
  var wallet = $('wallet-amount'); if(wallet) wallet.textContent = Number(next).toLocaleString() + ' G-coins';
}

/* ---------- animate coin fly ---------- */
function animateCoinFly(sourceElement){
  var rect = sourceElement.getBoundingClientRect();
  var coin = document.createElement('div'); coin.className='coin-animation';
  coin.style.left = (rect.left + rect.width/2) + 'px'; coin.style.top = (rect.top + rect.height/2) + 'px';
  coin.innerHTML = '<svg width="32" height="32" viewBox="0 0 32 32"><circle cx="16" cy="16" r="15" fill="#FFC857" stroke="#FFD87A" stroke-width="2"/><text x="16" y="22" text-anchor="middle" fill="#0B0B0D" font-size="18" font-weight="700">G</text></svg>';
  document.body.appendChild(coin); setTimeout(()=>coin.remove(),800);
}

/* ---------- Init & wiring ---------- */
(function init(){
  renderTaskCategoryRow();
  initTasksStorage();
  renderTasksForCategory('website');
  renderWatchGrid();
  var fileInput = document.getElementById('file-input');
  if(fileInput) fileInput.addEventListener('change', handleFileSelected);
  var form = document.getElementById('composer-form');
  if(form) form.addEventListener('submit', handlePostSubmit);
  (async function parseQuery(){ var params={}; var s=location.search.substring(1); if(s) s.split('&').forEach(function(pair){ var p=pair.split('='); if(!p[0]) return; params[decodeURIComponent(p[0])] = decodeURIComponent(p[1]||''); }); if(location.hash && location.hash.indexOf('payload=') !== -1){ var m = location.hash.match(/payload=([^&]+)/); if(m) params.payload = decodeURIComponent(m[1]); }
    if(params.payload){ await processBotPayloadFromBase64(params.payload); showInlineMessage('Bot payload applied'); }
    if(params.hook){ PAGE_CONTEXT.callback_url = params.hook; localStorage.setItem('ga_callback_url', params.hook); showInlineMessage('Callback URL received'); }
    if(params.callback_url){ PAGE_CONTEXT.callback_url = params.callback_url; localStorage.setItem('ga_callback_url', params.callback_url); showInlineMessage('Callback URL received'); }
    if(params.uid) PAGE_CONTEXT.uid = params.uid;
  })();
  PAGE_CONTEXT.api_key = localStorage.getItem('ga_api_key') || null;

  // Initialize libtl ad sdk preferences if available
  try{
    if(typeof window.show_10274566 === 'function'){
      // call with inApp config as you provided
      try{
        show_10274566({
          type: 'inApp',
          inAppSettings: {
            frequency: 2,
            capping: 0.1,
            interval: 30,
            timeout: 5,
            everyPage: false
          }
        });
      }catch(e){}
    }
  }catch(e){}
})();

/* ---------- Expose for debug ---------- */
window.processBotPayloadFromBase64 = processBotPayloadFromBase64;
window.sendCallback = sendCallback;
window.generateApiKey = generateApiKey;
window.startTaskById = startTaskById;
window.openTaskModal = function(title){ showInlineMessage('task modal open: '+title); };
/* --- Robust nav binding + debug helpers (paste at the END of your main script) --- */
(function () {
  function debug(...args) { try { console.log('[GG NAV]', ...args); } catch(e){} }

  // Make switchScreen tolerant if event.currentTarget isn't provided
  if (typeof switchScreen !== 'function') {
    window.switchScreen = function(screenId, event) {
      try {
        if (event && event.preventDefault) event.preventDefault();
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        var target = document.getElementById(screenId);
        if (target) target.classList.add('active');

        // mark nav active by href or data-target
        document.querySelectorAll('.nav-item').forEach(item => {
          var href = item.getAttribute('href') || '';
          var dt = item.getAttribute('data-target') || '';
          if (href === '#' + screenId || dt === screenId) item.classList.add('active');
          else item.classList.remove('active');
        });

        // update hash without jumping
        if (history && history.replaceState) history.replaceState(null, '', '#' + screenId);
        else window.location.hash = screenId;
        debug('switched to', screenId);
      } catch (err) {
        console.error('switchScreen error', err);
      }
    };
  }

  // Attach safe listeners to all nav items (covers anchors and buttons)
  function bindNavItems() {
    var navItems = document.querySelectorAll('.nav-item');
    if (!navItems || navItems.length === 0) {
      debug('no .nav-item found (check HTML)');
      return;
    }
    navItems.forEach(item => {
      // avoid double-binding
      if (item.__gg_nav_bound) return;
      item.__gg_nav_bound = true;

      item.addEventListener('click', function (ev) {
        try {
          ev.preventDefault && ev.preventDefault();

          // priority: data-target attribute, href="#id", fallback to inline onclick call (if present)
          var dataTarget = this.getAttribute('data-target');
          var href = this.getAttribute('href') || '';
          var screenId = null;

          if (dataTarget && dataTarget.trim()) screenId = dataTarget.trim();
          else if (href && href.startsWith('#')) screenId = href.slice(1);
          else {
            // try to parse inline onclick="switchScreen('tasks', event)"
            var onclick = this.getAttribute('onclick') || '';
            var m = onclick.match(/switchScreen\(['"]([^'"]+)['"]/);
            if (m) screenId = m[1];
          }

          if (!screenId) {
            debug('could not determine screenId for nav item', this);
            return;
          }

          debug('nav click ->', screenId);
          // call the global switchScreen
          try { window.switchScreen(screenId, ev); } catch (e) { console.error('call switchScreen failed', e); }
        } catch (e) {
          console.error('nav click handler error', e);
        }
      });
    });
    debug('nav binding complete, items:', navItems.length);
  }

  // Defensive: run on DOMContentLoaded and also schedule a late retry
  document.addEventListener('DOMContentLoaded', function () {
    try {
      bindNavItems();

      // apply initial hash
      var initial = window.location.hash.replace('#', '');
      if (initial) {
        window.switchScreen(initial, null);
      } else {
        // ensure default feed shows
        if (!document.querySelector('.screen.active')) {
          var home = document.getElementById('gridhome');
          if (home) home.classList.add('active');
        }
      }
    } catch (e) { console.error('DOMContentLoaded nav init error', e); }
  });

  // Fallback retry if scripts load order weirdly
  setTimeout(function () {
    try { bindNavItems(); } catch (e) { console.error('delayed bindNavItems error', e); }
  }, 600);

  // Quick runtime error watcher (useful during dev)
  window.addEventListener('error', function (ev) {
    console.error('[GG RUNTIME ERROR]', ev && ev.error ? ev.error : ev);
  });

})();

<!-- Paste this at the END of your main <script> block, before the closing </script> -->
(function(){
  'use strict';
  function dbg(){ try{ console.log('[GG DELEGATE]', ...arguments); }catch(e){} }

  // Safe exec helper for inline onclick strings (re-usable)
  function execInlineOnclick(el){
    try {
      var onclick = el.getAttribute && el.getAttribute('onclick');
      if (!onclick) return false;
      var m = onclick.match(/^([a-zA-Z0-9_$]+)\s*\(([\s\S]*)\)\s*;?$/);
      if (!m) return false;
      var fnName = m[1];
      var argText = m[2] || '';
      // Replace "this" with null marker then substitute later
      var wrapper = 'return [' + argText.replace(/\bthis\b/g,'null') + '];';
      var args = (new Function(wrapper))();
      args = args.map(a => a === null ? el : a);
      if (typeof window[fnName] === 'function') {
        window[fnName].apply(null, args);
        dbg('ran inline', fnName, args);
        return true;
      } else {
        dbg('inline function not found', fnName);
      }
    } catch (err) {
      console.warn('execInlineOnclick error', err, el);
    }
    return false;
  }

  // Helper: find closest parent with selector (polyfill friendly)
  function closest(el, selector){
    while (el && el !== document) {
      if (el.matches && el.matches(selector)) return el;
      el = el.parentNode;
    }
    return null;
  }

  // Compose / attach drag-drop to composer area (if present)
  function ensureComposerDragDrop(){
    try {
      var composer = document.querySelector('.composer-form');
      if (!composer || composer.__drop_bound) return;
      composer.__drop_bound = true;

      // create an attachment drop area if not present
      var attachArea = composer.querySelector('.media-attach-area') || null;
      if (!attachArea) return;
      attachArea.addEventListener('dragover', function(e){ e.preventDefault(); attachArea.classList.add('dragover'); });
      attachArea.addEventListener('dragleave', function(){ attachArea.classList.remove('dragover'); });
      attachArea.addEventListener('drop', function(e){
        e.preventDefault(); attachArea.classList.remove('dragover');
        var file = (e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files[0]) ? e.dataTransfer.files[0] : null;
        if (!file) {
          showInlineMessage && showInlineMessage('No file detected in drop.');
          return;
        }
        var preview = composer.querySelector('.attachment-preview') || document.createElement('div');
        preview.className = 'attachment-preview';
        preview.style.cssText = 'margin-top:8px;padding:12px;background:rgba(255,255,255,0.05);border-radius:8px;font-size:12px;color:var(--text-secondary);';
        preview.textContent = `âœ“ Attached: ${file.name}`;
        composer.insertBefore(preview, composer.firstChild);
        dbg('file attached', file.name);
      });
      dbg('composer drag/drop bound');
    } catch (e) { console.warn(e); }
  }

  // Ensure profile tab logic works (Activity / Posts / Wallet)
  function ensureProfileTabs(){
    try {
      var tabs = document.querySelectorAll('.profile-tab');
      tabs.forEach(function(tab){
        if (tab.__profile_bound) return;
        tab.__profile_bound = true;
        tab.addEventListener('click', function(e){
          e.preventDefault();
          var idx = Array.prototype.indexOf.call(document.querySelectorAll('.profile-tab'), tab);
          // call existing switchProfileTab if present
          var target = tab.textContent && tab.textContent.trim().toLowerCase();
          if (typeof switchProfileTab === 'function') {
            // your switchProfileTab expects (tabName, event), original code uses id names 'activity', 'posts', 'wallet'
            var map = { 'activity':'activity', 'posts':'posts', 'wallet':'wallet' };
            var name = map[target] || (tab.getAttribute('data-target') || target);
            switchProfileTab(name, { target: tab });
            dbg('switchProfileTab called', name);
            return;
          }
          // fallback: simple class toggle
          document.querySelectorAll('.profile-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          var panes = document.querySelectorAll('.tab-pane');
          panes.forEach(p => p.classList.remove('active'));
          var pane = document.getElementById((tab.getAttribute('data-target') || target) + '-tab');
          if (pane) pane.classList.add('active');
          dbg('profile tab toggled (fallback)', tab);
        });
      });
    } catch(e){ console.warn(e); }
  }

  // Handle wallet card expand / view details (button inside profile)
  function handleWalletButton(el){
    try {
      // try inline first
      if (execInlineOnclick(el)) return;
      // Find wallet tab content
      var walletPane = document.getElementById('wallet-tab');
      if (!walletPane) {
        showInlineMessage && showInlineMessage('Wallet section not found');
        return;
      }
      // If wallet tab not active, switch to it
      var tabBtn = Array.from(document.querySelectorAll('.profile-tab')).find(t => (t.textContent||'').toLowerCase().indexOf('wallet') !== -1);
      if (tabBtn) {
        tabBtn.click();
      }
      // Optionally show a quick inline modal
      showInlineMessage && showInlineMessage('Opened wallet preview');
    } catch(e){ console.warn(e); }
  }

  // Unified delegated click listener
  document.addEventListener('click', function(e){
    try {
      var el = e.target;

      // walk up for button elements
      var btn = closest(el, 'button, a, .action-btn, .nav-item, .profile-action-btn, .menu-item, .fab, .task-btn, .post-actions .action-btn, .video-card, .composer-form .submit-btn, .menu-item, .profile-tab');
      if (!btn) return;

      // If it's an a.nav-item handled by switchScreen, let it be handled by existing handlers
      if (btn.classList.contains('nav-item')) return;

      // Specific: FAB / create task (class .fab)
      if (closest(btn, '.fab')) {
        e.preventDefault();
        if (execInlineOnclick(btn)) return;
        // call openComposer or openNewTaskModal based on presence
        if (typeof openComposer === 'function') return openComposer();
        if (typeof openNewTaskModal === 'function') return openNewTaskModal();
        showInlineMessage && showInlineMessage('Open composer / create task');
        return;
      }

      // Profile action buttons
      if (btn.classList.contains('profile-action-btn')) {
        e.preventDefault();
        // Some have specific text like "Edit Profile" or icon-only
        var txt = (btn.textContent || '').toLowerCase();
        if (txt.indexOf('edit') !== -1) {
          if (execInlineOnclick(btn)) return;
          if (typeof openEditProfile === 'function') return openEditProfile();
          if (typeof openComposer === 'function') return openComposer();
        } else if (txt.indexOf('withdraw') !== -1) {
          if (execInlineOnclick(btn)) return;
          // fallback action
          showInlineMessage && showInlineMessage('Withdraw clicked');
        } else {
          // default fallback
          if (execInlineOnclick(btn)) return;
          showInlineMessage && showInlineMessage('Profile action: ' + (btn.textContent||''));
        }
        return;
      }

      // Profile small menu items (Edit Profile, Transaction History, Referrals, Settings, Help & Support)
      if (btn.classList.contains('menu-item')) {
        e.preventDefault();
        var txt = (btn.textContent || '').toLowerCase();
        if (txt.indexOf('help') !== -1) {
          window.open('https://t.me/GridGain_Bot', '_blank', 'noopener');
          return;
        }
        if (txt.indexOf('transaction') !== -1 || txt.indexOf('history') !== -1) {
          // open wallet tab
          var walletBtn = Array.from(document.querySelectorAll('.profile-tab')).find(t => (t.textContent||'').toLowerCase().includes('wallet'));
          if (walletBtn) { walletBtn.click(); }
          showInlineMessage && showInlineMessage('Opened Transaction History');
          return;
        }
        if (txt.indexOf('referral') !== -1) {
          showInlineMessage && showInlineMessage('Referral link copied to clipboard (placeholder)');
          return;
        }
        // fallback: attempt inline onclick
        if (execInlineOnclick(btn)) return;
        showInlineMessage && showInlineMessage(btn.textContent || 'Menu click');
        return;
      }

      // Profile tabs buttons (Activity / Posts / Wallet)
      if (btn.classList.contains('profile-tab')) {
        // let ensureProfileTabs handlers do the job (they are attached), but also fallback here
        e.preventDefault();
        if (execInlineOnclick(btn)) return;
        ensureProfileTabs();
        // call click to invoke earlier bound listener if any
        try { tabClick = new Event('click'); btn.dispatchEvent(tabClick); } catch(e){ dbg('dispatch click failed', e); }
        return;
      }

      // Post action buttons (Like, Visit, Comment, Join, Watch)
      if (closest(btn, '.post-actions') || btn.classList.contains('action-btn')) {
        e.preventDefault();
        // try inline onclick first
        if (execInlineOnclick(btn)) return;
        // determine label
        var label = (btn.textContent || '').trim().toLowerCase();
        if (label.indexOf('like') !== -1) {
          // toggle like visually
          try { handleLike && handleLike(btn); } catch(e){ btn.classList.toggle('liked'); }
          return;
        }
        if (label.indexOf('visit') !== -1) {
          var post = closest(btn, '.post-card');
          var url = post && (post.dataset.url || post.getAttribute('data-url'));
          if (url) { window.open(url, '_blank', 'noopener'); return; }
          // fallback: show message
          showInlineMessage && showInlineMessage('No visit URL');
          return;
        }
        if (label.indexOf('comment') !== -1) {
          var post = closest(btn, '.post-card');
          if (!post) return;
          // reuse logic from previous handler: open small comment area
          var existing = post.querySelector('.comment-area');
          if (existing) { existing.style.display = existing.style.display === 'none' ? 'block' : 'none'; return; }
          var ca = document.createElement('div');
          ca.className = 'comment-area';
          ca.style.cssText = 'margin-top:12px;display:flex;gap:8px;';
          ca.innerHTML = '<input class="form-input" placeholder="Write a comment..." style="flex:1"/><button class="submit-btn">Send</button>';
          post.appendChild(ca);
          ca.querySelector('button').addEventListener('click', function(){
            var txt = ca.querySelector('input').value.trim();
            if (!txt) { showInlineMessage && showInlineMessage('Enter a comment'); return; }
            var p = document.createElement('div'); p.style.cssText='margin-top:8px;font-size:13px;color:var(--text-secondary)'; p.textContent = 'You: '+txt;
            post.appendChild(p);
            ca.remove();
          });
          return;
        }
        // other action labels (join/watch) â€” attempt inline otherwise open task modal
        if (label.indexOf('join') !== -1 || label.indexOf('watch') !== -1) {
          var card = closest(btn, '.post-card');
          var title = card && (card.querySelector('.poster-name') && card.querySelector('.poster-name').textContent) || 'Task';
          if (typeof openTaskModal === 'function') return openTaskModal(title);
          showInlineMessage && showInlineMessage('Action: ' + label);
        }
        return;
      }

      // Task buttons (Start Task / Details) - also handle plus / new task
      if (btn.classList.contains('task-btn') || btn.closest && btn.closest('.task-footer')) {
        e.preventDefault();
        if (execInlineOnclick(btn)) return;
        if (btn.classList.contains('primary')) {
          var card = closest(btn, '.task-card');
          var title = card && card.querySelector('.task-title') && card.querySelector('.task-title').textContent;
          if (typeof openTaskModal === 'function') return openTaskModal(title || 'Task');
          showInlineMessage && showInlineMessage('Start task: ' + (title || 'task'));
          return;
        }
        if (btn.classList.contains('secondary')) {
          var card = closest(btn, '.task-card');
          var title = card && card.querySelector('.task-title') && card.querySelector('.task-title').textContent;
          return openTaskModal && openTaskModal(title || 'Details');
        }
      }

      // Wallet button(s) inside profile (small buttons)
      if ((btn.getAttribute && btn.getAttribute('data-wallet')) || (btn.classList && btn.classList.contains('wallet-btn'))) {
        e.preventDefault();
        handleWalletButton(btn);
        return;
      }

      // Video cards (click play)
      if (closest(btn, '.video-card')) {
        e.preventDefault();
        var card = closest(btn, '.video-card');
        // try inline onclick first
        if (execInlineOnclick(card) || execInlineOnclick(btn)) return;
        var title = (card.querySelector('.video-title') && card.querySelector('.video-title').textContent) || card.dataset.title || 'Video';
        var duration = card.querySelector('.video-duration') ? card.querySelector('.video-duration').textContent : '0:30';
        var rewardText = (card.querySelector('.video-reward') && card.querySelector('.video-reward').textContent) || '25';
        var reward = parseInt(rewardText.replace(/[^0-9]/g,'')) || 25;
        if (typeof openVideoModal === 'function') return openVideoModal(title, duration, reward, card);
        showInlineMessage && showInlineMessage('Play Video: ' + title);
        return;
      }

      // Post publish (SVG post button) - look for element with .submit-btn inside composer-form
      if (closest(btn, '.composer-form')) {
        e.preventDefault();
        var composer = closest(btn, '.composer-form');
        // try the existing handler
        if (typeof handlePostSubmit === 'function') {
          // craft synthetic event
          try { handlePostSubmit(new Event('submit')); return; } catch(e){ dbg('handlePostSubmit failed', e); }
        }
        // fallback: attempt inline onclick attribute on the submit button
        if (execInlineOnclick(btn)) return;
        showInlineMessage && showInlineMessage('Publish (fallback)');
        return;
      }

      // fallback: try executing inline onclick for clicked element
      if (execInlineOnclick(btn)) { e.preventDefault(); return; }

    } catch (err) {
      console.error('[GG DELEGATE] error', err);
    }
  }, true);

  // run safety ensures after DOM is ready
  document.addEventListener('DOMContentLoaded', function(){
    try {
      ensureComposerDragDrop();
      ensureProfileTabs();
      dbg('delegate initialised');
    } catch(e){ console.warn(e); }
  });

  // Also run after a short delay in case some elements are loaded late
  setTimeout(function(){ ensureComposerDragDrop(); ensureProfileTabs(); }, 600);

})();
<!-- Paste THIS at the very end of your main <script> block, before </script> -->
(function () {
  'use strict';

  function dbg() { try { console.log('[GG HANDLERS]', ...arguments); } catch (e) {} }

  // Helper: closest parent
  function closest(el, sel) { while (el && el !== document) { if (el.matches && el.matches(sel)) return el; el = el.parentNode; } return null; }

  // Safe call wrapper
  function tryCall(fn, args) { try { if (typeof fn === 'function') return fn.apply(null, args || []); } catch (e) { console.error(e); } return null; }

  // --- Action implementations (use existing functions if present) ---
  function doOpenComposer(e) {
    e && e.preventDefault && e.preventDefault();
    if (typeof openComposer === 'function') { return tryCall(openComposer); }
    // fallback: open modal if exists
    var m = document.getElementById('composer-modal');
    if (m) m.classList.add('active');
    dbg('openComposer fallback');
  }

  function doOpenNewTask(e) {
    e && e.preventDefault && e.preventDefault();
    if (typeof openNewTaskModal === 'function') return tryCall(openNewTaskModal);
    // fallback message
    showInlineMessage && showInlineMessage('Create Task (fallback) â€” feature coming soon');
    dbg('openNewTask fallback');
  }

  function doLike(btn) {
    try {
      if (!btn) return;
      // prefer existing handler
      if (typeof handleLike === 'function') return handleLike(btn);
      // fallback toggle
      btn.classList.toggle('liked');
      dbg('like toggled', btn);
    } catch (e) { console.error(e); }
  }

  function doComment(btn) {
    var post = closest(btn, '.post-card');
    if (!post) return;
    var existing = post.querySelector('.comment-area');
    if (existing) { existing.style.display = existing.style.display === 'none' ? 'flex' : 'none'; return; }
    var ca = document.createElement('div');
    ca.className = 'comment-area';
    ca.style.cssText = 'margin-top:12px;display:flex;gap:8px;';
    ca.innerHTML = '<input class="form-input gg-comment-input" placeholder="Write a comment..." style="flex:1"/><button class="submit-btn gg-comment-send">Send</button>';
    post.appendChild(ca);
    ca.querySelector('.gg-comment-send').addEventListener('click', function () {
      var txt = ca.querySelector('.gg-comment-input').value.trim();
      if (!txt) { showInlineMessage && showInlineMessage('Enter a comment'); return; }
      var p = document.createElement('div');
      p.style.cssText = 'margin-top:8px;font-size:13px;color:var(--text-secondary)';
      p.textContent = 'You: ' + txt;
      post.appendChild(p);
      ca.remove();
      // optionally notify backend / bot here
    });
  }

  function doVisit(btn) {
    var post = closest(btn, '.post-card');
    if (!post) { showInlineMessage && showInlineMessage('No target link'); return; }
    // prefer data-url attribute
    var url = post.getAttribute('data-url') || post.dataset.url || null;
    // try finding anchor inside
    if (!url) {
      var a = post.querySelector('a[href]');
      if (a) url = a.href;
    }
    if (url) {
      window.open(url, '_blank', 'noopener');
      return;
    }
    showInlineMessage && showInlineMessage('No visit link found');
  }

  function doJoinOrWatch(btn) {
    // Join -> openTaskModal with title; Watch -> openVideoModal if available
    var post = closest(btn, '.post-card');
    var title = post && (post.querySelector('.poster-name') && post.querySelector('.poster-name').textContent) || 'Task';
    var label = (btn.textContent || '').trim().toLowerCase();
    if (label.indexOf('watch') !== -1) {
      // try openVideoModal with defaults
      if (typeof openVideoModal === 'function') return openVideoModal(title, '0:30', 25, post);
      return showInlineMessage && showInlineMessage('Watch: openVideoModal missing');
    } else {
      if (typeof openTaskModal === 'function') return openTaskModal(title || 'Task');
      return showInlineMessage && showInlineMessage('Join: openTaskModal missing');
    }
  }

  // --- Bind a single button (idempotent) ---
  function bindActionButton(btn) {
    if (!btn || btn.__gg_bound) return;
    btn.__gg_bound = true;
    btn.addEventListener('click', function (ev) {
      try {
        // If element has data-action attribute, prefer that
        var act = btn.getAttribute && btn.getAttribute('data-action');
        if (act) {
          act = act.toLowerCase();
          if (act === 'open-composer' || act === 'post') return doOpenComposer(ev);
          if (act === 'create-task' || act === 'new-task') return doOpenNewTask(ev);
          if (act === 'like') return doLike(btn);
          if (act === 'comment') return doComment(btn);
          if (act === 'visit') return doVisit(btn);
          if (act === 'join' || act === 'watch') return doJoinOrWatch(btn);
        }

        // otherwise determine by visible text
        var txt = (btn.innerText || btn.textContent || '').trim().toLowerCase();
        if (!txt && btn.querySelector && btn.querySelector('svg')) {
          // svg-only buttons: examine aria-label or title
          txt = (btn.getAttribute('title') || btn.getAttribute('aria-label') || '').toLowerCase();
        }

        if (txt.indexOf('like') !== -1 || txt === 'â¤' || txt.indexOf('â™¥') !== -1) {
          return doLike(btn);
        }
        if (txt.indexOf('comment') !== -1 || txt.indexOf('reply') !== -1) {
          return doComment(btn);
        }
        if (txt.indexOf('visit') !== -1 || txt.indexOf('open') !== -1) {
          return doVisit(btn);
        }
        if (txt.indexOf('join') !== -1 || txt.indexOf('watch') !== -1) {
          return doJoinOrWatch(btn);
        }
        if (btn.classList.contains('fab') || btn.classList.contains('compose') || txt.indexOf('post') !== -1 || txt.indexOf('publish') !== -1) {
          return doOpenComposer(ev);
        }
        if (btn.classList.contains('new-task-btn') || txt.indexOf('new task') !== -1 || txt.indexOf('create task') !== -1) {
          return doOpenNewTask(ev);
        }

        // fallback: try running inline onclick if present
        var inline = btn.getAttribute && btn.getAttribute('onclick');
        if (inline) {
          try { (new Function(inline)).call(btn); return; } catch (e) { dbg('inline exec error', e); }
        }

        dbg('unhandled action button click', btn, txt);
      } catch (err) { console.error(err); }
    }, false);
  }

  // --- Bulk bind existing elements ---
  function bindAllExisting() {
    // Pen / post SVG likely inside .fab or .fab-icon - bind both
    document.querySelectorAll('.fab, .fab-icon, .post-icon, .compose-btn, .post-pen, .post-svg').forEach(bindActionButton);

    // New task buttons
    document.querySelectorAll('.new-task-btn, .create-task, .task-btn.primary, .fab, .create-task-btn').forEach(bindActionButton);

    // All action buttons in posts
    document.querySelectorAll('.post-actions .action-btn, .action-btn, .post-card .action-btn').forEach(bindActionButton);

    // Task footer buttons
    document.querySelectorAll('.task-footer .task-btn, .task-btn').forEach(bindActionButton);

    // Any menu items that look like wallet/view etc
    document.querySelectorAll('.menu-item, .profile-action-btn, .profile-tab').forEach(bindActionButton);

    dbg('bindAllExisting finished');
  }

  // --- MutationObserver to auto-bind new nodes (dynamic posts/tasks) ---
  function watchForNewNodes() {
    var root = document.querySelector('.app-container') || document.body;
    if (!root) return;
    var obs = new MutationObserver(function (mutations) {
      mutations.forEach(function (m) {
        if (!m.addedNodes || m.addedNodes.length === 0) return;
        m.addedNodes.forEach(function (n) {
          if (!(n instanceof HTMLElement)) return;
          // bind if node is button-like
          if (n.matches && (n.matches('button') || n.matches('.action-btn') || n.matches('.task-btn') || n.querySelector && n.querySelector('.action-btn'))) {
            // bind node and any child buttons
            bindActionButton(n);
            n.querySelectorAll && n.querySelectorAll('button, .action-btn, .task-btn, .profile-tab').forEach(bindActionButton);
          } else {
            // search for button children
            n.querySelectorAll && n.querySelectorAll('button, .action-btn, .task-btn, .new-task-btn, .fab, .menu-item').forEach(bindActionButton);
          }
        });
      });
    });
    obs.observe(root, { childList: true, subtree: true });
    dbg('MutationObserver bound');
  }

  // --- Init ---
  function initHandlers() {
    bindAllExisting();
    watchForNewNodes();
    // ensure composer drag/drop binding if previously added
    try { if (typeof ensureComposerDragDrop === 'function') ensureComposerDragDrop(); } catch (e) {}
    dbg('handlers initialized');
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initHandlers);
  } else {
    initHandlers();
  }

  // quick dev hint: expose doX functions for console debugging
  window.__gg = {
    doOpenComposer: doOpenComposer,
    doOpenNewTask: doOpenNewTask,
    doLike: doLike,
    doComment: doComment,
    doVisit: doVisit,
    doJoinOrWatch: doJoinOrWatch,
    bindActionButton: bindActionButton
  };

})();
/* ---- Composer cancel, drag-drop preview and responsive task layout helpers ---- */
(function () {
  'use strict';

  // helpers
  function $(sel, root=document) { return root.querySelector(sel); }
  function $all(sel, root=document) { return Array.from(root.querySelectorAll(sel)); }
  function showInline(msg) { window.showInlineMessage ? window.showInlineMessage(msg) : alert(msg); }

  // Close composer: binds existing/ future close buttons in composer
  function bindComposerCancelButtons() {
    // close buttons inside composer modal (including 'âœ–' icons)
    $all('#composer-modal .close-btn, #composer-modal .cancel-btn, #composer-modal [data-action="cancel-post"]').forEach(btn=>{
      if (btn.__composerCloseBound) return;
      btn.__composerCloseBound = true;
      btn.addEventListener('click', (e)=>{
        e.preventDefault();
        const modal = document.getElementById('composer-modal');
        if (modal) modal.classList.remove('active');
        // cleanup any temporary preview
        const ap = modal && modal.querySelector('.attachment-preview');
        if (ap) ap.remove();
      });
    });
  }

  // Ensure modal content scrolls to show preview (useful for large images)
  function scrollComposerToTop() {
    const modalContent = $('#composer-modal .modal-content');
    if (modalContent) modalContent.scrollTop = 0;
  }

  // Setup drag & drop + file input preview in composer
  function setupComposerAttachment() {
    const composer = document.getElementById('composer-modal');
    if (!composer) return;
    const form = composer.querySelector('.composer-form');
    if (!form) return;

    // create hidden file input (if not present)
    let fileInput = form.querySelector('input.gg-attach-input[type=file]');
    if (!fileInput) {
      fileInput = document.createElement('input');
      fileInput.type = 'file';
      fileInput.accept = 'image/*,video/*';
      fileInput.className = 'gg-attach-input';
      fileInput.style.display = 'none';
      form.appendChild(fileInput);
    }

    // ensure there is an attachment-preview container
    function ensureAttachmentPreview() {
      let ap = form.querySelector('.attachment-preview');
      if (!ap) {
        ap = document.createElement('div');
        ap.className = 'attachment-preview';
        ap.style.cssText = 'margin-top:8px;padding:12px;background:rgba(255,255,255,0.04);border-radius:8px;';
        form.insertBefore(ap, form.firstChild);
      }
      return ap;
    }

    // render file
    async function handleFile(file) {
      const ap = ensureAttachmentPreview();
      ap.innerHTML = ''; // reset
      const type = file.type || '';
      if (type.indexOf('image') !== -1) {
        const img = document.createElement('img');
        img.alt = file.name || 'image';
        img.src = URL.createObjectURL(file);
        ap.appendChild(img);
      } else if (type.indexOf('video') !== -1) {
        const vid = document.createElement('video');
        vid.controls = true;
        vid.src = URL.createObjectURL(file);
        vid.style.maxWidth = '100%';
        vid.style.maxHeight = '50vh';
        ap.appendChild(vid);
      } else {
        ap.textContent = 'Attachment type not supported';
      }
      scrollComposerToTop();
    }

    // wire the attach buttons (existing ones)
    $all('.attach-btn').forEach(btn=>{
      if (btn.__attachBound) return;
      btn.__attachBound = true;
      btn.addEventListener('click', (e)=>{
        e.preventDefault();
        fileInput.click();
      });
    });

    // file input onchange
    fileInput.addEventListener('change', (e)=>{
      const f = e.target.files && e.target.files[0];
      if (f) handleFile(f);
      fileInput.value = '';
    });

    // drag/drop area: allow dropping into composer modal
    composer.addEventListener('dragover', (e)=>{ e.preventDefault(); composer.classList.add('gg-drag-over'); });
    composer.addEventListener('dragleave', (e)=>{ composer.classList.remove('gg-drag-over'); });
    composer.addEventListener('drop', (e)=>{
      e.preventDefault();
      composer.classList.remove('gg-drag-over');
      const f = e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files[0];
      if (f) handleFile(f);
    });
  }

  // Normalize platform-icon widths to avoid horizontal scroll (run on load and after DOM changes)
  function normalizePlatformIcons() {
    $all('.platform-icon').forEach(icon=>{
      // add wrapper class for responsive grid if not already
      const parent = icon.parentElement;
      if (parent && !parent.classList.contains('social-grid') && parent.querySelectorAll && parent.querySelectorAll('.platform-icon').length > 1) {
        parent.classList.add('social-grid');
      }
    });
  }

  // bind composer events & close buttons and attach handlers for dynamic content
  function initComposerAndLayout() {
    bindComposerCancelButtons();
    setupComposerAttachment();
    normalizePlatformIcons();
    // also re-bind when new nodes are added
    const observer = new MutationObserver((mutations)=>{
      mutations.forEach(m=>{
        m.addedNodes && m.addedNodes.forEach(n=>{
          if (!(n instanceof HTMLElement)) return;
          if (n.closest && n.closest('#composer-modal')) {
            bindComposerCancelButtons();
            setupComposerAttachment();
          }
          if (n.querySelector && n.querySelector('.platform-icon')) {
            normalizePlatformIcons();
          }
        });
      });
    });
    observer.observe(document.body, { childList: true, subtree: true });
  }

  // run on ready
  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', initComposerAndLayout);
  else initComposerAndLayout();

})();

(function(){
  'use strict';

  /* ---------- 1) Improve horizontal swipe: stop page from moving when user intends horizontal swipe ---------- */
  function enableHorizontalSwipeLock() {
    const scrollers = Array.from(document.querySelectorAll('.social-scroll'));
    scrollers.forEach(sc => {
      let startX = 0, startY = 0, isDragging = false, locked = null;

      sc.addEventListener('touchstart', (e) => {
        if (!e.touches || e.touches.length === 0) return;
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
        isDragging = true;
        locked = null;
      }, { passive: true });

      sc.addEventListener('touchmove', (e) => {
        if (!isDragging || !e.touches || e.touches.length === 0) return;
        const dx = e.touches[0].clientX - startX;
        const dy = e.touches[0].clientY - startY;

        // detect if horizontal or vertical intent (threshold avoids accidental)
        if (locked === null) {
          if (Math.abs(dx) > 8 && Math.abs(dx) > Math.abs(dy)) locked = 'x';
          else if (Math.abs(dy) > 8 && Math.abs(dy) > Math.abs(dx)) locked = 'y';
        }

        // if horizontal intent, prevent outer scrolling
        if (locked === 'x') {
          e.stopPropagation();
          // prevent parent touchmove (page) from happening
          // keep passive false for this listener in some browsers,
          // but we used passive:true for touchstart; for touchmove we need to be able to call preventDefault if necessary
          e.preventDefault && e.preventDefault();
          // let the element scroll horizontally naturally
        }
        // if locked to vertical, do nothing (allow page scroll)
      }, { passive: false });

      sc.addEventListener('touchend', (e) => { isDragging = false; locked = null; });
      sc.addEventListener('touchcancel', (e) => { isDragging = false; locked = null; });
    });
  }

  /* ---------- 2) Ensure watch/task links open inside the popup browser iframe ---------- */
  // Reusable function to open the "browser-frame" popup and load a url with countdown behavior.
  function openBrowserPopupWithCountdown(url, options = {}) {
    // options: { actionId, reward, secs, fromBotPayload }
    const modal = document.getElementById('task-modal') || document.getElementById('video-modal') || document.querySelector('.modal-overlay.browser-frame-parent');
    // Use dedicated browser modal if exists (task-modal uses .browser-frame)
    const browserModal = document.getElementById('task-modal') || document.getElementById('video-modal');
    const frameWrapper = (browserModal && browserModal.querySelector('.browser-content')) ? browserModal.querySelector('.browser-content') : null;

    // create iframe container
    const iframeWrapperId = 'gg-iframe-wrapper';
    let iframeWrapper = document.getElementById(iframeWrapperId);
    if (!iframeWrapper) {
      iframeWrapper = document.createElement('div');
      iframeWrapper.id = iframeWrapperId;
      iframeWrapper.style.width = '100%';
      iframeWrapper.style.height = '100%';
      iframeWrapper.style.display = 'flex';
      iframeWrapper.style.flexDirection = 'column';
      iframeWrapper.style.gap = '12px';
    }

    const iframe = document.createElement('iframe');
    iframe.style.width = '100%';
    iframe.style.height = '60vh';
    iframe.style.border = 'none';
    iframe.setAttribute('sandbox', 'allow-forms allow-scripts allow-same-origin allow-popups');
    // keep target inside iframe when clicking links
    iframe.setAttribute('allow', 'fullscreen');

    // Add a top mini header with countdown display
    const header = document.createElement('div');
    header.style.display = 'flex';
    header.style.justifyContent = 'space-between';
    header.style.alignItems = 'center';
    header.style.gap = '8px';
    header.style.padding = '8px 0';

    const titleSpan = document.createElement('div');
    titleSpan.textContent = options.title || 'Loading...';
    titleSpan.style.fontWeight = '700';

    const countdownSpan = document.createElement('div');
    countdownSpan.id = 'gg-iframe-countdown';
    countdownSpan.textContent = options.secs ? `00:${String(options.secs).padStart(2,'0')}` : '00:00';
    countdownSpan.style.fontWeight = '700';

    header.appendChild(titleSpan);
    header.appendChild(countdownSpan);

    iframeWrapper.innerHTML = ''; // clear
    iframeWrapper.appendChild(header);
    iframeWrapper.appendChild(iframe);

    // Add the iframe wrapper into the modal's browser-content (if exists)
    if (frameWrapper) {
      frameWrapper.innerHTML = ''; // clear existing content
      frameWrapper.appendChild(iframeWrapper);
    } else {
      // fallback: open task-modal and inject into its browser-content
      const fallbackModal = document.getElementById('task-modal') || document.getElementById('video-modal');
      if (fallbackModal) {
        const fallbackContent = fallbackModal.querySelector('.browser-content');
        if (fallbackContent) {
          fallbackContent.innerHTML = '';
          fallbackContent.appendChild(iframeWrapper);
        }
      }
    }

    // show the modal (either tasks or video)
    const usedModal = document.getElementById('task-modal') || document.getElementById('video-modal');
    if (usedModal) usedModal.classList.add('active');

    // load the url inside the iframe (if url is external and blocks embedding, fallback to open in new tab after a short smartlink delay)
    const SMARTLINK_DELAY = 2000; // 2s fallback behavior you requested
    let fallbackOpened = false;

    // First load SMARTLINK fallback if provided in options (simulate push ad)
    if (options.smartlink) {
      iframe.src = options.smartlink;
      // after smartlink short delay, load actual url
      setTimeout(() => {
        try {
          iframe.src = url;
        } catch(e) {
          // if embedding blocked, fallback to open in new tab but keep modal countdown
          fallbackOpened = true;
          window.open(url, '_blank');
        }
      }, SMARTLINK_DELAY);
    } else {
      // directly load url in iframe
      iframe.src = url;
    }

    // start countdown timer shown to user
    let secs = Number(options.secs || 10);
    if (!isFinite(secs) || secs < 1) secs = 10;
    let remaining = secs;
    const circumference = 100; // not used visually here, we simply update text
    const countdownElem = document.getElementById('gg-iframe-countdown');
    const tick = () => {
      if (!countdownElem) return;
      const mm = Math.floor(remaining/60);
      const ss = remaining % 60;
      countdownElem.textContent = `${String(mm).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;
    };
    tick();
    const timerId = setInterval(() => {
      remaining--;
      tick();
      if (remaining <= 0) {
        clearInterval(timerId);
        // signal completion back to the bot via webhook (use the same pattern you used in IP code)
        try {
          const payload = Object.assign({}, options.payload || {});
          payload.status = 'completed';
          payload.url = url;
          // If options.callbackUrl is provided, POST to it
          if (options.callbackUrl) {
            // Use fetch but don't break if url missing or blocked
            fetch(options.callbackUrl, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            }).catch((e)=>{ console.warn('callback post failed', e); });
          } else {
            // store to localStorage as fallback for bot to query or debug
            console.debug('iframe-complete-payload', payload);
          }
        } catch (e) {
          console.warn('Error sending completion payload', e);
        }

        // small UI celebration then close the modal
        setTimeout(() => {
          if (usedModal) usedModal.classList.remove('active');
          // optional: run coin fly animation if reward included
          if (options.reward && typeof window.animateCoinFly === 'function') {
            try { window.animateCoinFly(document.body); } catch(e){}
          }
        }, 400);
      }
    }, 1000);

    // ensure clicks in iframe won't navigate top-level (sandbox helps)
    iframe.addEventListener('load', () => {
      try {
        // try to inject base target into iframe so links open inside iframe
        const doc = iframe.contentDocument || iframe.contentWindow.document;
        if (doc) {
          // add base tag so <a target> respects iframe
          const base = doc.createElement('base');
          base.target = '_self';
          if (!doc.head.querySelector('base')) doc.head.appendChild(base);
        }
      } catch (e) {
        // cross-origin will throw; ignore
      }
    });
  }

  /* ---------- 3) Intercept watch/task click handlers to open in iframe instead of top-level ---------- */
  function wireWatchAndTaskLinks() {
    // For watch cards: add onclick hooks (if they already have onclick attr, this will augment)
    document.querySelectorAll('.video-card[data-watch-url], .task-card[data-task-url]').forEach(card=>{
      if (card.__gaingridIntercept) return;
      card.__gaingridIntercept = true;
      card.addEventListener('click', (e)=>{
        // if click directly on buttons inside card, let them handle
        const btn = e.target.closest('button, a');
        if (btn && btn.tagName.toLowerCase() !== 'article') return;

        const isVideo = card.classList.contains('video-card');
        const url = card.getAttribute('data-watch-url') || card.getAttribute('data-task-url') || card.getAttribute('data-url');
        const secsAttr = card.getAttribute('data-secs') || card.getAttribute('data-watch-secs') || '10';
        const reward = Number(card.getAttribute('data-reward') || card.getAttribute('data-watch-reward') || 0);
        const smartlink = card.getAttribute('data-smartlink') || null;

        if (!url) {
          // fallback: show the built in video modal if no url
          if (isVideo && typeof openVideoModal === 'function') {
            return openVideoModal(card.getAttribute('data-title') || 'Video', card.getAttribute('data-duration') || '0:10', reward, card);
          }
          return;
        }

        // open inside browser iframe with countdown
        openBrowserPopupWithCountdown(url, {
          title: card.getAttribute('data-title') || (isVideo ? 'Watch Ad' : 'Task'),
          secs: Number(secsAttr),
          reward: reward,
          smartlink: smartlink,
          callbackUrl: card.getAttribute('data-callback') || null,
          payload: { userId: window.__gg_user_id || null, source: 'web', item: card.dataset }
        });

        // stop propagation to avoid top-level navigation
        e.stopPropagation();
        e.preventDefault();
      });
    });
  }

  /* ---------- 4) Handle bot deeplink hash -> allow: #iframe?payload=BASE64 or #task:... ---------- */
  function handleBotHashOpen() {
    try {
      const hash = (window.location.hash || '').slice(1);
      if (!hash) return;
      // formats allowed:
      // #iframe?payload=BASE64
      // #task?payload=BASE64
      const [path, query] = hash.split('?');
      if (!query) return;
      const params = new URLSearchParams(query);
      const payloadB64 = params.get('payload') || params.get('data') || '';
      if (!payloadB64) return;
      const jsonStr = (function decodeBase64Safe(s){
        try {
          // safe base64 decode (browser)
          return decodeURIComponent(escape(atob(s)));
        } catch(e) { try { return atob(s); } catch(e2){ return null; } }
      })(payloadB64);
      if (!jsonStr) return;
      let payload = null;
      try { payload = JSON.parse(jsonStr); } catch(e) { console.warn('payload json parse failed', e); return; }

      // map action
      if (path.toLowerCase().startsWith('iframe') || path.toLowerCase().startsWith('task')) {
        // open iframe with payload.target or payload.url
        const url = payload.url || payload.target || payload.link || payload.task_url || null;
        const secs = payload.secs || payload.duration || 10;
        const reward = payload.reward || 0;
        const smartlink = payload.smartlink || null;
        if (url) {
          openBrowserPopupWithCountdown(url, {
            title: payload.title || 'Task',
            secs: Number(secs),
            reward: Number(reward),
            smartlink: smartlink,
            callbackUrl: payload.callback_url || payload.callback || null,
            payload: payload
          });
        }
      } else if (path.toLowerCase().startsWith('watch')) {
        // similar for watch
        const url = payload.url || payload.watch_url;
        if (url) {
          openBrowserPopupWithCountdown(url, {
            title: payload.title || 'Watch Ad',
            secs: payload.secs || 10,
            reward: payload.reward || 0,
            callbackUrl: payload.callback_url || null,
            payload: payload
          });
        }
      }
    } catch (e) {
      console.warn('handleBotHashOpen failed', e);
    }
  }

  /* ---------- 5) initialization ---------- */
  function initPatches() {
    enableHorizontalSwipeLock();
    wireWatchAndTaskLinks();
    handleBotHashOpen();

    // also run wire periodically for dynamic cards
    setInterval(wireWatchAndTaskLinks, 1500);
  }

  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', initPatches);
  else initPatches();

})();

<script>
(function(){
  // pointer/touch horizontal scroller: prevents scroller from stealing vertical scroll
  const scroller = document.getElementById('task-platforms');
  const taskList = document.getElementById('task-list');

  if (scroller) {
    (function attachDrag(el){
      let active=false, startX=0, startY=0, startScroll=0, lock=null;
      el.addEventListener('pointerdown', e=>{
        if(e.pointerType === 'mouse' && e.button !== 0) return;
        active=true; startX=e.clientX; startY=e.clientY; startScroll=el.scrollLeft; lock=null;
        try{ el.setPointerCapture(e.pointerId); }catch(e){}
      }, {passive:true});
      el.addEventListener('pointermove', e=>{
        if(!active) return;
        const dx=e.clientX-startX, dy=e.clientY-startY;
        if(!lock){
          if(Math.abs(dx) > 8 && Math.abs(dx) > Math.abs(dy)) lock='x';
          else if(Math.abs(dy) > 8 && Math.abs(dy) > Math.abs(dx)) lock='y';
        }
        if(lock==='x'){
          if(e.cancelable) e.preventDefault();
          el.scrollLeft = startScroll - dx;
        }
      }, {passive:false});
      el.addEventListener('pointerup', e=>{ active=false; try{ el.releasePointerCapture(e.pointerId); }catch(e){} }, {passive:true});
      el.addEventListener('pointercancel', ()=> active=false, {passive:true});
      // touch fallback
      el.addEventListener('touchstart', ev=>{
        const t=ev.touches[0]; active=true; startX=t.clientX; startY=t.clientY; startScroll=el.scrollLeft; lock=null;
      }, {passive:true});
      el.addEventListener('touchmove', ev=>{
        if(!active) return;
        const t=ev.touches[0]; const dx=t.clientX-startX, dy=t.clientY-startY;
        if(!lock){
          if(Math.abs(dx) > 8 && Math.abs(dx) > Math.abs(dy)) lock='x';
          else if(Math.abs(dy) > 8 && Math.abs(dy) > Math.abs(dx)) lock='y';
        }
        if(lock==='x'){
          if(ev.cancelable) ev.preventDefault();
          el.scrollLeft = startScroll - dx;
        }
      }, {passive:false});
      el.addEventListener('touchend', ()=> active=false, {passive:true});
    })(scroller);
  }

  // chip filtering
  function filterTasks(platform){
    if(!taskList) return;
    const cards = taskList.querySelectorAll('.task-card');
    cards.forEach(c=>{
      if(!platform) { c.style.display=''; return; }
      const p = c.getAttribute('data-platform') || '';
      c.style.display = (p === platform) ? '' : 'none';
    });
  }

  // attach chip clicks
  if(scroller){
    scroller.addEventListener('click', e=>{
      const btn = e.target.closest('.platform-chip');
      if(!btn) return;
      const platform = btn.getAttribute('data-platform') || '';
      // reset all chips
      scroller.querySelectorAll('.platform-chip').forEach(c=>{
        c.classList.remove('active'); c.setAttribute('aria-pressed','false');
      });
      if(platform){
        btn.classList.add('active'); btn.setAttribute('aria-pressed','true');
        filterTasks(platform);
      } else {
        // "All" selected
        btn.classList.add('active'); btn.setAttribute('aria-pressed','true');
        filterTasks('');
      }
    });
  }

  // openTaskModal: loads smartlink pre-roll then main url inside existing #task-modal .browser-content
  window.openTaskModal = function(title, caller){
    try {
      const modal = document.getElementById('task-modal');
      const titleEl = document.getElementById('task-modal-title');
      const browserContent = modal.querySelector('.browser-content');

      // find card
      let card = null;
      if(!caller) card = document.querySelector('.task-card');
      else card = caller.closest ? caller.closest('.task-card') : null;
      if(!card) card = document.querySelector('.task-card');
      const url = card.getAttribute('data-task-url') || '';
      const reward = parseInt((card.querySelector('.task-reward span')||{textContent:'0'}).textContent) || 0;
      const platform = card.getAttribute('data-platform') || '';

      if(titleEl) titleEl.textContent = title || 'Task Loading...';

      // smartlink fallback (choose first that is different)
      const smartLinks = ['https://otieu.com/4/10176113','https://otieu.com/4/10176184','https://otieu.com/4/10176114','https://otieu.com/4/10176185'];
      let fallback = smartLinks.find(s=>s !== url) || smartLinks[0];

      // render pre-roll iframe
      browserContent.innerHTML = `
        <div style="text-align:center;padding:8px 6px;">
          <div style="margin-bottom:10px;color:var(--text-secondary)">Pre-roll ad â€” loading</div>
          <div style="width:100%;height:360px;border-radius:12px;overflow:hidden;background:var(--bg-panel);">
            <iframe id="task-iframe" src="${fallback}" style="width:100%;height:100%;border:0;" sandbox="allow-same-origin allow-scripts allow-forms allow-popups"></iframe>
          </div>
          <div style="margin-top:12px;color:var(--text-secondary)">Opening task in <strong id="preroll-count">3</strong>s</div>
        </div>
      `;
      modal.classList.add('active');

      // preroll countdown then load main url
      let pre=3;
      const prEl = document.getElementById('preroll-count');
      const iframe = document.getElementById('task-iframe');
      const preTimer = setInterval(()=>{
        pre--; prEl.textContent = pre;
        if(pre<=0){
          clearInterval(preTimer);
          // if platform is 'youtube' or 'website' you may want to open new tab -- but we will load in iframe for consistent UX
          if(url) iframe.src = url;
          // start main timer based on reward
          const duration = Math.max(8, Math.min(600, Math.floor((reward/10)*6))); // mapping reward->seconds
          startTaskMainTimer(duration, modal, card, url, reward);
        }
      },1000);

    } catch(e){
      console.error('openTaskModal error', e);
    }
  };

  // start main task timer and show abort/complete UI
  function startTaskMainTimer(totalSeconds, modal, card, url, reward){
    const browserContent = modal.querySelector('.browser-content');
    // append UI below iframe for countdown + abort
    const uiWrap = document.createElement('div');
    uiWrap.style.cssText = 'text-align:center;padding:12px;color:var(--text-secondary)';
    uiWrap.innerHTML = `<div>Task runs for <span id="main-count">${totalSeconds}</span>s</div>
                        <div style="margin-top:10px;"><button class="submit-btn" id="abort-task">Abort</button></div>`;
    browserContent.appendChild(uiWrap);

    let remaining = totalSeconds;
    const mainCountEl = uiWrap.querySelector('#main-count');

    const tick = setInterval(()=>{
      remaining--;
      if(mainCountEl) mainCountEl.textContent = remaining;
      if(remaining <= 0){
        clearInterval(tick);
        // mark completed: update card, animate coin, update balance, close modal etc
        try { card.classList.add('watched'); card.setAttribute('data-watched','true'); } catch(e){}
        animateCoinFly(card);
        updateBalance(reward);
        // show completion UI
        browserContent.innerHTML = `<div style="text-align:center;padding:24px;">
          <svg width="80" height="80" viewBox="0 0 100 100"><circle cx="50" cy="50" r="48" fill="rgba(74,163,255,0.12)" stroke="#4AA3FF" stroke-width="3"/><path d="M30 50L43 63L70 36" stroke="#4AA3FF" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <h3 style="color:var(--white)">Task complete</h3>
          <p style="color:var(--text-secondary)">You've earned +${reward} G-coins</p>
          <div style="margin-top:12px;"><button class="submit-btn" onclick="closeTaskModal()">Close</button></div>
        </div>`;
        // send payload to bot webhook if incomingPayload exists
        try {
          if(window.incomingPayload && window.incomingPayload.callback_url){
            const payload = {
              action:'task_complete',
              user_id: window.incomingPayload.user_id || null,
              reward: reward,
              task_url: url || null,
              timestamp: Date.now()
            };
            fetch(window.incomingPayload.callback_url, {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}).catch(()=>{});
          }
        } catch(e){}
      }
    },1000);

    // abort button handler
    const abortBtn = document.getElementById('abort-task');
    if(abortBtn) abortBtn.onclick = function(){
      clearInterval(tick);
      closeTaskModal();
      showInlineMessage('Task aborted.');
    };
  }

  // helpers used by the rest of your UI
  function animateCoinFly(source){
    try {
      const rect = source.getBoundingClientRect();
      const coin = document.createElement('div');
      coin.className = 'coin-animation';
      coin.style.left = (rect.left + rect.width/2) + 'px';
      coin.style.top = (rect.top + rect.height/2) + 'px';
      coin.innerHTML = '<svg width="32" height="32" viewBox="0 0 32 32" fill="none"><circle cx="16" cy="16" r="15" fill="#FFC857" stroke="#FFD87A"/><text x="16" y="22" text-anchor="middle" fill="#0B0B0D" font-size="18" font-weight="700">G</text></svg>';
      document.body.appendChild(coin);
      setTimeout(()=> coin.remove(), 700);
    } catch(e){}
  }

  function updateBalance(amount){
    const el = document.getElementById('balance-text');
    if(!el) return;
    const cur = parseInt(el.textContent.replace(/,/g,'')) || 0;
    el.textContent = (cur + Number(amount || 0)).toLocaleString();
  }

  // decode Base64 payload from hash/query (bot should pass: https://.../#payload=BASE64 or ?payload=BASE64)
  window.applyIncomingBase64Payload = function(b64){
    try {
      const s = b64.replace(/-/g,'+').replace(/_/g,'/');
      const json = decodeURIComponent(escape(atob(s)));
      window.incomingPayload = JSON.parse(json);
    } catch(e){ console.warn('payload decode failed', e); }
  };
  window.addEventListener('load', ()=>{
    try {
      const h = location.hash || '';
      if(h.includes('payload=')){
        const m = /payload=([^&]+)/.exec(h);
        if(m && m[1]) window.applyIncomingBase64Payload(decodeURIComponent(m[1]));
      } else {
        const q = new URLSearchParams(location.search);
        if(q.has('payload')) window.applyIncomingBase64Payload(q.get('payload'));
      }
    } catch(e){}
  });

})();

<!-- Paste this just before </body> -->
<script>
(function(){
  // run when DOM ready
  function ready(fn){ if(document.readyState !== 'loading') fn(); else document.addEventListener('DOMContentLoaded', fn); }

  ready(function(){
    // helpers
    function showConsoleWarn(msg){ try{ console.warn(msg); }catch(e){} }
    function showInlineNotice(text){
      try {
        const id = 'task-scroller-notice';
        let n = document.getElementById(id);
        if(!n){
          n = document.createElement('div');
          n.id = id;
          n.style.cssText = 'position:fixed;top:86px;left:50%;transform:translateX(-50%);z-index:1200;padding:10px 16px;border-radius:10px;background:rgba(11,11,13,0.94);color:var(--text-secondary);font-size:13px;box-shadow:0 6px 20px rgba(0,0,0,0.4)';
          document.body.appendChild(n);
        }
        n.textContent = text;
        setTimeout(()=>{ n.style.opacity = '0'; n.style.transition = 'all .35s ease'; setTimeout(()=>{ try{ n.remove(); }catch(e){} },350); }, 3000);
      } catch(e){}
    }

    // find/create scroller and task list
    let taskList = document.getElementById('task-list') || document.querySelector('.task-list');
    if(!taskList){
      showConsoleWarn('#task-list not found. Make sure your task HTML exists.');
      showInlineNotice('Task UI: task-list missing. Check page markup.');
      return;
    }

    // ensure scroller container exists above taskList
    let scroller = document.getElementById('task-platforms');
    if(!scroller){
      scroller = document.createElement('div');
      scroller.id = 'task-platforms';
      scroller.className = 'social-scroll';
      taskList.parentNode.insertBefore(scroller, taskList);
    }

    // inject minimal scroller CSS if not present (safe fallback)
    (function ensureCSS(){
      const id = 'task-scroller-fallback-css';
      if(document.getElementById(id)) return;
      const css = `
        .social-scroll{ display:flex; gap:12px; padding:8px 6px; overflow-x:auto; overflow-y:hidden; -webkit-overflow-scrolling:touch; scroll-snap-type:x proximity; overscroll-behavior-x: contain; box-sizing:border-box;}
        .social-scroll .platform-chip{ scroll-snap-align:start; flex:0 0 auto; min-width:92px; max-width:140px; padding:8px 12px; border-radius:999px; background:rgba(255,255,255,0.02); color:var(--text-secondary); display:inline-flex; gap:8px; align-items:center; justify-content:center; font-weight:600; cursor:pointer; border:none; }
        .social-scroll .platform-chip.active, .social-scroll .platform-chip[aria-pressed="true"]{ background:linear-gradient(135deg,var(--deep-purple),var(--vivid-magenta)); color:var(--white); }
        .social-scroll .chip-icon{ width:28px; height:28px; display:inline-flex; align-items:center; justify-content:center; }
      `;
      const s = document.createElement('style'); s.id = id; s.appendChild(document.createTextNode(css)); document.head.appendChild(s);
    })();

    // build platform list from task cards
    function detectPlatformFromCard(card){
      // 1) explicit data-platform
      const dp = (card.getAttribute && card.getAttribute('data-platform')) ? card.getAttribute('data-platform').trim().toLowerCase() : '';
      if(dp) return dp;

      // 2) look for platform-icon class inside
      const icon = card.querySelector && (card.querySelector('.platform-icon') || card.querySelector('[class*="platform-icon"]'));
      if(icon){
        const cls = Array.from(icon.classList || []).join(' ');
        const names = ['youtube','telegram','whatsapp','website','twitter','tiktok','instagram','facebook','discord','x'];
        for(const n of names){
          if(cls.indexOf(n) !== -1) return n;
        }
      }

      // 3) try to infer from title text inside card
      const title = (card.querySelector && (card.querySelector('.task-title') || card.querySelector('h3') || card.querySelector('.post-content'))) ?
                    (card.querySelector('.task-title')||card.querySelector('h3')||card.querySelector('.post-content')).textContent.toLowerCase() : '';
      if(title){
        if(title.includes('youtube')) return 'youtube';
        if(title.includes('telegram')) return 'telegram';
        if(title.includes('whatsapp')) return 'whatsapp';
        if(title.includes('instagram')) return 'instagram';
        if(title.includes('tiktok')) return 'tiktok';
        if(title.includes('twitter') || title.includes('x ')) return 'twitter';
        if(title.includes('facebook')) return 'facebook';
        if(title.includes('discord')) return 'discord';
        if(title.includes('visit') || title.includes('website') || title.includes('sign up')) return 'website';
      }

      // 4) fallback
      return 'other';
    }

    // collect cards (allow dynamic changes â€” re-read)
    const cards = Array.from(taskList.querySelectorAll('.task-card'));
    if(cards.length === 0){
      // try global search for task-card class (in case structure differs)
      const alt = Array.from(document.querySelectorAll('.task-card'));
      if(alt.length) alt.forEach(c => taskList.appendChild(c)); // move into list
    }

    const finalCards = Array.from(taskList.querySelectorAll('.task-card'));
    if(finalCards.length === 0){
      showConsoleWarn('No .task-card elements found inside #task-list. Nothing to populate.');
      // show friendly placeholder inside scroller
      scroller.innerHTML = '<div style="color:var(--text-secondary);padding:10px;">No tasks available</div>';
      return;
    }

    // build unique platforms preserving order
    const platformOrder = [];
    const platformMap = new Map();
    finalCards.forEach(card=>{
      const p = detectPlatformFromCard(card) || 'other';
      if(!platformMap.has(p)){
        platformMap.set(p, {key:p, label: p === 'other' ? 'Other' : p.replace(/-/g,' ').replace(/\b\w/g, c=>c.toUpperCase())});
        platformOrder.push(p);
      }
      // ensure card has attribute for easier filtering later
      card.setAttribute('data-platform', card.getAttribute('data-platform') || detectPlatformFromCard(card));
    });

    // build chips: All + platforms
    scroller.innerHTML = '';
    const createChip = (key, label, active) => {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'platform-chip' + (active ? ' active' : '');
      btn.setAttribute('aria-pressed', active ? 'true' : 'false');
      if(key) btn.setAttribute('data-platform', key);
      btn.innerHTML = `<span class="chip-icon">${String(label).split(' ')[0].slice(0,2).toUpperCase()}</span><span style="margin-left:8px">${label}</span>`;
      return btn;
    };

    scroller.appendChild(createChip('', 'All', true));
    platformOrder.forEach((p, idx) => {
      const meta = platformMap.get(p);
      scroller.appendChild(createChip(p, meta.label, false));
    });

    // attach chip click handler (delegated)
    scroller.addEventListener('click', function(e){
      const btn = e.target.closest('.platform-chip');
      if(!btn) return;
      const platform = btn.getAttribute('data-platform') || '';
      // toggle active state
      Array.from(scroller.querySelectorAll('.platform-chip')).forEach(c => { c.classList.remove('active'); c.setAttribute('aria-pressed','false'); });
      btn.classList.add('active'); btn.setAttribute('aria-pressed','true');
      // filter cards
      Array.from(taskList.querySelectorAll('.task-card')).forEach(card=>{
        const cp = (card.getAttribute('data-platform')||'').toLowerCase();
        card.style.display = (!platform || cp === platform.toLowerCase()) ? '' : 'none';
      });
    }, {passive:true});

    // pointer/touch scroller attachment (prevents vertical scroll stealing)
    (function attachDrag(el){
      if(!el) return;
      let active=false, startX=0, startY=0, startScroll=0, lock=null;
      el.addEventListener('pointerdown', e=>{
        if(e.pointerType === 'mouse' && e.button !== 0) return;
        active=true; startX=e.clientX; startY=e.clientY; startScroll=el.scrollLeft; lock=null;
        try{ el.setPointerCapture(e.pointerId); }catch(e){}
      }, {passive:true});
      el.addEventListener('pointermove', e=>{
        if(!active) return;
        const dx=e.clientX-startX, dy=e.clientY-startY;
        if(!lock){
          if(Math.abs(dx) > 8 && Math.abs(dx) > Math.abs(dy)) lock='x';
          else if(Math.abs(dy) > 8 && Math.abs(dy) > Math.abs(dx)) lock='y';
        }
        if(lock==='x'){
          if(e.cancelable) e.preventDefault();
          el.scrollLeft = startScroll - dx;
        }
      }, {passive:false});
      el.addEventListener('pointerup', e=>{ active=false; try{ el.releasePointerCapture(e.pointerId); }catch(e){} }, {passive:true});
      el.addEventListener('pointercancel', ()=> active=false, {passive:true});
      // touch fallback
      el.addEventListener('touchstart', ev=>{
        const t=ev.touches[0]; active=true; startX=t.clientX; startY=t.clientY; startScroll=el.scrollLeft; lock=null;
      }, {passive:true});
      el.addEventListener('touchmove', ev=>{
        if(!active) return;
        const t=ev.touches[0]; const dx=t.clientX-startX, dy=t.clientY-startY;
        if(!lock){
          if(Math.abs(dx) > 8 && Math.abs(dx) > Math.abs(dy)) lock='x';
          else if(Math.abs(dy) > 8 && Math.abs(dy) > Math.abs(dx)) lock='y';
        }
        if(lock==='x'){
          if(ev.cancelable) ev.preventDefault();
          el.scrollLeft = startScroll - dx;
        }
      }, {passive:false});
      el.addEventListener('touchend', ()=> active=false, {passive:true});
    })(scroller);

    // expose filter function globally (optional)
    window.filterTasks = function(platform){
      Array.from(taskList.querySelectorAll('.task-card')).forEach(card=>{
        const cp = (card.getAttribute('data-platform')||'').toLowerCase();
        card.style.display = (!platform || cp === platform.toLowerCase()) ? '' : 'none';
      });
    };

    // ensure visible
    scroller.style.display = 'flex';
    taskList.style.display = '';

    // final debug log
    console.log('Task scroller ready â€” platforms:', platformOrder);
  });
})();



  </script>
 </body>
</html>