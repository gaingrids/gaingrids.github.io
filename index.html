<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GainGrid Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Monetag Ad SDK -->
    <script>
        (function() {
            var script = document.createElement('script');
            script.src = 'https://cdn.monetag.com/tag.min.js';
            script.setAttribute('data-manual', 'true');
            document.head.appendChild(script);
        })();
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --deep-purple: #5B2E8A;
            --vivid-magenta: #E33D7A;
            --soft-pink: #FF98BD;
            --electric-blue: #4AA3FF;
            --bg-dark: #0F0F14;
            --bg-panel: #0B0B0D;
            --text-secondary: #9AA0A6;
            --gcoin-gold: #FFC857;
            --white: #FFFFFF;
            --spacing-base: 8px;
            --radius-xs: 6px;
            --radius-sm: 12px;
            --radius-md: 16px;
            --radius-lg: 24px;
        }

        html, body {
            width: 100%;
            height: 100%;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-dark);
            color: var(--white);
            overflow-x: hidden;
        }

        .app-container {
            width: 100%;
            min-height: 100%;
            background: var(--bg-dark);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Header */
        .app-header {
            width: 100%;
            background: var(--bg-panel);
            padding: calc(var(--spacing-base) * 2) calc(var(--spacing-base) * 3);
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(12px);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-base) * 1.5);
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        .app-title {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--deep-purple), var(--vivid-magenta));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .balance-chip {
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-base) * 1);
            background: linear-gradient(135deg, rgba(91, 46, 138, 0.3), rgba(227, 61, 122, 0.3));
            padding: calc(var(--spacing-base) * 1) calc(var(--spacing-base) * 2);
            border-radius: var(--radius-lg);
            border: 1px solid rgba(255, 200, 87, 0.3);
        }

        .coin-icon {
            width: 20px;
            height: 20px;
            animation: spin 3s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }

        .balance-text {
            font-size: 14px;
            font-weight: 600;
            color: var(--gcoin-gold);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            width: 100%;
            padding: calc(var(--spacing-base) * 3) calc(var(--spacing-base) * 2);
            padding-bottom: calc(var(--spacing-base) * 10);
            overflow-y: auto;
        }

        .screen {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Feed Cards */
        .feed-container {
            display: flex;
            flex-direction: column;
            gap: calc(var(--spacing-base) * 2);
        }

        .post-card {
            background: var(--bg-panel);
            border-radius: var(--radius-md);
            padding: calc(var(--spacing-base) * 2);
            border: 1px solid rgba(255, 255, 255, 0.06);
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.18);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .post-card:hover {
            border-color: rgba(91, 46, 138, 0.4);
            transform: translateY(-2px);
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-base) * 1.5);
            margin-bottom: calc(var(--spacing-base) * 2);
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--deep-purple), var(--electric-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
        }

        .post-meta {
            flex: 1;
        }

        .poster-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--white);
            margin-bottom: 2px;
        }

        .post-time {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .post-content {
            font-size: 14px;
            line-height: 1.5;
            color: var(--white);
            margin-bottom: calc(var(--spacing-base) * 2);
        }

        .post-media {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, rgba(91, 46, 138, 0.2), rgba(74, 163, 255, 0.2));
            border-radius: var(--radius-sm);
            margin-bottom: calc(var(--spacing-base) * 2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 12px;
            overflow: hidden;
        }

        .post-media img,
        .post-media video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .earnings-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 200, 87, 0.1);
            padding: calc(var(--spacing-base) * 1) calc(var(--spacing-base) * 1.5);
            border-radius: var(--radius-xs);
            margin-bottom: calc(var(--spacing-base) * 2);
        }

        .earnings-label {
            font-size: 12px;
            color: var(--gcoin-gold);
            font-weight: 600;
        }

        .post-actions {
            display: flex;
            gap: calc(var(--spacing-base) * 2);
        }

        .action-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: calc(var(--spacing-base) * 1);
            padding: calc(var(--spacing-base) * 1.5);
            background: rgba(255, 255, 255, 0.05);
            border: none;
            border-radius: var(--radius-sm);
            color: var(--white);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.12s ease;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.05);
        }

        .action-btn.liked {
            background: rgba(227, 61, 122, 0.2);
            color: var(--vivid-magenta);
        }

        .action-icon {
            width: 16px;
            height: 16px;
        }

        /* Comment Section */
        .comments-section {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: rgba(0, 0, 0, 0.2);
        }

        .comments-section.expanded {
            max-height: 300px;
        }

        .comments-container {
            padding: calc(var(--spacing-base) * 2);
            max-height: 200px;
            overflow-y: auto;
        }

        .comment-item {
            padding: calc(var(--spacing-base) * 1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 13px;
        }

        .comment-user {
            font-weight: 600;
            color: var(--electric-blue);
        }

        .comment-input-container {
            padding: calc(var(--spacing-base) * 2);
            border-top: 1px solid rgba(255, 255, 255, 0.06);
            display: flex;
            gap: calc(var(--spacing-base) * 1);
        }

        .comment-input {
            flex: 1;
            padding: calc(var(--spacing-base) * 1);
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            color: var(--white);
            font-size: 14px;
        }

        .send-comment-btn {
            padding: calc(var(--spacing-base) * 1) calc(var(--spacing-base) * 2);
            background: var(--electric-blue);
            border: none;
            border-radius: var(--radius-sm);
            color: var(--white);
            cursor: pointer;
        }

        /* Task Board */
        .task-board-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: calc(var(--spacing-base) * 3);
        }

        .task-counter {
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-base) * 1);
            font-size: 14px;
        }

        .counter-label {
            color: var(--text-secondary);
        }

        .counter-value {
            font-weight: 700;
            color: var(--electric-blue);
        }

        /* Platform Scroller */
        .platform-scroller-container {
            width: 100%;
            overflow: hidden;
            margin-bottom: calc(var(--spacing-base) * 3);
            position: relative;
        }

        .platform-scroller {
            display: flex;
            gap: calc(var(--spacing-base) * 2);
            animation: scrollPlatforms 30s linear infinite;
            padding: calc(var(--spacing-base) * 1) 0;
        }

        .platform-scroller:hover {
            animation-play-state: paused;
        }

        @keyframes scrollPlatforms {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .platform-scroller-item {
            flex: 0 0 auto;
            width: 80px;
            background: var(--bg-panel);
            border-radius: var(--radius-md);
            padding: calc(var(--spacing-base) * 1.5);
            text-align: center;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.06);
            transition: all 0.2s ease;
        }

        .platform-scroller-item:hover {
            transform: translateY(-4px);
            border-color: var(--electric-blue);
            box-shadow: 0 4px 12px rgba(74, 163, 255, 0.2);
        }

        .platform-scroller-icon {
            width: 32px;
            height: 32px;
            margin: 0 auto calc(var(--spacing-base) * 1);
        }

        .platform-scroller-name {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: calc(var(--spacing-base) * 2);
        }

        .task-card {
            background: var(--bg-panel);
            border-radius: var(--radius-md);
            padding: calc(var(--spacing-base) * 2);
            border: 1px solid rgba(255, 255, 255, 0.06);
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.18);
        }

        .task-header {
            display: flex;
            align-items: start;
            justify-content: space-between;
            margin-bottom: calc(var(--spacing-base) * 2);
        }

        .task-info {
            flex: 1;
        }

        .task-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: calc(var(--spacing-base) * 1);
        }

        .task-description {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .task-reward {
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-base) * 0.5);
            padding: calc(var(--spacing-base) * 1) calc(var(--spacing-base) * 1.5);
            background: rgba(255, 200, 87, 0.15);
            border-radius: var(--radius-lg);
            font-size: 14px;
            font-weight: 700;
            color: var(--gcoin-gold);
        }

        .task-footer {
            display: flex;
            gap: calc(var(--spacing-base) * 1.5);
        }

        .task-btn {
            flex: 1;
            padding: calc(var(--spacing-base) * 1.5);
            border: none;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.12s ease;
        }

        .task-btn.primary {
            background: linear-gradient(135deg, var(--deep-purple), var(--vivid-magenta));
            color: var(--white);
        }

        .task-btn.primary:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(91, 46, 138, 0.4);
        }

        .task-btn.secondary {
            background: rgba(255, 255, 255, 0.05);
            color: var(--white);
        }

        .task-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Watch & Earn */
        .watch-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: calc(var(--spacing-base) * 2);
        }

        .video-card {
            background: var(--bg-panel);
            border-radius: var(--radius-md);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.06);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .video-card:hover {
            transform: translateY(-4px);
            border-color: rgba(74, 163, 255, 0.4);
        }

        .video-thumbnail {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, rgba(91, 46, 138, 0.3), rgba(74, 163, 255, 0.3));
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .play-icon {
            width: 48px;
            height: 48px;
            opacity: 0.9;
        }

        .video-duration {
            position: absolute;
            bottom: calc(var(--spacing-base) * 1);
            right: calc(var(--spacing-base) * 1);
            background: rgba(0, 0, 0, 0.8);
            padding: calc(var(--spacing-base) * 0.5) calc(var(--spacing-base) * 1);
            border-radius: var(--radius-xs);
            font-size: 12px;
            font-weight: 600;
        }

        .video-info {
            padding: calc(var(--spacing-base) * 2);
        }

        .video-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: calc(var(--spacing-base) * 1);
        }

        .video-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .video-reward {
            color: var(--gcoin-gold);
            font-weight: 600;
        }

        /* Profile */
        .profile-section {
            display: flex;
            flex-direction: column;
            gap: calc(var(--spacing-base) * 3);
        }

        .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: calc(var(--spacing-base) * 2);
            padding: calc(var(--spacing-base) * 3);
            background: var(--bg-panel);
            border-radius: var(--radius-md);
            border: 1px solid rgba(255, 255, 255, 0.06);
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--deep-purple), var(--vivid-magenta));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 700;
            border: 3px solid rgba(255, 255, 255, 0.1);
        }

        .profile-name {
            font-size: 20px;
            font-weight: 700;
        }

        .profile-username {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: calc(var(--spacing-base) * 2);
            width: 100%;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: calc(var(--spacing-base) * 0.5);
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--electric-blue);
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .profile-menu {
            display: flex;
            flex-direction: column;
            gap: 0;
            background: var(--bg-panel);
            border-radius: var(--radius-md);
            border: 1px solid rgba(255, 255, 255, 0.06);
            overflow: hidden;
        }

        .menu-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: calc(var(--spacing-base) * 1.5) calc(var(--spacing-base) * 2);
            background: transparent;
            border: none;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            color: var(--white);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.12s ease;
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .menu-icon {
            width: 20px;
            height: 20px;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            background: var(--bg-panel);
            border-top: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            justify-content: space-around;
            padding: calc(var(--spacing-base) * 1.5) 0;
            z-index: 100;
            backdrop-filter: blur(12px);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: calc(var(--spacing-base) * 0.5);
            padding: calc(var(--spacing-base) * 1) calc(var(--spacing-base) * 2);
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.12s ease;
            text-decoration: none;
        }

        .nav-item:hover {
            color: var(--white);
        }

        .nav-item.active {
            color: var(--electric-blue);
        }

        .nav-item.active .nav-icon {
            transform: scale(1.1);
        }

        .nav-icon {
            width: 24px;
            height: 24px;
            transition: transform 0.12s ease;
        }

        /* FAB - Floating Action Button (Pen Icon) */
        .fab {
            position: fixed;
            bottom: calc(var(--spacing-base) * 12);
            right: calc(var(--spacing-base) * 2);
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--vivid-magenta), var(--soft-pink));
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(227, 61, 122, 0.4);
            transition: all 0.3s ease;
            z-index: 99;
            opacity: 1;
            transform: translateY(0);
        }

        .fab.hidden {
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
        }

        .fab:hover {
            transform: scale(1.1) translateY(-2px);
            box-shadow: 0 6px 24px rgba(227, 61, 122, 0.6);
        }

        .fab-icon {
            width: 24px;
            height: 24px;
        }

        /* Modal Overlay */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 200;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: calc(var(--spacing-base) * 2);
        }

        .modal-content {
            width: 100%;
            max-width: 500px;
            background: var(--bg-panel);
            border-radius: var(--radius-md);
            padding: calc(var(--spacing-base) * 3);
            border: 1px solid rgba(255, 255, 255, 0.08);
            position: relative;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: calc(var(--spacing-base) * 3);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }

        .close-btn {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.05);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.12s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        .close-icon {
            width: 16px;
            height: 16px;
        }

        .composer-form {
            display: flex;
            flex-direction: column;
            gap: calc(var(--spacing-base) * 2);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: calc(var(--spacing-base) * 1);
        }

        .form-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: calc(var(--spacing-base) * 1.5);
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            color: var(--white);
            font-size: 14px;
            font-family: inherit;
            transition: all 0.12s ease;
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--electric-blue);
            background: rgba(255, 255, 255, 0.08);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .submit-btn {
            padding: calc(var(--spacing-base) * 2);
            background: linear-gradient(135deg, var(--deep-purple), var(--vivid-magenta));
            border: none;
            border-radius: var(--radius-sm);
            color: var(--white);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.12s ease;
        }

        .submit-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 16px rgba(91, 46, 138, 0.4);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* File Drop Area */
        .file-drop-area {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-md);
            padding: calc(var(--spacing-base) * 3);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-drop-area:hover {
            border-color: var(--electric-blue);
            background: rgba(74, 163, 255, 0.05);
        }

        .file-drop-area.dragover {
            border-color: var(--vivid-magenta);
            background: rgba(227, 61, 122, 0.05);
        }

        .file-drop-icon {
            width: 48px;
            height: 48px;
            margin-bottom: calc(var(--spacing-base) * 1);
            color: var(--text-secondary);
        }

        .file-drop-text {
            color: var(--text-secondary);
            margin-bottom: calc(var(--spacing-base) * 0.5);
        }

        .file-drop-hint {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .preview-container {
            margin-top: calc(var(--spacing-base) * 2);
            display: flex;
            flex-wrap: wrap;
            gap: calc(var(--spacing-base) * 1);
        }

        .preview-item {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: var(--radius-sm);
            overflow: hidden;
        }

        .preview-item img,
        .preview-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .remove-preview {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 20px;
            height: 20px;
            background: rgba(0, 0, 0, 0.7);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Browser Frame Modal */
        .browser-frame {
            width: 100%;
            height: 70vh;
            background: var(--bg-panel);
            border-radius: var(--radius-md);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .browser-header {
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-base) * 1);
            padding: calc(var(--spacing-base) * 1.5);
            background: rgba(255, 255, 255, 0.03);
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        }

        .browser-dots {
            display: flex;
            gap: calc(var(--spacing-base) * 0.75);
        }

        .browser-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--text-secondary);
        }

        .browser-url {
            flex: 1;
            padding: calc(var(--spacing-base) * 0.75) calc(var(--spacing-base) * 1.5);
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-xs);
            font-size: 12px;
            color: var(--text-secondary);
        }

        .browser-content {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .browser-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Timer Bottom Bar */
        .timer-bottom-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(11, 11, 13, 0.95);
            padding: calc(var(--spacing-base) * 2);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            gap: calc(var(--spacing-base) * 1);
            z-index: 10;
        }

        .timer-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .timer-display {
            font-size: 18px;
            font-weight: 700;
            color: var(--electric-blue);
        }

        .timer-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .timer-progress {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .timer-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--electric-blue), var(--soft-pink));
            width: 0%;
            transition: width 1s linear;
        }

        .claim-button {
            width: 100%;
            padding: calc(var(--spacing-base) * 1.5);
            background: linear-gradient(135deg, var(--gcoin-gold), #FFD87A);
            border: none;
            border-radius: var(--radius-sm);
            color: var(--bg-dark);
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .claim-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .toast {
            background: var(--bg-panel);
            border-left: 4px solid var(--electric-blue);
            border-radius: var(--radius-sm);
            padding: calc(var(--spacing-base) * 2);
            margin-bottom: calc(var(--spacing-base) * 1);
            min-width: 300px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            animation: slideInRight 0.3s ease;
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-base) * 1);
        }

        .toast.success {
            border-left-color: #10B981;
        }

        .toast.error {
            border-left-color: #EF4444;
        }

        .toast.warning {
            border-left-color: #F59E0B;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-icon {
            width: 20px;
            height: 20px;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .toast-message {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .close-toast {
            background: none;
            border: none;
            color: var(--text-tertiary);
            cursor: pointer;
            padding: 4px;
        }

        /* VIP Badge */
        .vip-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 12px;
            border-radius: var(--radius-lg);
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .vip-badge.none {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-tertiary);
        }

        .vip-badge.basic {
            background: rgba(139, 92, 246, 0.2);
            color: #8B5CF6;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .vip-badge.silver {
            background: rgba(156, 163, 175, 0.2);
            color: #9CA3AF;
            border: 1px solid rgba(156, 163, 175, 0.3);
        }

        .vip-badge.gold {
            background: rgba(245, 158, 11, 0.2);
            color: #F59E0B;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .vip-badge.premium {
            background: rgba(239, 68, 68, 0.2);
            color: #EF4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--electric-blue);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (min-width: 768px) {
            .app-container {
                max-width: 430px;
                margin: 0 auto;
            }

            .watch-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Animation for coin earning */
        @keyframes coinFly {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            50% {
                transform: translate(-100px, -150px) scale(1.5);
                opacity: 0.8;
            }
            100% {
                transform: translate(-200px, -250px) scale(0.5);
                opacity: 0;
            }
        }

        .coin-animation {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
            animation: coinFly 0.6s ease-out forwards;
        }
    </style>
</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- App Container -->
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="logo-section">
                <svg class="logo-icon" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="32" height="32" rx="8" fill="url(#logo-gradient)" />
                    <path d="M10 16L14 20L22 12" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" />
                    <defs>
                        <linearGradient id="logo-gradient" x1="0" y1="0" x2="32" y2="32">
                            <stop stop-color="#5B2E8A" />
                            <stop offset="1" stop-color="#E33D7A" />
                        </linearGradient>
                    </defs>
                </svg>
                <h1 class="app-title" id="app-title">GainGrid</h1>
            </div>
            <div class="balance-chip">
                <svg class="coin-icon" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="10" cy="10" r="9" fill="#FFC857" stroke="#FFD87A" stroke-width="1" />
                    <text x="10" y="14" text-anchor="middle" fill="#0B0B0D" font-size="12" font-weight="700">G</text>
                </svg>
                <span class="balance-text" id="balance-text">0</span>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- GridHome Screen -->
            <section class="screen active" id="gridhome-screen">
                <div class="feed-container" id="feedContainer">
                    <!-- Posts will be dynamically loaded here -->
                </div>
            </section>

            <!-- Task Board Screen -->
            <section class="screen" id="tasks-screen">
                <div class="task-board-header">
                    <div class="task-counter">
                        <span class="counter-label">Tasks today:</span>
                        <span class="counter-value" id="task-counter">0/20</span>
                    </div>
                </div>

                <!-- Platform Scroller -->
                <div class="platform-scroller-container">
                    <div class="platform-scroller" id="platformScroller">
                        <!-- Platform items will be dynamically added here -->
                    </div>
                </div>

                <div class="task-list" id="taskList">
                    <!-- Tasks will be dynamically loaded here -->
                </div>
            </section>

            <!-- Watch & Earn Screen -->
            <section class="screen" id="watch-screen">
                <div class="watch-header">
                    <div class="watch-stats">
                        <div class="watch-remaining">
                            Daily limit: <strong id="ads-counter">20/20</strong>
                        </div>
                        <button class="cleanup-btn" id="cleanupWatchedBtn">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M2 4H14M6 7V11M10 7V11M3 4L4 13C4 13.5 4.5 14 5 14H11C11.5 14 12 13.5 12 13L13 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                            </svg>
                            Clean Up
                        </button>
                    </div>
                </div>

                <div class="watch-grid" id="watchGrid">
                    <!-- Ads will be dynamically loaded here -->
                </div>
            </section>

            <!-- Profile Screen -->
            <section class="screen" id="profile-screen">
                <div class="profile-section">
                    <div class="profile-header">
                        <div class="profile-avatar" id="profileAvatar">JD</div>
                        <h2 class="profile-name" id="profileName">Loading...</h2>
                        <p class="profile-username" id="profileUsername">@loading</p>
                        <div class="vip-badge none" id="vipBadge">No VIP</div>
                    </div>

                    <div class="profile-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="statGcoins">0</div>
                            <div class="stat-label">G-Coins</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="statTotalEarned">0</div>
                            <div class="stat-label">Total Earned</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="statTasksDone">0</div>
                            <div class="stat-label">Tasks Done</div>
                        </div>
                    </div>

                    <div class="profile-menu">
                        <button class="menu-item" onclick="openProfileSection('edit')">
                            <div class="menu-text">
                                <svg class="menu-icon" viewBox="0 0 20 20" fill="none">
                                    <path d="M11 2H13C13.5 2 14 2.5 14 3V5M2 11V13C2 13.5 2.5 14 3 14H5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                    <circle cx="8" cy="8" r="3" stroke="currentColor" stroke-width="1.5" />
                                </svg>
                                Edit Profile
                            </div>
                            <svg class="menu-arrow" viewBox="0 0 16 16" fill="none">
                                <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </button>
                        <button class="menu-item" onclick="openProfileSection('transactions')">
                            <div class="menu-text">
                                <svg class="menu-icon" viewBox="0 0 20 20" fill="none">
                                    <path d="M13 2H17C17.5 2 18 2.5 18 3V7M2 13V17C2 17.5 2.5 18 3 18H7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                    <rect x="8" y="8" width="8" height="8" rx="1" stroke="currentColor" stroke-width="1.5" />
                                </svg>
                                Transaction History
                            </div>
                            <svg class="menu-arrow" viewBox="0 0 16 16" fill="none">
                                <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </button>
                        <button class="menu-item" onclick="openProfileSection('referrals')">
                            <div class="menu-text">
                                <svg class="menu-icon" viewBox="0 0 20 20" fill="none">
                                    <path d="M16 7C16 8.5 15.5 10 14 10C15.5 10 16 11.5 16 13C16 14.5 14.5 15 13 15M10 13H7C5.5 13 5 12.5 5 11V7C5 5.5 5.5 5 7 5H13C14.5 5 15 5.5 15 7V11C15 12.5 14.5 13 13 13H10ZM10 13V5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                Referrals
                            </div>
                            <svg class="menu-arrow" viewBox="0 0 16 16" fill="none">
                                <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </button>
                        <button class="menu-item" onclick="openProfileSection('settings')">
                            <div class="menu-text">
                                <svg class="menu-icon" viewBox="0 0 20 20" fill="none">
                                    <path d="M10 13C11.5 13 12.5 12 12.5 10.5C12.5 9 11.5 8 10 8C8.5 8 7.5 9 7.5 10.5C7.5 12 8.5 13 10 13Z" stroke="currentColor" stroke-width="1.5" />
                                    <path d="M15.5 10.5C15.5 14 13 16 10 16C7 16 4.5 14 4.5 10.5C4.5 7 7 5 10 5C13 5 15.5 7 15.5 10.5Z" stroke="currentColor" stroke-width="1.5" />
                                </svg>
                                Settings
                            </div>
                            <svg class="menu-arrow" viewBox="0 0 16 16" fill="none">
                                <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </button>
                        <button class="menu-item" onclick="openHelpSupport()">
                            <div class="menu-text">
                                <svg class="menu-icon" viewBox="0 0 20 20" fill="none">
                                    <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="1.5" />
                                    <path d="M10 14V10M10 6V6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                </svg>
                                Help & Support
                            </div>
                            <svg class="menu-arrow" viewBox="0 0 16 16" fill="none">
                                <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" onclick="switchScreen('gridhome')">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none">
                    <path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M9 22V12H15V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                GridHome
            </button>
            <button class="nav-item" onclick="switchScreen('tasks')">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none">
                    <path d="M9 11L12 14L22 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M21 12V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                Tasks
            </button>
            <button class="nav-item" onclick="switchScreen('watch')">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none">
                    <path d="M5 3L19 12L5 21V3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                Watch
            </button>
            <button class="nav-item" onclick="switchScreen('profile')">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none">
                    <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                Profile
            </button>
        </nav>

        <!-- FAB - Floating Action Button (Pen Icon) -->
        <button class="fab" id="fabButton" onclick="openComposer()">
            <svg class="fab-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 20H21" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M16.5 3.49998C16.8978 3.10216 17.4374 2.87866 18 2.87866C18.2786 2.87866 18.5544 2.93353 18.8118 3.04014C19.0692 3.14674 19.303 3.303 19.5 3.49998C19.697 3.69697 19.8532 3.93082 19.9598 4.18819C20.0665 4.44556 20.1213 4.72141 20.1213 4.99998C20.1213 5.27856 20.0665 5.55441 19.9598 5.81178C19.8532 6.06915 19.697 6.303 19.5 6.49998L7 19L3 20L4 16L16.5 3.49998Z" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
        </button>

        <!-- Modals -->

        <!-- Composer Modal -->
        <div class="modal-overlay" id="composer-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Create Post</h3>
                    <button class="close-btn" onclick="closeModal('composer-modal')">
                        <svg class="close-icon" viewBox="0 0 16 16" fill="none">
                            <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <form class="composer-form" id="postForm" onsubmit="submitPost(event)">
                        <div class="form-group">
                            <label class="form-label">Post Content</label>
                            <textarea class="form-textarea" id="postContent" placeholder="What do you want to share? Use # for hashtags and @ for mentions" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Link URL</label>
                            <input type="url" class="form-input" id="postLink" placeholder="https://example.com" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Action Type</label>
                            <select class="form-select" id="postActionType" required>
                                <option value="visit">Visit Website</option>
                                <option value="join">Join Group/Channel</option>
                                <option value="watch">Watch Video</option>
                                <option value="install">Install App</option>
                                <option value="signup">Sign Up</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Reward Amount (G-Coins)</label>
                            <input type="number" class="form-input" id="postReward" min="100" max="1000" value="100" required>
                            <div style="font-size: 12px; color: var(--text-tertiary); margin-top: 4px;">
                                Minimum: 100 G-Coins
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Media (Optional)</label>
                            <div class="file-drop-area" id="fileDropArea">
                                <svg class="file-drop-icon" viewBox="0 0 24 24" fill="none">
                                    <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                    <path d="M17 8L12 3L7 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                                    <path d="M12 3V15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                <div class="file-drop-text">Drag & drop images/videos or click to upload</div>
                                <div class="file-drop-hint">Supported: JPG, PNG, GIF, MP4 (max 10MB)</div>
                                <input type="file" id="mediaInput" accept="image/*,video/*" multiple style="display: none;">
                            </div>
                            <div class="preview-container" id="mediaPreview"></div>
                        </div>
                        
                        <button type="submit" class="submit-btn" id="postSubmitBtn">
                            <span id="submitBtnText">Publish Post</span>
                            <span id="submitBtnLoading" class="loading" style="display: none;"></span>
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Browser Modal -->
        <div class="modal-overlay" id="browser-modal">
            <div class="modal-content browser-frame">
                <div class="browser-header">
                    <div class="browser-dots">
                        <div class="browser-dot close" onclick="closeModal('browser-modal')"></div>
                        <div class="browser-dot minimize"></div>
                        <div class="browser-dot maximize"></div>
                    </div>
                    <div class="browser-url" id="browserUrl">https://task.gaingrid.com</div>
                </div>
                <div class="browser-content">
                    <iframe class="browser-iframe" id="browserIframe" sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox"></iframe>
                    <div class="timer-bottom-bar" id="timerBottomBar" style="display: none;">
                        <div class="timer-info">
                            <div class="timer-display" id="timerDisplay">00:00</div>
                            <div class="timer-label" id="timerLabel">Time remaining</div>
                        </div>
                        <div class="timer-progress">
                            <div class="timer-progress-bar" id="timerProgressBar"></div>
                        </div>
                        <button class="claim-button" id="claimButton" disabled onclick="claimReward()">Complete to Claim</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Section Modal -->
        <div class="modal-overlay" id="profile-section-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="profileSectionTitle">Profile Section</h3>
                    <button class="close-btn" onclick="closeModal('profile-section-modal')">
                        <svg class="close-icon" viewBox="0 0 16 16" fill="none">
                            <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                    </button>
                </div>
                <div class="modal-body" id="profileSectionContent">
                    <!-- Content loaded dynamically -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== GLOBAL STATE ====================
        const APP_STATE = {
            user: null,
            balance: 0,
            vipLevel: 'none',
            dailyCounters: {
                tasks: 0,
                ads: 0
            },
            posts: [],
            tasks: [],
            ads: [],
            currentTask: null,
            currentAd: null,
            currentPostId: null,
            timerInterval: null,
            isTelegramWebApp: false,
            WebApp: null,
            lastScrollY: 0
        };

        // Smart Links
        const SMART_LINKS = [
            'https://otieu.com/4/10176113',
            'https://otieu.com/4/10176184',
            'https://otieu.com/4/10176114',
            'https://otieu.com/4/10176185'
        ];

        // Platform SVG Icons (Using actual SVG paths)
        const PLATFORM_ICONS = {
            youtube: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FF0000"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/></svg>',
            telegram: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#0088cc"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.15-.357.15l.213-3.054 5.56-5.022c.241-.213-.054-.334-.373-.121l-6.869 4.326-2.962-.924c-.64-.203-.652-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z"/></svg>',
            whatsapp: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#25D366"><path d="M12.032 0c-6.627 0-12 5.373-12 12 0 2.126.553 4.125 1.524 5.861l-1.547 4.652 4.756-1.54c1.649.967 3.561 1.54 5.592 1.54 6.627 0 12-5.373 12-12s-5.373-12-12-12zm6.494 17.611c-.324.922-1.607 1.688-2.602 1.925-.694.165-1.6.298-4.433-1.037-3.415-1.593-5.586-5.293-5.753-5.536-.167-.242-1.429-1.889-1.429-3.595 0-1.706.869-2.548 1.166-2.858.292-.31.64-.388.868-.388.224 0 .356.006.512.006.165 0 .372-.007.596.293.224.303.769 1.021.834 1.095.065.074.13.161.195.322.065.161.033.303-.015.418-.048.115-.224.322-.385.515-.161.194-.336.403-.482.597-.107.139-.229.292-.097.597.13.306.589 1.298 1.278 2.104.882 1.025 1.635 1.354 1.94 1.508.306.154.486.129.677-.081.19-.211.807-.946 1.024-1.271.217-.325.434-.271.724-.161.29.11 1.832.865 2.146 1.024.315.159.525.238.602.37.077.13.077.756-.247 1.678z"/></svg>',
            instagram: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#E4405F"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm4.441 16.892c-2.102.144-6.784.144-8.883 0-2.276-.156-2.541-1.27-2.558-4.892.017-3.629.285-4.736 2.558-4.892 2.099-.144 6.782-.144 8.883 0 2.277.156 2.542 1.27 2.559 4.892-.018 3.629-.285 4.736-2.559 4.892zm-4.441-7.234c-1.332 0-2.412 1.08-2.412 2.412s1.08 2.412 2.412 2.412 2.412-1.08 2.412-2.412-1.08-2.412-2.412-2.412zm4.604 2.412c0 1.273-.772 2.373-1.883 2.848 1.112.475 1.883 1.574 1.883 2.848h2.668c0-3.021-2.449-5.47-5.47-5.47v2.67c1.274 0 2.373.772 2.848 1.883.475-1.111 1.574-1.882 2.848-1.882v-2.671c-3.021 0-5.47 2.449-5.47 5.47h2.671c0-1.274.771-2.373 1.882-2.848-.475-1.111-1.574-1.883-2.848-1.883z"/></svg>',
            twitter: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#1DA1F2"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.894 9.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.15-.357.15l.213-3.054 5.56-5.022c.241-.213-.054-.334-.373-.121l-6.869 4.326-2.962-.924c-.64-.203-.652-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z"/></svg>',
            tiktok: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#000000"><path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/></svg>',
            facebook: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#1877F2"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm3 8h-1.35c-.538 0-.65.221-.65.778v1.222h2l-.209 2h-1.791v7h-3v-7h-2v-2h2v-2.308c0-1.769.931-2.692 3.029-2.692h1.971v3z"/></svg>',
            discord: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#5865F2"><path d="M14.82 4.26c-.58-.27-1.2-.48-1.85-.64.14.34.26.69.35 1.04-1.56-.24-3.16-.24-4.72 0 .09-.35.21-.7.35-1.04-.65.16-1.27.37-1.85.64-2.85 4.27-3.61 8.43-3.22 12.59 1.63 1.2 3.41 1.98 5.25 2.41.45-.61.85-1.26 1.18-1.94-.65-.24-1.27-.56-1.85-.94.15-.11.3-.23.45-.35 3.14 1.46 6.56 1.46 9.7 0 .15.12.3.24.45.35-.58.38-1.2.7-1.85.94.33.68.73 1.33 1.18 1.94 1.84-.43 3.62-1.21 5.25-2.41.39-4.16-.37-8.32-3.22-12.59zm-8.32 10.05c-1.03 0-1.89-.95-1.89-2.12s.84-2.12 1.89-2.12 1.89.95 1.89 2.12-.84 2.12-1.89 2.12zm6.66 0c-1.03 0-1.89-.95-1.89-2.12s.84-2.12 1.89-2.12 1.89.95 1.89 2.12-.84 2.12-1.89 2.12z"/></svg>',
            website: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#4AA3FF"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-2 16h-2v-6h2v6zm-1-6.891c-.607 0-1.1-.496-1.1-1.109 0-.612.492-1.109 1.1-1.109s1.1.497 1.1 1.109c0 .613-.493 1.109-1.1 1.109zm8 6.891h-1.998v-2.861c0-1.881-2.002-1.722-2.002 0v2.861h-2v-6h2v1.093c.872-1.616 4-1.736 4 1.548v3.359z"/></svg>'
        };

        // Platform Names
        const PLATFORM_NAMES = {
            youtube: 'YouTube',
            telegram: 'Telegram',
            whatsapp: 'WhatsApp',
            instagram: 'Instagram',
            twitter: 'Twitter',
            tiktok: 'TikTok',
            facebook: 'Facebook',
            discord: 'Discord',
            website: 'Website'
        };

        // VIP Bonus Structure
        const VIP_BONUS = {
            none: 0,
            basic: 20,
            silver: 40,
            gold: 60,
            premium: 100
        };

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Initialize Telegram WebApp
                if (window.Telegram && window.Telegram.WebApp) {
                    APP_STATE.WebApp = window.Telegram.WebApp;
                    APP_STATE.isTelegramWebApp = true;
                    APP_STATE.WebApp.ready();
                    APP_STATE.WebApp.expand();
                    
                    // Get user data from Telegram
                    const telegramUser = APP_STATE.WebApp.initDataUnsafe.user;
                    if (telegramUser) {
                        APP_STATE.user = {
                            id: telegramUser.id,
                            firstName: telegramUser.first_name,
                            lastName: telegramUser.last_name || '',
                            username: telegramUser.username || `user${telegramUser.id}`,
                            photoUrl: telegramUser.photo_url
                        };
                    }
                }

                // Parse URL hash for direct section access
                const hash = window.location.hash.replace('#', '');
                if (hash) {
                    await handleHashNavigation(hash);
                } else {
                    await initializeApp();
                }

                // Setup event listeners
                setupEventListeners();

                // Initialize FAB scroll behavior
                setupFABScroll();

                // Show toast notification
                showToast('GridGain loaded successfully!', 'success');

            } catch (error) {
                console.error('Initialization error:', error);
                showToast('Failed to initialize app', 'error');
            }
        });

        // ==================== HASH NAVIGATION ====================
        async function handleHashNavigation(hash) {
            const parts = hash.split('/');
            const section = parts[0];
            
            switch (section) {
                case 'iframe':
                    // Handle direct iframe call from bot
                    if (parts[1]) {
                        const payload = atob(parts[1]);
                        const data = JSON.parse(payload);
                        await openDirectIframe(data);
                    }
                    break;
                    
                case 'taskboard':
                    // Handle taskboard with payload
                    if (parts[1]) {
                        const payload = atob(parts[1]);
                        const data = JSON.parse(payload);
                        await handleTaskPayload(data);
                    }
                    switchScreen('tasks');
                    break;
                    
                case 'watch':
                    // Handle watch with payload
                    if (parts[1]) {
                        const payload = atob(parts[1]);
                        const data = JSON.parse(payload);
                        await handleAdPayload(data);
                    }
                    switchScreen('watch');
                    break;
                    
                default:
                    // Regular section switch
                    switchScreen(section);
                    await initializeApp();
                    break;
            }
        }

        // ==================== APP INITIALIZATION ====================
        async function initializeApp() {
            try {
                // Load user data
                await loadUserData();
                
                // Load posts
                await loadPosts();
                
                // Load tasks
                await loadTasks();
                
                // Load ads
                await loadAds();
                
                // Update UI
                updateUI();

            } catch (error) {
                console.error('Initialization error:', error);
                showToast('Failed to load data', 'error');
            }
        }

        async function loadUserData() {
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // Default user data if not from Telegram
            if (!APP_STATE.user) {
                APP_STATE.user = {
                    id: '123456',
                    firstName: 'John',
                    lastName: 'Doe',
                    username: 'johndoe',
                    photoUrl: null
                };
            }
            
            // Set demo balance
            APP_STATE.balance = 15000;
            
            // Set demo VIP level
            APP_STATE.vipLevel = 'gold';
            
            // Update user info in UI
            updateUserInfo();
        }

        async function loadPosts() {
            await new Promise(resolve => setTimeout(resolve, 300));
            
            // Demo posts
            APP_STATE.posts = [
                {
                    id: '1',
                    userId: '123456',
                    username: 'johndoe',
                    userAvatar: 'JD',
                    content: 'Check out this amazing opportunity to earn G-coins! Join our community and start earning today. Limited spots available! ',
                    media: null,
                    link: 'https://example.com/join',
                    linkType: 'join',
                    reward: 50,
                    likes: 24,
                    comments: 8,
                    shares: 12,
                    timestamp: '2 hours ago',
                    userHasLiked: false
                },
                {
                    id: '2',
                    userId: '789012',
                    username: 'sarahkim',
                    userAvatar: 'SK',
                    content: 'New task alert! Complete this survey and earn instant rewards. Takes only 5 minutes! ',
                    media: null,
                    link: 'https://example.com/survey',
                    linkType: 'visit',
                    reward: 30,
                    likes: 18,
                    comments: 5,
                    shares: 3,
                    timestamp: '5 hours ago',
                    userHasLiked: true
                }
            ];
        }

        async function loadTasks() {
            await new Promise(resolve => setTimeout(resolve, 400));
            
            // Demo tasks
            APP_STATE.tasks = [
                {
                    id: 't1',
                    platform: 'youtube',
                    title: 'Watch YouTube Video',
                    description: 'Watch full video and like. Stay 02:30 for reward.',
                    duration: 150,
                    reward: 50 + VIP_BONUS[APP_STATE.vipLevel],
                    link: getRandomSmartLink(),
                    completed: false,
                    type: 'watch'
                },
                {
                    id: 't2',
                    platform: 'telegram',
                    title: 'Join Telegram Channel',
                    description: 'Join channel and stay active. Stay 00:45 for reward.',
                    duration: 45,
                    reward: 35 + VIP_BONUS[APP_STATE.vipLevel],
                    link: getRandomSmartLink(),
                    completed: false,
                    type: 'join'
                }
            ];
        }

        async function loadAds() {
            await new Promise(resolve => setTimeout(resolve, 400));
            
            // Demo ads
            APP_STATE.ads = [
                {
                    id: 'a1',
                    title: 'Tech Review 2024',
                    duration: 45,
                    reward: 25 + VIP_BONUS[APP_STATE.vipLevel],
                    source: 'TechBrand Co.',
                    link: getRandomSmartLink(),
                    watched: false
                },
                {
                    id: 'a2',
                    title: 'Crypto Market Update',
                    duration: 30,
                    reward: 30 + VIP_BONUS[APP_STATE.vipLevel],
                    source: 'CryptoExchange',
                    link: getRandomSmartLink(),
                    watched: false
                }
            ];
        }

        // ==================== UI UPDATES ====================
        function updateUI() {
            updateUserInfo();
            updateBalance();
            updateFeed();
            updatePlatformScroller();
            updateTasks();
            updateAds();
            updateStats();
        }

        function updateUserInfo() {
            const user = APP_STATE.user;
            if (!user) return;

            document.getElementById('profileName').textContent = 
                `${user.firstName} ${user.lastName}`.trim();
            document.getElementById('profileUsername').textContent = 
                user.username ? `@${user.username}` : '';
            
            // Update avatar
            const avatarEl = document.getElementById('profileAvatar');
            if (user.photoUrl) {
                avatarEl.style.backgroundImage = `url(${user.photoUrl})`;
                avatarEl.textContent = '';
            } else {
                avatarEl.textContent = 
                    (user.firstName?.[0] || '') + (user.lastName?.[0] || '');
            }
            
            // Update VIP badge
            updateVipBadge();
        }

        function updateVipBadge() {
            const vipBadge = document.getElementById('vipBadge');
            vipBadge.className = `vip-badge ${APP_STATE.vipLevel}`;
            
            const badgeText = {
                none: 'No VIP',
                basic: 'Basic VIP',
                silver: 'Silver VIP',
                gold: 'Gold VIP',
                premium: 'Premium VIP'
            };
            
            vipBadge.textContent = badgeText[APP_STATE.vipLevel] || 'No VIP';
        }

        function updateBalance() {
            document.getElementById('balance-text').textContent = 
                APP_STATE.balance.toLocaleString();
            document.getElementById('statGcoins').textContent = 
                APP_STATE.balance.toLocaleString();
        }

        function updateFeed() {
            const feedContainer = document.getElementById('feedContainer');
            feedContainer.innerHTML = '';
            
            APP_STATE.posts.forEach(post => {
                const postElement = createPostElement(post);
                feedContainer.appendChild(postElement);
            });
        }

        function createPostElement(post) {
            const div = document.createElement('div');
            div.className = 'post-card';
            div.dataset.postId = post.id;
            
            const mediaHtml = post.media ? `
                <div class="post-media">
                    ${post.media.includes('video') ? 
                        `<video src="${post.media}" controls></video>` :
                        `<img src="${post.media}" alt="Post media">`}
                </div>
            ` : '';
            
            const actionText = getActionText(post.linkType);
            
            div.innerHTML = `
                <div class="post-header">
                    <div class="avatar">${post.userAvatar}</div>
                    <div class="post-meta">
                        <div class="poster-name">${post.username}</div>
                        <div class="post-time">${post.timestamp}</div>
                    </div>
                </div>
                <div class="post-content">${post.content}</div>
                ${mediaHtml}
                <div class="earnings-bar">
                    <span class="earnings-label"> Earn up to ${post.reward} G-coins</span>
                </div>
                <div class="post-actions">
                    <button class="action-btn ${post.userHasLiked ? 'liked' : ''}" 
                            onclick="handleLike('${post.id}', this)">
                        <svg class="action-icon" viewBox="0 0 16 16" fill="none">
                            <path d="M8 14L2.5 8.5C1.5 7.5 1.5 5.8 2.5 4.8C3.5 3.8 5.2 3.8 6.2 4.8L8 6.6L9.8 4.8C10.8 3.8 12.5 3.8 13.5 4.8C14.5 5.8 14.5 7.5 13.5 8.5L8 14Z" 
                                  stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
                                  ${post.userHasLiked ? 'fill="currentColor"' : 'fill="none"'}/>
                        </svg>
                        <span>${post.likes}</span>
                    </button>
                    <button class="action-btn" onclick="handlePostAction('${post.id}', '${post.link}', '${post.linkType}', ${post.reward})">
                        <svg class="action-icon" viewBox="0 0 16 16" fill="none">
                            <path d="M14 2L8 8L14 2ZM14 2L9.5 14L8 8L2 6.5L14 2Z" 
                                  stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>${actionText}</span>
                    </button>
                    <button class="action-btn" onclick="openComments('${post.id}')">
                        <svg class="action-icon" viewBox="0 0 16 16" fill="none">
                            <path d="M14 11C14 11.5 13.5 12 13 12H4L2 14V3C2 2.5 2.5 2 3 2H13C13.5 2 14 2.5 14 3V11Z" 
                                  stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>${post.comments}</span>
                    </button>
                </div>
                <div class="comments-section" id="comments-${post.id}">
                    <div class="comments-container"></div>
                    <div class="comment-input-container">
                        <input type="text" class="comment-input" placeholder="Write a comment..." 
                               onkeypress="if(event.key === 'Enter') sendComment('${post.id}')">
                        <button class="send-comment-btn" onclick="sendComment('${post.id}')">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M18 5L10 13L2 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
            `;
            
            return div;
        }

        function updatePlatformScroller() {
            const scroller = document.getElementById('platformScroller');
            scroller.innerHTML = '';
            
            // Create duplicate items for seamless scrolling
            const platforms = Object.entries(PLATFORM_ICONS);
            for (let i = 0; i < 2; i++) {
                platforms.forEach(([key, icon]) => {
                    const item = document.createElement('div');
                    item.className = 'platform-scroller-item';
                    item.onclick = () => filterTasksByPlatform(key);
                    item.innerHTML = `
                        <div class="platform-scroller-icon">${icon}</div>
                        <div class="platform-scroller-name">${PLATFORM_NAMES[key]}</div>
                    `;
                    scroller.appendChild(item);
                });
            }
        }

        function updateTasks() {
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';
            
            APP_STATE.tasks.forEach(task => {
                if (task.completed) return;
                
                const taskElement = createTaskElement(task);
                taskList.appendChild(taskElement);
            });
            
            // Update task counter
            const completedTasks = APP_STATE.tasks.filter(t => t.completed).length;
            document.getElementById('task-counter').textContent = 
                `${completedTasks}/20`;
        }

        function createTaskElement(task) {
            const platform = PLATFORM_NAMES[task.platform];
            const div = document.createElement('div');
            div.className = 'task-card';
            div.dataset.taskId = task.id;
            
            div.innerHTML = `
                <div class="task-header">
                    <div class="task-info">
                        <h3 class="task-title">${task.title}</h3>
                        <p class="task-description">${task.description}</p>
                    </div>
                    <div class="task-reward">
                        <svg width="16" height="16" viewBox="0 0 20 20" fill="none">
                            <circle cx="10" cy="10" r="9" fill="#FFC857"/>
                            <text x="10" y="14" text-anchor="middle" fill="#0B0B0D" font-size="10" font-weight="700">G</text>
                        </svg>
                        <span>${task.reward}</span>
                    </div>
                </div>
                <div class="task-footer">
                    <button class="task-btn primary" onclick="startTask('${task.id}')">Start Task</button>
                    <button class="task-btn secondary" onclick="showTaskDetails('${task.id}')">Details</button>
                </div>
            `;
            
            return div;
        }

        function updateAds() {
            const watchGrid = document.getElementById('watchGrid');
            watchGrid.innerHTML = '';
            
            APP_STATE.ads.forEach(ad => {
                const adElement = createAdElement(ad);
                watchGrid.appendChild(adElement);
            });
            
            // Update ads counter
            const watchedAds = APP_STATE.ads.filter(a => a.watched).length;
            const remaining = 20 - watchedAds;
            document.getElementById('ads-counter').textContent = 
                `${watchedAds}/20`;
        }

        function createAdElement(ad) {
            const div = document.createElement('div');
            div.className = `video-card ${ad.watched ? 'watched' : ''}`;
            div.dataset.adId = ad.id;
            
            div.innerHTML = `
                <div class="video-thumbnail">
                    ${ad.watched ? `
                        <div class="watched-overlay">
                            <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                                <circle cx="20" cy="20" r="18" fill="rgba(74, 163, 255, 0.9)"/>
                                <path d="M12 20L17 25L28 14" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    ` : `
                        <svg class="play-icon" viewBox="0 0 48 48" fill="none">
                            <circle cx="24" cy="24" r="22" fill="rgba(255,255,255,0.9)"/>
                            <path d="M19 16L32 24L19 32V16Z" fill="#0B0B0D"/>
                        </svg>
                    `}
                    <span class="video-duration">0:${ad.duration.toString().padStart(2, '0')}</span>
                </div>
                <div class="video-info">
                    <div class="video-advertiser">
                        <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                            <rect width="14" height="14" rx="3" fill="#4AA3FF"/>
                        </svg>
                        <span>${ad.source}</span>
                    </div>
                    <h3 class="video-title">${ad.title}</h3>
                    <div class="video-meta">
                        <span>Watch 0:${ad.duration.toString().padStart(2, '0')}  Earn</span>
                        <span class="video-reward">+${ad.reward} G-coins</span>
                    </div>
                </div>
            `;
            
            if (!ad.watched) {
                div.onclick = () => watchAd(ad.id);
            }
            
            return div;
        }

        function updateStats() {
            const completedTasks = APP_STATE.tasks.filter(t => t.completed).length;
            const watchedAds = APP_STATE.ads.filter(a => a.watched).length;
            
            // Calculate total earned from tasks and ads
            const taskEarnings = APP_STATE.tasks
                .filter(t => t.completed)
                .reduce((sum, t) => sum + t.reward, 0);
            
            const adEarnings = APP_STATE.ads
                .filter(a => a.watched)
                .reduce((sum, a) => sum + a.reward, 0);
            
            const totalEarned = taskEarnings + adEarnings;
            
            document.getElementById('statTotalEarned').textContent = 
                totalEarned.toLocaleString();
            document.getElementById('statTasksDone').textContent = 
                completedTasks.toString();
        }

        // ==================== EVENT LISTENERS ====================
        function setupEventListeners() {
            // File drop area
            const fileDropArea = document.getElementById('fileDropArea');
            const mediaInput = document.getElementById('mediaInput');
            
            fileDropArea.addEventListener('click', () => mediaInput.click());
            
            mediaInput.addEventListener('change', handleFileSelect);
            
            // Drag and drop
            fileDropArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileDropArea.classList.add('dragover');
            });
            
            fileDropArea.addEventListener('dragleave', () => {
                fileDropArea.classList.remove('dragover');
            });
            
            fileDropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileDropArea.classList.remove('dragover');
                handleFileDrop(e.dataTransfer.files);
            });
            
            // Cleanup watched ads button
            document.getElementById('cleanupWatchedBtn').addEventListener('click', cleanupWatchedAds);
            
            // Post reward input validation
            document.getElementById('postReward').addEventListener('input', validatePostReward);
        }

        function setupFABScroll() {
            const fab = document.getElementById('fabButton');
            const mainContent = document.querySelector('.main-content');
            
            mainContent.addEventListener('scroll', () => {
                const currentScrollY = mainContent.scrollTop;
                
                if (currentScrollY > APP_STATE.lastScrollY && currentScrollY > 100) {
                    // Scrolling down, hide FAB
                    fab.classList.add('hidden');
                } else {
                    // Scrolling up, show FAB
                    fab.classList.remove('hidden');
                }
                
                APP_STATE.lastScrollY = currentScrollY;
            });
        }

        // ==================== FILE HANDLING ====================
        function handleFileSelect(event) {
            const files = event.target.files;
            handleFiles(files);
        }

        function handleFileDrop(files) {
            handleFiles(files);
        }

        function handleFiles(files) {
            const previewContainer = document.getElementById('mediaPreview');
            
            Array.from(files).forEach(file => {
                if (!file.type.match('image.*') && !file.type.match('video.*')) {
                    showToast('Only images and videos are allowed', 'error');
                    return;
                }
                
                if (file.size > 10 * 1024 * 1024) {
                    showToast('File size must be less than 10MB', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'preview-item';
                    
                    if (file.type.match('image.*')) {
                        previewItem.innerHTML = `
                            <img src="${e.target.result}" alt="Preview">
                            <button class="remove-preview" onclick="removePreview(this)"></button>
                        `;
                    } else {
                        previewItem.innerHTML = `
                            <video src="${e.target.result}" controls></video>
                            <button class="remove-preview" onclick="removePreview(this)"></button>
                        `;
                    }
                    
                    previewContainer.appendChild(previewItem);
                };
                reader.readAsDataURL(file);
            });
        }

        function removePreview(button) {
            button.parentElement.remove();
        }

        // ==================== SCREEN NAVIGATION ====================
        function switchScreen(screenName) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Remove active from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected screen
            const screen = document.getElementById(`${screenName}-screen`);
            if (screen) {
                screen.classList.add('active');
            }
            
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                if (item.textContent.trim().toLowerCase().includes(screenName.toLowerCase())) {
                    item.classList.add('active');
                }
            });
            
            // Update URL hash
            window.location.hash = screenName;
        }

        // ==================== MODAL FUNCTIONS ====================
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            document.body.style.overflow = 'auto';
            
            // Clear browser iframe
            if (modalId === 'browser-modal') {
                document.getElementById('browserIframe').src = '';
                document.getElementById('timerBottomBar').style.display = 'none';
                clearTimer();
            }
            
            // Clear composer form
            if (modalId === 'composer-modal') {
                document.getElementById('postForm').reset();
                document.getElementById('mediaPreview').innerHTML = '';
                document.getElementById('submitBtnText').textContent = 'Publish Post';
                document.getElementById('submitBtnLoading').style.display = 'none';
                document.getElementById('postSubmitBtn').disabled = false;
            }
        }

        function openComposer() {
            // Check VIP level
            if (!['gold', 'premium'].includes(APP_STATE.vipLevel)) {
                showToast('Only Gold and Premium VIP can create posts', 'error');
                return;
            }
            
            // Check balance (minimum 10000 G-Coins)
            if (APP_STATE.balance < 10000) {
                showToast('Minimum 10,000 G-Coins required to create posts', 'error');
                return;
            }
            
            openModal('composer-modal');
        }

        // ==================== POST FUNCTIONS ====================
        function validatePostReward() {
            const rewardInput = document.getElementById('postReward');
            const reward = parseInt(rewardInput.value) || 0;
            
            if (reward < 100) {
                rewardInput.value = 100;
                showToast('Minimum reward is 100 G-Coins', 'warning');
            }
            
            if (reward > 1000) {
                rewardInput.value = 1000;
                showToast('Maximum reward is 1000 G-Coins', 'warning');
            }
        }

        async function submitPost(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('postSubmitBtn');
            const submitText = document.getElementById('submitBtnText');
            const submitLoading = document.getElementById('submitBtnLoading');
            
            // Show loading state
            submitText.textContent = 'Publishing...';
            submitLoading.style.display = 'inline-block';
            submitBtn.disabled = true;
            
            try {
                // Get form data
                const postData = {
                    content: document.getElementById('postContent').value,
                    link: document.getElementById('postLink').value,
                    actionType: document.getElementById('postActionType').value,
                    reward: parseInt(document.getElementById('postReward').value),
                    media: getMediaPreviewData()
                };
                
                // Validate data
                if (!postData.content.trim()) {
                    throw new Error('Post content is required');
                }
                
                if (!postData.link.trim()) {
                    throw new Error('Link URL is required');
                }
                
                // Encode and send to bot
                const payload = {
                    type: 'post_created',
                    userId: APP_STATE.user?.id,
                    postData: postData,
                    timestamp: new Date().toISOString(),
                    vipLevel: APP_STATE.vipLevel,
                    balance: APP_STATE.balance
                };
                
                // Encode to Base64
                const encodedPayload = btoa(JSON.stringify(payload));
                
                // Send to bot using the correct method (following IP verification pattern)
                await sendToBot(encodedPayload);
                
                // Add to local posts
                const newPost = {
                    id: Date.now().toString(),
                    userId: APP_STATE.user?.id,
                    username: APP_STATE.user?.username,
                    userAvatar: APP_STATE.user?.firstName?.[0] + APP_STATE.user?.lastName?.[0],
                    content: postData.content,
                    media: postData.media[0] || null,
                    link: postData.link,
                    linkType: postData.actionType,
                    reward: postData.reward,
                    likes: 0,
                    comments: 0,
                    shares: 0,
                    timestamp: 'Just now',
                    userHasLiked: false
                };
                
                APP_STATE.posts.unshift(newPost);
                updateFeed();
                
                // Close modal and show success
                closeModal('composer-modal');
                showToast('Post published successfully!', 'success');
                
            } catch (error) {
                showToast(error.message, 'error');
            } finally {
                // Reset button state
                submitText.textContent = 'Publish Post';
                submitLoading.style.display = 'none';
                submitBtn.disabled = false;
            }
        }

        function getMediaPreviewData() {
            const previewItems = document.querySelectorAll('.preview-item img, .preview-item video');
            return Array.from(previewItems).map(item => item.src);
        }

        function getActionText(actionType) {
            const actions = {
                visit: 'Visit',
                join: 'Join',
                watch: 'Watch',
                install: 'Install',
                signup: 'Sign Up'
            };
            return actions[actionType] || 'Open';
        }

        async function handleLike(postId, button) {
            try {
                const post = APP_STATE.posts.find(p => p.id === postId);
                if (!post) return;
                
                const wasLiked = post.userHasLiked;
                post.userHasLiked = !wasLiked;
                post.likes += wasLiked ? -1 : 1;
                
                // Update UI
                button.classList.toggle('liked');
                button.querySelector('span').textContent = post.likes;
                
                // Send to bot
                const payload = {
                    type: 'post_liked',
                    postId: postId,
                    liked: !wasLiked,
                    userId: APP_STATE.user?.id
                };
                
                await sendToBot(btoa(JSON.stringify(payload)));
                
            } catch (error) {
                console.error('Like error:', error);
            }
        }

        async function handlePostAction(postId, link, actionType, reward) {
            try {
                // Open browser modal
                openModal('browser-modal');
                
                // Set URL
                document.getElementById('browserUrl').textContent = link;
                document.getElementById('browserIframe').src = link;
                
                // Show timer at bottom
                document.getElementById('timerBottomBar').style.display = 'block';
                
                // Start timer based on action type
                const duration = getDurationForAction(actionType);
                startCountdown(duration, 'post_action', {
                    postId: postId,
                    actionType: actionType,
                    reward: reward,
                    link: link
                });
                
                // Send to bot
                const payload = {
                    type: 'post_action_started',
                    postId: postId,
                    actionType: actionType,
                    userId: APP_STATE.user?.id
                };
                
                await sendToBot(btoa(JSON.stringify(payload)));
                
            } catch (error) {
                console.error('Post action error:', error);
                showToast('Failed to start action', 'error');
            }
        }

        function openComments(postId) {
            APP_STATE.currentPostId = postId;
            const commentsSection = document.getElementById(`comments-${postId}`);
            commentsSection.classList.toggle('expanded');
        }

        async function sendComment(postId) {
            const input = document.querySelector(`#comments-${postId} .comment-input`);
            const text = input.value.trim();
            
            if (!text) return;
            
            try {
                // Send to bot
                const payload = {
                    type: 'comment_added',
                    postId: postId,
                    comment: text,
                    userId: APP_STATE.user?.id
                };
                
                await sendToBot(btoa(JSON.stringify(payload)));
                
                // Clear input
                input.value = '';
                
                // Show success
                showToast('Comment added!', 'success');
                
            } catch (error) {
                console.error('Comment error:', error);
                showToast('Failed to add comment', 'error');
            }
        }

        // ==================== TASK FUNCTIONS ====================
        function filterTasksByPlatform(platform) {
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';
            
            const filteredTasks = APP_STATE.tasks.filter(task => 
                task.platform === platform && !task.completed
            );
            
            if (filteredTasks.length === 0) {
                taskList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-tertiary);">
                        No tasks available for ${PLATFORM_NAMES[platform]}
                    </div>
                `;
                return;
            }
            
            filteredTasks.forEach(task => {
                const taskElement = createTaskElement(task);
                taskList.appendChild(taskElement);
            });
        }

        async function startTask(taskId) {
            // Check daily limit
            if (APP_STATE.dailyCounters.tasks >= 20) {
                showToast('Daily task limit reached!', 'warning');
                return;
            }
            
            const task = APP_STATE.tasks.find(t => t.id === taskId);
            if (!task || task.completed) return;
            
            APP_STATE.currentTask = task;
            
            // Open browser modal
            openModal('browser-modal');
            
            // Set URL - load smart link first
            const smartLink = task.link || getRandomSmartLink();
            document.getElementById('browserUrl').textContent = smartLink;
            document.getElementById('browserIframe').src = smartLink;
            
            // Show timer at bottom
            document.getElementById('timerBottomBar').style.display = 'block';
            
            // Start countdown
            startCountdown(task.duration, 'task', {
                taskId: task.id,
                platform: task.platform,
                reward: task.reward,
                link: smartLink
            });
            
            // Send to bot
            const payload = {
                type: 'task_started',
                taskId: task.id,
                userId: APP_STATE.user?.id
            };
            
            await sendToBot(btoa(JSON.stringify(payload)));
        }

        function showTaskDetails(taskId) {
            const task = APP_STATE.tasks.find(t => t.id === taskId);
            if (!task) return;
            
            showToast(`${task.title}: ${task.description}`, 'info');
        }

        async function completeTask(data) {
            try {
                // Mark task as completed
                const task = APP_STATE.tasks.find(t => t.id === data.taskId);
                if (task) {
                    task.completed = true;
                }
                
                // Update counters
                APP_STATE.dailyCounters.tasks++;
                
                // Update balance
                APP_STATE.balance += data.reward;
                
                // Update UI
                updateBalance();
                updateTasks();
                updateStats();
                
                // Send to bot
                const payload = {
                    type: 'task_completed',
                    taskId: data.taskId,
                    reward: data.reward,
                    userId: APP_STATE.user?.id,
                    newBalance: APP_STATE.balance
                };
                
                await sendToBot(btoa(JSON.stringify(payload)));
                
                // Show success with coin animation
                showCoinAnimation();
                showToast(`Task completed! +${data.reward} G-Coins`, 'success');
                
                // Close modal
                setTimeout(() => {
                    closeModal('browser-modal');
                }, 1000);
                
            } catch (error) {
                console.error('Task completion error:', error);
                showToast('Failed to complete task', 'error');
            }
        }

        // ==================== AD FUNCTIONS ====================
        async function watchAd(adId) {
            // Check daily limit
            if (APP_STATE.dailyCounters.ads >= 20) {
                showToast('Daily ad limit reached!', 'warning');
                return;
            }
            
            const ad = APP_STATE.ads.find(a => a.id === adId);
            if (!ad || ad.watched) return;
            
            APP_STATE.currentAd = ad;
            
            // Try Monetag ads first
            if (typeof show_10274566 === 'function') {
                try {
                    // Show rewarded interstitial
                    show_10274566({ 
                        type: 'inApp', 
                        inAppSettings: { 
                            frequency: 2, 
                            capping: 0.1, 
                            interval: 30, 
                            timeout: 5, 
                            everyPage: false 
                        } 
                    }).then(() => {
                        // User watched the ad
                        completeAd({
                            adId: ad.id,
                            reward: ad.reward
                        });
                    }).catch(() => {
                        // Fallback to smartlink
                        openAdFallback(ad);
                    });
                } catch (error) {
                    openAdFallback(ad);
                }
            } else {
                openAdFallback(ad);
            }
        }

        function openAdFallback(ad) {
            // Open browser modal
            openModal('browser-modal');
            
            // Use smartlink
            const smartLink = ad.link || getRandomSmartLink();
            document.getElementById('browserUrl').textContent = smartLink;
            document.getElementById('browserIframe').src = smartLink;
            
            // Show timer at bottom
            document.getElementById('timerBottomBar').style.display = 'block';
            
            // Start countdown
            startCountdown(ad.duration, 'ad', {
                adId: ad.id,
                reward: ad.reward,
                link: smartLink
            });
        }

        async function completeAd(data) {
            try {
                // Mark ad as watched
                const ad = APP_STATE.ads.find(a => a.id === data.adId);
                if (ad) {
                    ad.watched = true;
                }
                
                // Update counters
                APP_STATE.dailyCounters.ads++;
                
                // Update balance
                APP_STATE.balance += data.reward;
                
                // Update UI
                updateBalance();
                updateAds();
                updateStats();
                
                // Send to bot
                const payload = {
                    type: 'ad_watched',
                    adId: data.adId,
                    reward: data.reward,
                    userId: APP_STATE.user?.id,
                    newBalance: APP_STATE.balance
                };
                
                await sendToBot(btoa(JSON.stringify(payload)));
                
                // Show success with coin animation
                showCoinAnimation();
                showToast(`Ad watched! +${data.reward} G-Coins`, 'success');
                
                // Close modal if open
                if (document.getElementById('browser-modal').classList.contains('active')) {
                    setTimeout(() => {
                        closeModal('browser-modal');
                    }, 1000);
                }
                
            } catch (error) {
                console.error('Ad completion error:', error);
                showToast('Failed to complete ad', 'error');
            }
        }

        function cleanupWatchedAds() {
            APP_STATE.ads = APP_STATE.ads.filter(ad => !ad.watched);
            updateAds();
            showToast('Watched ads cleaned up', 'success');
        }

        // ==================== TIMER FUNCTIONS ====================
        function startCountdown(seconds, type, data) {
            let remaining = seconds;
            const display = document.getElementById('timerDisplay');
            const progressBar = document.getElementById('timerProgressBar');
            const claimButton = document.getElementById('claimButton');
            
            // Update display immediately
            updateTimerDisplay();
            
            // Start interval
            APP_STATE.timerInterval = setInterval(() => {
                remaining--;
                updateTimerDisplay();
                
                if (remaining <= 0) {
                    clearInterval(APP_STATE.timerInterval);
                    APP_STATE.timerInterval = null;
                    
                    // Enable claim button
                    claimButton.disabled = false;
                    claimButton.textContent = 'Claim Reward';
                    
                    // Update timer label
                    document.getElementById('timerLabel').textContent = 'Ready to claim!';
                }
            }, 1000);
            
            function updateTimerDisplay() {
                const mins = Math.floor(remaining / 60);
                const secs = remaining % 60;
                display.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                
                const progress = ((seconds - remaining) / seconds) * 100;
                progressBar.style.width = `${progress}%`;
            }
            
            // Store data for claim
            claimButton.dataset.type = type;
            claimButton.dataset.data = JSON.stringify(data);
        }

        function clearTimer() {
            if (APP_STATE.timerInterval) {
                clearInterval(APP_STATE.timerInterval);
                APP_STATE.timerInterval = null;
            }
        }

        function claimReward() {
            const claimButton = document.getElementById('claimButton');
            const type = claimButton.dataset.type;
            const data = JSON.parse(claimButton.dataset.data || '{}');
            
            if (!type || !data) return;
            
            switch (type) {
                case 'task':
                    completeTask(data);
                    break;
                case 'ad':
                    completeAd(data);
                    break;
                case 'post_action':
                    completePostAction(data);
                    break;
            }
            
            // Disable button again
            claimButton.disabled = true;
            claimButton.textContent = 'Completed';
        }

        async function completePostAction(data) {
            try {
                // Update balance
                APP_STATE.balance += data.reward;
                
                // Update UI
                updateBalance();
                
                // Send to bot
                const payload = {
                    type: 'post_action_completed',
                    postId: data.postId,
                    reward: data.reward,
                    userId: APP_STATE.user?.id,
                    newBalance: APP_STATE.balance
                };
                
                await sendToBot(btoa(JSON.stringify(payload)));
                
                // Show success
                showCoinAnimation();
                showToast(`Action completed! +${data.reward} G-Coins`, 'success');
                
                // Close modal
                setTimeout(() => {
                    closeModal('browser-modal');
                }, 1000);
                
            } catch (error) {
                console.error('Post action completion error:', error);
                showToast('Failed to complete action', 'error');
            }
        }

        // ==================== DIRECT IFRAME HANDLING ====================
        async function openDirectIframe(data) {
            // Open browser modal
            openModal('browser-modal');
            
            // Set URL
            const url = data.url || getRandomSmartLink();
            document.getElementById('browserUrl').textContent = url;
            document.getElementById('browserIframe').src = url;
            
            // Show timer at bottom
            document.getElementById('timerBottomBar').style.display = 'block';
            
            // Start countdown with random duration
            const duration = data.duration || Math.floor(Math.random() * 60) + 30;
            startCountdown(duration, 'direct', {
                url: url,
                reward: data.reward || 50,
                type: data.type || 'ad'
            });
        }

        // ==================== PAYLOAD HANDLING ====================
        async function handleTaskPayload(data) {
            // Add task from bot payload
            const newTask = {
                id: `bot_${Date.now()}`,
                platform: data.platform || 'website',
                title: data.title || 'New Task',
                description: data.description || 'Complete this task to earn rewards',
                duration: data.duration || 60,
                reward: data.reward || 100,
                link: data.link || getRandomSmartLink(),
                completed: false,
                type: data.type || 'visit'
            };
            
            APP_STATE.tasks.push(newTask);
            updateTasks();
            
            showToast('New task received from bot!', 'success');
        }

        async function handleAdPayload(data) {
            // Add ad from bot payload
            const newAd = {
                id: `bot_ad_${Date.now()}`,
                title: data.title || 'New Ad',
                duration: data.duration || 40,
                reward: data.reward || 60 + VIP_BONUS[APP_STATE.vipLevel],
                source: data.source || 'Partner Network',
                link: data.link || getRandomSmartLink(),
                watched: false
            };
            
            APP_STATE.ads.push(newAd);
            updateAds();
            
            showToast('New ad received from bot!', 'success');
        }

        // ==================== BOT COMMUNICATION ====================
        async function sendToBot(encodedPayload) {
            // This follows the exact pattern from your IP verification code
            // In BOTS.business, this would be handled differently than standard fetch
            
            console.log('Sending to bot:', encodedPayload);
            
            // Simulate sending to bot (replace with actual BOTS.business integration)
            try {
                // For BOTS.business, you would use their specific API
                // This is a placeholder for the actual integration
                
                // Simulate success
                await new Promise(resolve => setTimeout(resolve, 500));
                
                return { success: true };
            } catch (error) {
                console.error('Bot communication error:', error);
                throw error;
            }
        }

        // ==================== PROFILE FUNCTIONS ====================
        function openProfileSection(section) {
            const titleMap = {
                edit: 'Edit Profile',
                transactions: 'Transaction History',
                referrals: 'Referrals',
                settings: 'Settings'
            };
            
            document.getElementById('profileSectionTitle').textContent = titleMap[section];
            
            let content = '';
            switch (section) {
                case 'edit':
                    content = `
                        <div class="form-group">
                            <label class="form-label">Telegram Username</label>
                            <input type="text" class="form-input" value="${APP_STATE.user?.username || ''}" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">User ID</label>
                            <input type="text" class="form-input" value="${APP_STATE.user?.id || ''}" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">VIP Level</label>
                            <div class="vip-badge ${APP_STATE.vipLevel}" style="margin-top: 8px;">
                                ${document.getElementById('vipBadge').textContent}
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'transactions':
                    content = `
                        <div style="max-height: 400px; overflow-y: auto;">
                            <div style="padding: 16px; text-align: center; color: var(--text-tertiary);">
                                Transaction history will appear here
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'referrals':
                    const refLink = `https://t.me/GridGain_Bot?start=${APP_STATE.user?.id}`;
                    content = `
                        <div class="form-group">
                            <label class="form-label">Your Referral Link</label>
                            <div style="display: flex; gap: 8px; margin-top: 8px;">
                                <input type="text" class="form-input" value="${refLink}" id="refLinkInput" readonly>
                                <button class="submit-btn" style="flex: 0 0 auto; padding: 0 16px;" 
                                        onclick="copyRefLink()">
                                    Copy
                                </button>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'settings':
                    content = `
                        <div class="form-group">
                            <label class="form-label">App Version</label>
                            <input type="text" class="form-input" value="1.0.0" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">User ID</label>
                            <input type="text" class="form-input" value="${APP_STATE.user?.id || ''}" readonly>
                        </div>
                    `;
                    break;
            }
            
            document.getElementById('profileSectionContent').innerHTML = content;
            openModal('profile-section-modal');
        }

        function openHelpSupport() {
            // Open Telegram bot help command
            if (APP_STATE.isTelegramWebApp && APP_STATE.WebApp) {
                APP_STATE.WebApp.openTelegramLink('https://t.me/GridGain_Bot?start=help');
            } else {
                window.open('https://t.me/GridGain_Bot?start=help', '_blank');
            }
        }

        function copyRefLink() {
            const input = document.getElementById('refLinkInput');
            input.select();
            document.execCommand('copy');
            showToast('Referral link copied!', 'success');
        }

        // ==================== UTILITY FUNCTIONS ====================
        function getRandomSmartLink() {
            const randomIndex = Math.floor(Math.random() * SMART_LINKS.length);
            return SMART_LINKS[randomIndex];
        }

        function getDurationForAction(actionType) {
            const durations = {
                visit: 60,
                join: 45,
                watch: 90,
                install: 120,
                signup: 75
            };
            return durations[actionType] || 30;
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: '',
                error: '',
                warning: '',
                info: ''
            };
            
            toast.innerHTML = `
                <div class="toast-icon">${icons[type] || ''}</div>
                <div class="toast-content">
                    <div class="toast-title">${type.charAt(0).toUpperCase() + type.slice(1)}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="close-toast" onclick="this.parentElement.remove()">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            `;
            
            container.appendChild(toast);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.remove();
                        }
                    }, 300);
                }
            }, 5000);
        }

        function showCoinAnimation() {
            const coin = document.createElement('div');
            coin.className = 'coin-animation';
            coin.innerHTML = `
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                    <circle cx="16" cy="16" r="15" fill="#FFC857" stroke="#FFD87A" stroke-width="2"/>
                    <text x="16" y="22" text-anchor="middle" fill="#0B0B0D" font-size="18" font-weight="700">G</text>
                </svg>
            `;
            
            // Position near the balance chip
            const balanceChip = document.getElementById('balanceChip');
            const rect = balanceChip.getBoundingClientRect();
            coin.style.left = rect.right - 20 + 'px';
            coin.style.top = rect.top + 10 + 'px';
            
            document.body.appendChild(coin);
            
            setTimeout(() => {
                coin.remove();
            }, 600);
        }

        // ==================== MONETAG AD INTEGRATION ====================
        // Initialize Monetag when loaded
        function initializeMonetagAds() {
            if (typeof monetag !== 'undefined') {
                monetag.start();
                
                // Setup push/popup ads
                setupPushAds();
            }
        }

        function setupPushAds() {
            // Setup push ads for button clicks
            document.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON' || e.target.closest('button')) {
                    // Random chance to show ad (10% chance)
                    if (Math.random() < 0.1 && typeof show_10274566 === 'function') {
                        show_10274566('pop').catch(() => {
                            // Silently fail if ad doesn't show
                        });
                    }
                }
            });
        }

        // Initialize when Monetag loads
        if (typeof monetag !== 'undefined') {
            initializeMonetagAds();
        } else {
            window.addEventListener('load', () => {
                if (typeof monetag !== 'undefined') {
                    initializeMonetagAds();
                }
            });
        }

        // ==================== EXPORT FUNCTIONS ====================
        window.switchScreen = switchScreen;
        window.openComposer = openComposer;
        window.closeModal = closeModal;
        window.handleLike = handleLike;
        window.handlePostAction = handlePostAction;
        window.openComments = openComments;
        window.sendComment = sendComment;
        window.watchAd = watchAd;
        window.cleanupWatchedAds = cleanupWatchedAds;
        window.openProfileSection = openProfileSection;
        window.openHelpSupport = openHelpSupport;
        window.copyRefLink = copyRefLink;
        window.removePreview = removePreview;
        window.claimReward = claimReward;
        window.startTask = startTask;
        window.showTaskDetails = showTaskDetails;

        // Initialize
        setTimeout(initializeMonetagAds, 1000);
    </script>
</body>
</html>